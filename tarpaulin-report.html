<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: white;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
    content: counter(line);
    margin-right: 10px;
}
.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
  counter-increment: line;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","cell.rs"],"content":"use crate::spreadsheet::{Spreadsheet, CommandStatus}; \n\n// Cell value representation\n#[derive(Debug, Clone, PartialEq)]\npub enum CellValue {\n    Integer(i32),\n    Error,\n}\n\npub fn parse_cell_reference(sheet: \u0026Spreadsheet, cell_ref: \u0026str) -\u003e Result\u003c(i16, i16), CommandStatus\u003e {\n    let cell_ref = cell_ref.as_bytes();\n    if cell_ref.is_empty() {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Find column/row split point in one pass\n    let mut split_idx = 0;\n    let mut col_length = 0;\n    \n    while split_idx \u003c cell_ref.len() \u0026\u0026 \n          cell_ref[split_idx] \u003e= b'A' \u0026\u0026 cell_ref[split_idx] \u003c= b'Z' {\n        col_length += 1;\n        if col_length \u003e 3 {\n            return Err(CommandStatus::CmdUnrecognized);\n        }\n        split_idx += 1;\n    }\n    \n    // Verify we have columns and rows\n    if col_length == 0 || split_idx == cell_ref.len() {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Verify remaining chars are digits\n    for i in split_idx..cell_ref.len() {\n        if !cell_ref[i].is_ascii_digit() {\n            return Err(CommandStatus::CmdUnrecognized);\n        }\n    }\n    \n    // Get column reference as a string slice (no allocation)\n    let col_name = std::str::from_utf8(\u0026cell_ref[0..split_idx])\n        .map_err(|_| CommandStatus::CmdUnrecognized)?;\n    \n    // Parse row directly from bytes (avoid string allocation)\n    let mut row: i16 = 0;\n    for \u0026byte in \u0026cell_ref[split_idx..] {\n        row = row * 10 + (byte - b'0') as i16;\n    }\n    \n    // Convert to 0-based\n    let row = row - 1;\n    \n    // Convert column name to index\n    let col = sheet.column_name_to_index(col_name);\n    // Check row and column bounds\n    if row \u003c 0 || col \u003c 0 || row \u003e 998 || col \u003e 18277 {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    Ok((row, col))\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::spreadsheet::{CommandStatus, Spreadsheet};\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_parse_cell_reference_valid() {\n        let sheet = create_test_spreadsheet(10, 10);\n        assert_eq!(parse_cell_reference(\u0026sheet, \"A1\"), Ok((0, 0)));\n        assert_eq!(parse_cell_reference(\u0026sheet, \"B2\"), Ok((1, 1)));\n        assert_eq!(parse_cell_reference(\u0026sheet, \"AA10\"), Ok((9, 26)));\n        assert_eq!(parse_cell_reference(\u0026sheet, \"ZZZ999\"), Ok((998, 18277)));\n    }\n\n    #[test]\n    fn test_parse_cell_reference_invalid() {\n        let sheet = create_test_spreadsheet(10, 10);\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"1A\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"A\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"A1B\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"AAAA1\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n    }\n\n    #[test]\n    fn test_parse_cell_reference_bounds() {\n        let sheet = create_test_spreadsheet(10, 10);\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"A1000\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"ZZZ1000\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"A0\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n    }\n\n    #[test]\n    fn test_cell_value_equality() {\n        assert_eq!(CellValue::Integer(42), CellValue::Integer(42));\n        assert_eq!(CellValue::Error, CellValue::Error);\n        assert_ne!(CellValue::Integer(42), CellValue::Error);\n    }\n}","traces":[{"line":10,"address":[179584],"length":1,"stats":{"Line":3}},{"line":11,"address":[179683],"length":1,"stats":{"Line":3}},{"line":12,"address":[179699],"length":1,"stats":{"Line":3}},{"line":13,"address":[179733],"length":1,"stats":{"Line":1}},{"line":17,"address":[179708],"length":1,"stats":{"Line":3}},{"line":18,"address":[179720],"length":1,"stats":{"Line":3}},{"line":20,"address":[181345,179731,179776],"length":1,"stats":{"Line":10}},{"line":21,"address":[179813],"length":1,"stats":{"Line":3}},{"line":22,"address":[181257,179960,181238],"length":1,"stats":{"Line":4}},{"line":23,"address":[181245],"length":1,"stats":{"Line":3}},{"line":24,"address":[181297],"length":1,"stats":{"Line":1}},{"line":26,"address":[181273,181337,181350],"length":1,"stats":{"Line":7}},{"line":30,"address":[180030,179786],"length":1,"stats":{"Line":5}},{"line":31,"address":[179987],"length":1,"stats":{"Line":1}},{"line":35,"address":[180048,180427],"length":1,"stats":{"Line":8}},{"line":36,"address":[181152,180448],"length":1,"stats":{"Line":10}},{"line":37,"address":[181199],"length":1,"stats":{"Line":1}},{"line":42,"address":[180139,180603,180478,180620,180329],"length":1,"stats":{"Line":12}},{"line":43,"address":[180610],"length":1,"stats":{"Line":0}},{"line":46,"address":[180520],"length":1,"stats":{"Line":4}},{"line":47,"address":[180763,180688,180580,180530,181118],"length":1,"stats":{"Line":22}},{"line":48,"address":[181029,181123,180784],"length":1,"stats":{"Line":10}},{"line":52,"address":[180838,180880,180738],"length":1,"stats":{"Line":10}},{"line":55,"address":[180846],"length":1,"stats":{"Line":5}},{"line":57,"address":[180944,180872,180901],"length":1,"stats":{"Line":21}},{"line":58,"address":[180907],"length":1,"stats":{"Line":1}},{"line":60,"address":[180971],"length":1,"stats":{"Line":6}}],"covered":26,"coverable":27},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","evaluator.rs"],"content":"use crate::spreadsheet::{Spreadsheet, CommandStatus};\nuse crate::cell::{CellValue, parse_cell_reference};\nuse crate::formula::parse_range;\nuse crate::formula::{eval_max, eval_min, sum_value, eval_variance, eval_avg};\nuse crate::graph::{add_children, remove_all_parents};\nuse crate::reevaluate_topo::{toposort_reval_detect_cycle, sleep_fn};\n\n\npub fn handle_sleep(\n    sheet: \u0026mut Spreadsheet,\n    row: i16,\n    col: i16,\n    expr: \u0026str,\n    sleep_time: \u0026mut f64,\n) -\u003e CommandStatus {\n    let cell_key = sheet.get_key(row, col);\n    \n    // Handle cell reference case\n    if let Ok((target_row, target_col)) = parse_cell_reference(sheet, expr) {\n        // Get parent key before any borrowing\n        let pkey = sheet.get_key(target_row, target_col);\n        \n        // Check for self-reference early (optimization)\n        if row == target_row \u0026\u0026 col == target_col {\n            return CommandStatus::CmdCircularRef;\n        }\n\n        // Remove parents and update cell in one block\n        remove_all_parents(sheet, row, col);\n                \n        // Set up the new cell metadata\n        let meta = sheet.get_cell_meta(row, col);\n        meta.parent1 = pkey;\n        meta.parent2 = -1;\n        meta.formula = 102;    // Custom formula code for sleep\n        \n        // // Check for circular reference\n        // if detect_cycle(sheet, pkey, -1, 102, cell_key) {\n        //     if let Some(old) = old_meta {\n        //         let (parent1, parent2, formula) = (old.parent1, old.parent2, old.formula);\n        //         sheet.cell_meta.insert(cell_key, old);\n        //         add_children(sheet, parent1, parent2, formula, row, col);\n        //     } else {\n        //         sheet.cell_meta.remove(\u0026cell_key);\n        //     }\n        //     return CommandStatus::CmdCircularRef;\n        // }\n        \n        // Add children and update sleep time\n        add_children(sheet, pkey, -1, 102, row, col);\n        // Add to sleep time if integer\n        // Get the value from parent cell\n        let parent_value = sheet.get_cell(target_row, target_col);\n        if let CellValue::Integer(val) = parent_value {\n            // Update cell value and sleep time\n            sleep_fn(sheet, row, col, *val, sleep_time);\n        }\n        else{\n            *sheet.get_mut_cell(row, col) = CellValue::Error;\n        }\n    } \n    // Handle numeric literal case\n    else if let Ok(val) = expr.parse::\u003ci32\u003e() {\n        // Remove all parents and update cell in one sequence\n        remove_all_parents(sheet, row, col);\n        // Update cell value and sleep_time\n        // Delete the cell meta entry\n        sheet.cell_meta.remove(\u0026cell_key);\n        sleep_fn(sheet, row, col, val, sleep_time);\n    }\n    else {\n        return CommandStatus::CmdUnrecognized;\n    }\n    \n    CommandStatus::CmdOk\n}\n\npub fn evaluate_arithmetic(\n    sheet: \u0026mut Spreadsheet,\n    row: i16,\n    col: i16,\n    expr: \u0026str,\n) -\u003e CommandStatus {\n    let cell_key = sheet.get_key(row, col);\n    \n    // Case 1: Integer literal\n    if let Ok(number) = expr.parse::\u003ci32\u003e() {\n        remove_all_parents(sheet, row, col);\n        // As no parents and formula remove the meta data from the set and map\n        // to avoid memory leaks\n        sheet.cell_meta.remove(\u0026cell_key);\n        *sheet.get_mut_cell(row, col) = CellValue::Integer(number);\n        \n        return CommandStatus::CmdOk;\n    }\n    \n    // Case 2: Simple cell reference - check using bytes for better performance\n    let mut all_alnum = true;\n    for \u0026b in expr.as_bytes() {\n        if !(b.is_ascii_alphanumeric() || b == b'_') {\n            all_alnum = false;\n            break;\n        }\n    }\n    \n    if all_alnum {\n        match parse_cell_reference(sheet, expr) {\n            Ok((target_row, target_col)) =\u003e {\n                \n                // Get reference cell key and value\n                let ref_cell_key = sheet.get_key(target_row, target_col);\n\n                // Remove old dependencies and set new ones\n                remove_all_parents(sheet, row, col);\n                \n                // Update metadata\n                let meta = sheet.get_cell_meta(row, col);\n                meta.parent1 = ref_cell_key;\n                meta.parent2 = -1;\n                meta.formula = 82;  // Code for simple cell reference\n                \n                // Add dependency\n                add_children(sheet, ref_cell_key, -1, 82, row, col);\n                \n                // Update cell value\n                *sheet.get_mut_cell(row, col) =  match sheet.get_cell(target_row, target_col) {\n                    CellValue::Integer(val) =\u003e CellValue::Integer(*val),\n                    _ =\u003e CellValue::Error,\n                };\n                return CommandStatus::CmdOk;\n            },\n            Err(status) =\u003e return status\n        }\n    }\n\n    // Case 3: Binary arithmetic expression\n    // Find operator starting at index 1 (like C code, to handle leading minus sign)\n    let bytes = expr.as_bytes();\n    let mut op_idx = 0;\n    let mut op = 0u8;\n    \n    // Start at index 1 to handle leading minus sign\n    for i in 1..bytes.len() {\n        match bytes[i] {\n            b'+' | b'-' | b'*' | b'/' =\u003e {\n                op = bytes[i];\n                op_idx = i;\n                break;\n            },\n            _ =\u003e {}\n        }\n    }\n    \n    if op_idx == 0 {\n        return CommandStatus::CmdUnrecognized;\n    }\n    \n    // Split into left and right parts\n    let left = \u0026expr[..op_idx];\n    let right = \u0026expr[op_idx+1..];\n    \n    if left.is_empty() || right.is_empty() {\n        return CommandStatus::CmdUnrecognized;\n    }\n    \n    // Variables to track cell references and values\n    let mut left_val = 0;\n    let mut right_val = 0;\n    let mut left_is_cell = false;\n    let mut right_is_cell = false;\n    let mut error_found = false;\n    let mut left_cell_key = -1;\n    let mut right_cell_key = -1;\n    \n    // Parse left operand\n    if let Ok(num) = left.parse::\u003ci32\u003e() {\n        left_val = num;\n    } else {\n        // Try as cell reference\n        match parse_cell_reference(sheet, left) {\n            Ok((left_row, left_col)) =\u003e {      \n\n                left_is_cell = true;\n                left_cell_key = sheet.get_key(left_row, left_col);\n                \n                // Get reference cell value\n                let left_cell = sheet.get_cell(left_row, left_col);\n                match left_cell {\n                    CellValue::Integer(val) =\u003e left_val = *val,\n                    _ =\u003e {\n                        error_found = true;\n                    }\n                }\n            },\n            Err(status) =\u003e return status\n        }\n    }\n    \n    // Parse right operand\n    if let Ok(num) = right.parse::\u003ci32\u003e() {\n        right_val = num;\n    } else {\n        // Try as cell reference\n        match parse_cell_reference(sheet, right) {\n            Ok((right_row, right_col)) =\u003e {\n                \n                right_is_cell = true;\n                right_cell_key = sheet.get_key(right_row, right_col);\n                \n                // Get reference cell value\n                let right_cell = sheet.get_cell(right_row, right_col);\n                match right_cell {\n                    CellValue::Integer(val) =\u003e right_val = *val,\n                    _ =\u003e {\n                        error_found = true;\n                    }\n                }\n            },\n            Err(status) =\u003e return status\n        }\n    }\n    \n    // Remove old dependencies\n    remove_all_parents(sheet, row, col);\n    \n    // Determine formula type based on operator and operand types\n    let mut formula_type = match op {\n        b'+' =\u003e 10,\n        b'-' =\u003e 20,\n        b'*' =\u003e 40,\n        b'/' =\u003e 30,\n        _ =\u003e unreachable!()\n    };\n    \n    // Adjust formula type based on cell references (like C code)\n    if left_is_cell \u0026\u0026 right_is_cell {\n        formula_type += 0;    // Both are cells, no adjustment needed\n    } else if left_is_cell {\n        formula_type += 2;\n    } else if right_is_cell {\n        formula_type += 3;\n    }\n    \n    // Set metadata\n    let meta = sheet.get_cell_meta(row, col);\n    meta.formula = formula_type;\n    meta.parent1 = if left_is_cell { left_cell_key } else { left_val };\n    meta.parent2 = if right_is_cell { right_cell_key } else { right_val };\n    \n    // Check for circular references\n    \n    // Add dependencies\n    if left_is_cell \u0026\u0026 right_is_cell {\n        // Add dependencies for both cells\n        add_children(sheet, left_cell_key, right_cell_key, formula_type, row, col);\n    }\n    else if left_is_cell {\n        // Ordering of Cells matters\n        add_children(sheet, left_cell_key, -1, formula_type, row, col);\n    }\n    else if right_is_cell {\n        // Ordering of Cells matters\n        add_children(sheet, -1, right_cell_key, formula_type, row, col);\n    }\n    \n    // Calculate result\n    let cell = sheet.get_mut_cell(row, col);\n    \n    if error_found {\n        *cell = CellValue::Error;\n    } else {\n        match op {\n            b'+' =\u003e *cell = CellValue::Integer(left_val + right_val),\n            b'-' =\u003e *cell = CellValue::Integer(left_val - right_val),\n            b'*' =\u003e *cell = CellValue::Integer(left_val * right_val),\n            b'/' =\u003e {\n                if right_val == 0 {\n                    *cell = CellValue::Error;\n                } else {\n                    *cell = CellValue::Integer(left_val / right_val);\n                }\n            },\n            _ =\u003e unreachable!()\n        }\n    }\n    \n    CommandStatus::CmdOk\n}\n\npub fn evaluate_formula(\n    sheet: \u0026mut Spreadsheet,\n    row: i16,\n    col: i16,\n    expr: \u0026str,\n    sleep_time: \u0026mut f64,\n) -\u003e CommandStatus {\n    // Fast fail for empty expression\n    if expr.is_empty() {\n        return CommandStatus::CmdUnrecognized;\n    }\n\n    // Optimize function checks by using bytes for prefix matching\n    let bytes = expr.as_bytes();\n    \n    // Check for range-based functions with a single pass\n    let (is_formula, formula_type, prefix_len) = match bytes.get(0..3) {\n        Some(b\"AVG\") if bytes.get(3) == Some(\u0026b'(') =\u003e (true, 6, 4),\n        Some(b\"MIN\") if bytes.get(3) == Some(\u0026b'(') =\u003e (true, 7, 4),\n        Some(b\"MAX\") if bytes.get(3) == Some(\u0026b'(') =\u003e (true, 8, 4),\n        Some(b\"SUM\") if bytes.get(3) == Some(\u0026b'(') =\u003e (true, 5, 4),\n        Some(b\"SLE\") if bytes.len() \u003e 5 \u0026\u0026 \n                        bytes[3] == b'E' \u0026\u0026 \n                        bytes[4] == b'P' \u0026\u0026 \n                        bytes.get(5) == Some(\u0026b'(') =\u003e {\n            // Handle sleep function separately\n            if !expr.ends_with(')') {\n                return CommandStatus::CmdUnrecognized;\n            }\n            return handle_sleep(sheet, row, col, \u0026expr[6..expr.len() - 1], sleep_time);\n            },\n        Some(b\"STD\") if bytes.len() \u003e 5 \u0026\u0026 \n                        bytes[3] == b'E' \u0026\u0026 \n                        bytes[4] == b'V' \u0026\u0026 \n                        bytes.get(5) == Some(\u0026b'(') =\u003e (true, 9, 6),\n        _ =\u003e (false, -1, 0)\n    };\n\n    if is_formula {\n        // Validate formula format\n        if !expr.ends_with(')') {\n            return CommandStatus::CmdUnrecognized;\n        }\n\n        // Extract the range string without allocating extra memory\n        let range_str: \u0026str = \u0026expr[prefix_len..expr.len() - 1];\n\n        // Parse range and validate early to avoid unnecessary work\n        let range = match parse_range(sheet, range_str) {\n            Ok(r) =\u003e r,\n            Err(status) =\u003e return status,\n        };\n\n        // let cell_key = sheet.get_key(row, col);\n        let parent1 = sheet.get_key(range.start_row, range.start_col);\n        let parent2 = sheet.get_key(range.end_row, range.end_col);\n        remove_all_parents(sheet, row, col); \n        // Update metadata\n        let meta = sheet.get_cell_meta(row, col);\n        meta.parent1 = parent1;\n        meta.parent2 = parent2;\n        meta.formula = formula_type;\n\n        // Add children and evaluate the appropriate function\n        add_children(sheet, parent1, parent2, formula_type, row, col);\n        \n        match formula_type {\n            9 =\u003e eval_variance(sheet, row, col, parent1, parent2),\n            8 =\u003e eval_max(sheet, row, col, parent1, parent2),\n            7 =\u003e eval_min(sheet, row, col, parent1, parent2),\n            6 =\u003e eval_avg(sheet, row, col, parent1, parent2),\n            _ =\u003e sum_value(sheet, row, col, parent1, parent2), // SUM case\n        }\n    } else {\n        // Handle arithmetic expressions\n        evaluate_arithmetic(sheet, row, col, expr)\n    }\n\n}\n\npub fn set_cell_value(sheet: \u0026mut Spreadsheet, row: i16, col: i16, expr: \u0026str, sleep_time: \u0026mut f64) -\u003e CommandStatus {\n    let old_meta = sheet.cell_meta.get(\u0026sheet.get_key(row, col)).cloned();\n    let old_value = match sheet.get_cell(row, col) {\n        CellValue::Integer(val) =\u003e CellValue::Integer(*val),\n        _ =\u003e CellValue::Error,\n    };\n    let status: CommandStatus = evaluate_formula(sheet, row, col, expr, sleep_time);\n    if let CommandStatus::CmdOk = status {\n        // Reevaluate the cell dependents graphs i.e. all of its children\n        // Also at same time check for cycle in the graph as it will save time and memory\n        let has_cycle = toposort_reval_detect_cycle(sheet, row, col, sleep_time);\n        if has_cycle {\n            // If a cycle is detected, restore the old parents and formula\n            // Remove the new parents and formula\n            remove_all_parents(sheet, row, col);\n            // Restore the old value\n            *sheet.get_mut_cell(row, col) = old_value;\n            // Old meta \n            if let Some(old) = old_meta {\n                let (parent1, parent2, formula) = (old.parent1, old.parent2, old.formula);\n                sheet.cell_meta.insert(sheet.get_key(row, col), old);\n                add_children(sheet, parent1, parent2, formula, row, col);\n            } else {\n                sheet.cell_meta.remove(\u0026sheet.get_key(row, col));\n            }\n\n            return CommandStatus::CmdCircularRef;\n        }\n    }\n    status\n}\n\npub fn handle_command(\n    sheet: \u0026mut Spreadsheet,\n    trimmed: \u0026str,\n    sleep_time: \u0026mut f64,\n) -\u003e CommandStatus {    \n    // Fast path for single-character commands to avoid string comparisons\n    if trimmed.len() == 1 {\n        match trimmed.as_bytes()[0] {\n            b'w' | b'a' | b's' | b'd' =\u003e {\n                // We've already validated it's one byte, so this is safe\n                let direction = trimmed.chars().next().unwrap();\n                sheet.scroll_viewport(direction);\n                return CommandStatus::CmdOk;\n            },\n            b'q' =\u003e return CommandStatus::CmdOk, // Handle quit command if needed\n            _ =\u003e {}\n        }\n    }\n    \n    // Use match for special commands for better branch prediction\n    match trimmed {\n        \"disable_output\" =\u003e {\n            sheet.output_enabled = false;\n            return CommandStatus::CmdOk;\n        },\n        \"enable_output\" =\u003e {\n            sheet.output_enabled = true;\n            return CommandStatus::CmdOk;\n        },\n        _ =\u003e {}\n    }\n    \n    // Check for cell dependency visualization command\n    if trimmed.starts_with(\"visualize \") {\n        let cell_ref = \u0026trimmed[10..]; // Skip \"visualize \" prefix\n        match parse_cell_reference(sheet, cell_ref) {\n            Ok((row, col)) =\u003e {\n                return sheet.visualize_cell_relationships(row, col);\n            },\n            Err(status) =\u003e {\n                return status;\n            }\n        }\n    }\n    \n    // Check for scroll_to command with byte-based comparison\n    if trimmed.len() \u003e 10 \u0026\u0026 \u0026trimmed.as_bytes()[..9] == b\"scroll_to\" \u0026\u0026 trimmed.as_bytes()[9] == b' ' {\n        let cell_ref = \u0026trimmed[10..];\n        return sheet.scroll_to_cell(cell_ref);\n    }\n    \n    // Check for cell assignment using byte search for '='\n    let bytes = trimmed.as_bytes();\n    let mut eq_pos = None;\n    \n    for (i, \u0026b) in bytes.iter().enumerate() {\n        if b == b'=' {\n            eq_pos = Some(i);\n            break;\n        }\n    }\n    \n    if let Some(pos) = eq_pos {\n        // Use slice operations which are more efficient than split_at\n        let cell_ref = trimmed[..pos].trim();\n        let expr = trimmed[pos+1..].trim();\n        \n        // Parse the cell reference with direct result handling\n        return match parse_cell_reference(sheet, cell_ref) {\n            Ok((row, col)) =\u003e {\n                // All bounds checks in one condition\n                set_cell_value(sheet, row, col, expr, sleep_time)\n            },\n            Err(status) =\u003e status,\n        };\n    }\n    // No recognized command\n    CommandStatus::CmdUnrecognized\n}\n\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::cell::CellValue;\n    use crate::spreadsheet::{CommandStatus, Spreadsheet};\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_handle_sleep_with_reference() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_sleep(\u0026mut sheet, 1, 1, \"A1\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(5));\n        assert_eq!(sleep_time, 5.0);\n        let meta = sheet.cell_meta.get(\u0026sheet.get_key(1, 1)).unwrap();\n        assert_eq!(meta.formula, 102);\n        assert_eq!(meta.parent1, sheet.get_key(0, 0));\n    }\n\n    #[test]\n    fn test_handle_sleep_with_literal() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_sleep(\u0026mut sheet, 1, 1, \"3\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n        assert_eq!(sleep_time, 3.0);\n        assert!(!sheet.cell_meta.contains_key(\u0026sheet.get_key(1, 1)));\n    }\n\n    #[test]\n    fn test_handle_sleep_invalid() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_sleep(\u0026mut sheet, 1, 1, \"INVALID\", \u0026mut sleep_time),\n            CommandStatus::CmdUnrecognized\n        );\n    }\n\n    #[test]\n    fn test_handle_sleep_self_reference() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_sleep(\u0026mut sheet, 1, 1, \"B2\", \u0026mut sleep_time),\n            CommandStatus::CmdCircularRef\n        );\n    }\n\n    #[test]\n    fn test_evaluate_arithmetic_literal() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        assert_eq!(\n            evaluate_arithmetic(\u0026mut sheet, 0, 0, \"42\"),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(42));\n        assert!(!sheet.cell_meta.contains_key(\u0026sheet.get_key(0, 0)));\n    }\n\n    #[test]\n    fn test_evaluate_arithmetic_cell_ref() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(10);\n        assert_eq!(\n            evaluate_arithmetic(\u0026mut sheet, 1, 1, \"A1\"),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(10));\n        let meta = sheet.cell_meta.get(\u0026sheet.get_key(1, 1)).unwrap();\n        assert_eq!(meta.formula, 82);\n        assert_eq!(meta.parent1, sheet.get_key(0, 0));\n    }\n\n    #[test]\n    fn test_evaluate_arithmetic_binary_add() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(5);\n        assert_eq!(\n            evaluate_arithmetic(\u0026mut sheet, 1, 1, \"A1+3\"),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(8));\n        let meta = sheet.cell_meta.get(\u0026sheet.get_key(1, 1)).unwrap();\n        assert_eq!(meta.formula, 12);\n        assert_eq!(meta.parent1, sheet.get_key(0, 0));\n        assert_eq!(meta.parent2, 3);\n    }\n\n    #[test]\n    fn test_evaluate_arithmetic_binary_div_zero() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(5);\n        assert_eq!(\n            evaluate_arithmetic(\u0026mut sheet, 1, 1, \"A1/0\"),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    }\n\n    #[test]\n    fn test_evaluate_formula_sum() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(2);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            evaluate_formula(\u0026mut sheet, 1, 1, \"SUM(A1:B1)\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n        let meta = sheet.cell_meta.get(\u0026sheet.get_key(1, 1)).unwrap();\n        assert_eq!(meta.formula, 5);\n    }\n\n    #[test]\n    fn test_evaluate_formula_invalid() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            evaluate_formula(\u0026mut sheet, 1, 1, \"SUM(A1)\", \u0026mut sleep_time),\n            CommandStatus::CmdUnrecognized\n        );\n    }\n\n    #[test]\n    fn test_set_cell_value_with_cycle() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            set_cell_value(\u0026mut sheet, 0, 0, \"A1\", \u0026mut sleep_time),\n            CommandStatus::CmdCircularRef\n        );\n    }\n\n    #[test]\n    fn test_handle_command_scroll() {\n        let mut sheet = create_test_spreadsheet(50, 50);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"s\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(sheet.viewport_row, 10);\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"d\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(sheet.viewport_col, 10);\n    }\n\n    #[test]\n    fn test_handle_command_output_toggle() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"disable_output\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert!(!sheet.output_enabled);\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"enable_output\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert!(sheet.output_enabled);\n    }\n\n    #[test]\n    fn test_handle_command_visualize() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"visualize A1\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"visualize Z9\", \u0026mut sleep_time),\n            CommandStatus::CmdInvalidCell\n        );\n    }\n\n    #[test]\n    fn test_handle_command_scroll_to() {\n        let mut sheet = create_test_spreadsheet(50, 50);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"scroll_to B2\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(sheet.viewport_row, 1);\n        assert_eq!(sheet.viewport_col, 1);\n    }\n\n    #[test]\n    fn test_handle_command_assignment() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"A1=42\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(42));\n    }\n}","traces":[{"line":9,"address":[156800],"length":1,"stats":{"Line":4}},{"line":16,"address":[156892],"length":1,"stats":{"Line":4}},{"line":19,"address":[156922],"length":1,"stats":{"Line":4}},{"line":21,"address":[157028],"length":1,"stats":{"Line":2}},{"line":24,"address":[157062,157313],"length":1,"stats":{"Line":3}},{"line":25,"address":[157322],"length":1,"stats":{"Line":1}},{"line":29,"address":[157148],"length":1,"stats":{"Line":1}},{"line":32,"address":[157174],"length":1,"stats":{"Line":1}},{"line":33,"address":[157216],"length":1,"stats":{"Line":1}},{"line":34,"address":[157218],"length":1,"stats":{"Line":1}},{"line":35,"address":[157225],"length":1,"stats":{"Line":1}},{"line":50,"address":[157231],"length":1,"stats":{"Line":1}},{"line":53,"address":[157269],"length":1,"stats":{"Line":1}},{"line":54,"address":[157293,157354],"length":1,"stats":{"Line":2}},{"line":56,"address":[157369],"length":1,"stats":{"Line":1}},{"line":59,"address":[157400],"length":1,"stats":{"Line":0}},{"line":63,"address":[157464,157083],"length":1,"stats":{"Line":3}},{"line":65,"address":[157479],"length":1,"stats":{"Line":1}},{"line":68,"address":[157495],"length":1,"stats":{"Line":1}},{"line":69,"address":[157538],"length":1,"stats":{"Line":1}},{"line":72,"address":[157551],"length":1,"stats":{"Line":1}},{"line":75,"address":[157432],"length":1,"stats":{"Line":1}},{"line":78,"address":[157568],"length":1,"stats":{"Line":1}},{"line":84,"address":[157668],"length":1,"stats":{"Line":1}},{"line":87,"address":[157702],"length":1,"stats":{"Line":1}},{"line":88,"address":[157798],"length":1,"stats":{"Line":1}},{"line":91,"address":[157817],"length":1,"stats":{"Line":1}},{"line":92,"address":[157873],"length":1,"stats":{"Line":1}},{"line":94,"address":[157921],"length":1,"stats":{"Line":1}},{"line":98,"address":[157947],"length":1,"stats":{"Line":3}},{"line":99,"address":[158009,158075,157971],"length":1,"stats":{"Line":9}},{"line":100,"address":[158092],"length":1,"stats":{"Line":3}},{"line":101,"address":[158119],"length":1,"stats":{"Line":2}},{"line":106,"address":[158059],"length":1,"stats":{"Line":1}},{"line":107,"address":[158266],"length":1,"stats":{"Line":1}},{"line":108,"address":[161215],"length":1,"stats":{"Line":1}},{"line":111,"address":[161257],"length":1,"stats":{"Line":1}},{"line":114,"address":[161305],"length":1,"stats":{"Line":1}},{"line":117,"address":[161340],"length":1,"stats":{"Line":1}},{"line":118,"address":[161391],"length":1,"stats":{"Line":1}},{"line":119,"address":[161393],"length":1,"stats":{"Line":1}},{"line":120,"address":[161400],"length":1,"stats":{"Line":1}},{"line":123,"address":[161406],"length":1,"stats":{"Line":1}},{"line":126,"address":[161447,161577],"length":1,"stats":{"Line":2}},{"line":127,"address":[161504],"length":1,"stats":{"Line":1}},{"line":128,"address":[161542],"length":1,"stats":{"Line":0}},{"line":130,"address":[161607],"length":1,"stats":{"Line":1}},{"line":132,"address":[161473],"length":1,"stats":{"Line":0}},{"line":138,"address":[158177],"length":1,"stats":{"Line":2}},{"line":139,"address":[158193],"length":1,"stats":{"Line":2}},{"line":140,"address":[158205],"length":1,"stats":{"Line":2}},{"line":143,"address":[158418,158213,158349],"length":1,"stats":{"Line":6}},{"line":144,"address":[158442],"length":1,"stats":{"Line":2}},{"line":146,"address":[158558,158618],"length":1,"stats":{"Line":2}},{"line":147,"address":[158589],"length":1,"stats":{"Line":2}},{"line":154,"address":[158390],"length":1,"stats":{"Line":2}},{"line":155,"address":[158634],"length":1,"stats":{"Line":0}},{"line":159,"address":[158663],"length":1,"stats":{"Line":2}},{"line":160,"address":[158715,158832],"length":1,"stats":{"Line":2}},{"line":162,"address":[158861,158821],"length":1,"stats":{"Line":4}},{"line":163,"address":[158872],"length":1,"stats":{"Line":0}},{"line":167,"address":[158901],"length":1,"stats":{"Line":2}},{"line":168,"address":[158912],"length":1,"stats":{"Line":2}},{"line":169,"address":[158923],"length":1,"stats":{"Line":2}},{"line":170,"address":[158931],"length":1,"stats":{"Line":2}},{"line":171,"address":[158939],"length":1,"stats":{"Line":2}},{"line":172,"address":[158947],"length":1,"stats":{"Line":2}},{"line":173,"address":[158958],"length":1,"stats":{"Line":2}},{"line":176,"address":[159037,158969],"length":1,"stats":{"Line":2}},{"line":177,"address":[159030],"length":1,"stats":{"Line":0}},{"line":180,"address":[159063],"length":1,"stats":{"Line":2}},{"line":181,"address":[159219],"length":1,"stats":{"Line":2}},{"line":183,"address":[159261],"length":1,"stats":{"Line":2}},{"line":184,"address":[159269],"length":1,"stats":{"Line":2}},{"line":187,"address":[159307],"length":1,"stats":{"Line":2}},{"line":188,"address":[159331],"length":1,"stats":{"Line":2}},{"line":189,"address":[159372],"length":1,"stats":{"Line":2}},{"line":190,"address":[159410],"length":1,"stats":{"Line":0}},{"line":191,"address":[159402],"length":1,"stats":{"Line":0}},{"line":195,"address":[159341],"length":1,"stats":{"Line":0}},{"line":200,"address":[159155,159415,159436],"length":1,"stats":{"Line":6}},{"line":201,"address":[159429],"length":1,"stats":{"Line":2}},{"line":204,"address":[159459],"length":1,"stats":{"Line":0}},{"line":205,"address":[159627],"length":1,"stats":{"Line":0}},{"line":207,"address":[159669],"length":1,"stats":{"Line":0}},{"line":208,"address":[159677],"length":1,"stats":{"Line":0}},{"line":211,"address":[159715],"length":1,"stats":{"Line":0}},{"line":212,"address":[159739],"length":1,"stats":{"Line":0}},{"line":213,"address":[159780],"length":1,"stats":{"Line":0}},{"line":214,"address":[159818],"length":1,"stats":{"Line":0}},{"line":215,"address":[159810],"length":1,"stats":{"Line":0}},{"line":219,"address":[159749],"length":1,"stats":{"Line":0}},{"line":224,"address":[159562],"length":1,"stats":{"Line":2}},{"line":227,"address":[159573],"length":1,"stats":{"Line":2}},{"line":228,"address":[159851],"length":1,"stats":{"Line":1}},{"line":229,"address":[159863],"length":1,"stats":{"Line":0}},{"line":230,"address":[159875],"length":1,"stats":{"Line":0}},{"line":231,"address":[159887],"length":1,"stats":{"Line":1}},{"line":236,"address":[159897,159919,160185],"length":1,"stats":{"Line":4}},{"line":237,"address":[159929,160177,160190],"length":1,"stats":{"Line":0}},{"line":238,"address":[159907,160151],"length":1,"stats":{"Line":4}},{"line":239,"address":[159974,160143,160156],"length":1,"stats":{"Line":4}},{"line":240,"address":[160120,159962],"length":1,"stats":{"Line":0}},{"line":241,"address":[160083,160122],"length":1,"stats":{"Line":0}},{"line":245,"address":[160031],"length":1,"stats":{"Line":2}},{"line":246,"address":[160055],"length":1,"stats":{"Line":2}},{"line":247,"address":[160206,160067],"length":1,"stats":{"Line":2}},{"line":248,"address":[160250],"length":1,"stats":{"Line":2}},{"line":253,"address":[160327,160305],"length":1,"stats":{"Line":4}},{"line":255,"address":[160362],"length":1,"stats":{"Line":0}},{"line":257,"address":[160315],"length":1,"stats":{"Line":2}},{"line":259,"address":[160436],"length":1,"stats":{"Line":2}},{"line":261,"address":[160399],"length":1,"stats":{"Line":0}},{"line":263,"address":[160554],"length":1,"stats":{"Line":0}},{"line":267,"address":[160493],"length":1,"stats":{"Line":2}},{"line":269,"address":[160666,160517],"length":1,"stats":{"Line":2}},{"line":270,"address":[160636],"length":1,"stats":{"Line":0}},{"line":272,"address":[160589],"length":1,"stats":{"Line":2}},{"line":273,"address":[160821,160699],"length":1,"stats":{"Line":2}},{"line":274,"address":[160728,160898],"length":1,"stats":{"Line":0}},{"line":275,"address":[160962,160760],"length":1,"stats":{"Line":0}},{"line":277,"address":[161186,160793,161052],"length":1,"stats":{"Line":2}},{"line":278,"address":[161022],"length":1,"stats":{"Line":1}},{"line":280,"address":[161191,161057],"length":1,"stats":{"Line":0}},{"line":287,"address":[160876],"length":1,"stats":{"Line":1}},{"line":290,"address":[161632],"length":1,"stats":{"Line":1}},{"line":298,"address":[161743],"length":1,"stats":{"Line":1}},{"line":299,"address":[161865],"length":1,"stats":{"Line":0}},{"line":303,"address":[161788],"length":1,"stats":{"Line":1}},{"line":306,"address":[162479,162183,161804,161924,162257],"length":1,"stats":{"Line":7}},{"line":307,"address":[161878,162106],"length":1,"stats":{"Line":1}},{"line":308,"address":[162305],"length":1,"stats":{"Line":0}},{"line":309,"address":[162397],"length":1,"stats":{"Line":0}},{"line":310,"address":[162550],"length":1,"stats":{"Line":2}},{"line":311,"address":[162637],"length":1,"stats":{"Line":0}},{"line":312,"address":[162652],"length":1,"stats":{"Line":0}},{"line":313,"address":[162709],"length":1,"stats":{"Line":0}},{"line":314,"address":[162771],"length":1,"stats":{"Line":0}},{"line":316,"address":[162828],"length":1,"stats":{"Line":0}},{"line":317,"address":[162842],"length":1,"stats":{"Line":0}},{"line":319,"address":[162917,162862],"length":1,"stats":{"Line":0}},{"line":321,"address":[163010],"length":1,"stats":{"Line":0}},{"line":322,"address":[163025],"length":1,"stats":{"Line":0}},{"line":323,"address":[163082],"length":1,"stats":{"Line":0}},{"line":324,"address":[163144],"length":1,"stats":{"Line":0}},{"line":325,"address":[161889],"length":1,"stats":{"Line":1}},{"line":328,"address":[162244],"length":1,"stats":{"Line":2}},{"line":330,"address":[163293],"length":1,"stats":{"Line":2}},{"line":331,"address":[163307],"length":1,"stats":{"Line":0}},{"line":335,"address":[163330,163458],"length":1,"stats":{"Line":2}},{"line":338,"address":[163422],"length":1,"stats":{"Line":2}},{"line":339,"address":[163482],"length":1,"stats":{"Line":1}},{"line":340,"address":[163753],"length":1,"stats":{"Line":1}},{"line":344,"address":[163498],"length":1,"stats":{"Line":1}},{"line":345,"address":[163544],"length":1,"stats":{"Line":1}},{"line":346,"address":[163608],"length":1,"stats":{"Line":1}},{"line":348,"address":[163643],"length":1,"stats":{"Line":1}},{"line":349,"address":[163690],"length":1,"stats":{"Line":1}},{"line":350,"address":[163692],"length":1,"stats":{"Line":1}},{"line":351,"address":[163695],"length":1,"stats":{"Line":1}},{"line":354,"address":[163706],"length":1,"stats":{"Line":1}},{"line":356,"address":[163715],"length":1,"stats":{"Line":1}},{"line":357,"address":[163868],"length":1,"stats":{"Line":0}},{"line":358,"address":[163924],"length":1,"stats":{"Line":0}},{"line":359,"address":[163980],"length":1,"stats":{"Line":0}},{"line":360,"address":[164036],"length":1,"stats":{"Line":0}},{"line":361,"address":[163812],"length":1,"stats":{"Line":1}},{"line":365,"address":[163260],"length":1,"stats":{"Line":1}},{"line":370,"address":[164064],"length":1,"stats":{"Line":1}},{"line":371,"address":[164159],"length":1,"stats":{"Line":1}},{"line":372,"address":[164229],"length":1,"stats":{"Line":1}},{"line":373,"address":[164258],"length":1,"stats":{"Line":1}},{"line":374,"address":[164296],"length":1,"stats":{"Line":0}},{"line":376,"address":[164337],"length":1,"stats":{"Line":1}},{"line":377,"address":[164355],"length":1,"stats":{"Line":1}},{"line":380,"address":[164389],"length":1,"stats":{"Line":1}},{"line":381,"address":[164412],"length":1,"stats":{"Line":1}},{"line":384,"address":[164447],"length":1,"stats":{"Line":1}},{"line":386,"address":[164473],"length":1,"stats":{"Line":1}},{"line":388,"address":[164519],"length":1,"stats":{"Line":1}},{"line":389,"address":[164572],"length":1,"stats":{"Line":0}},{"line":390,"address":[164675],"length":1,"stats":{"Line":0}},{"line":391,"address":[164755],"length":1,"stats":{"Line":0}},{"line":393,"address":[164788],"length":1,"stats":{"Line":1}},{"line":396,"address":[164844],"length":1,"stats":{"Line":1}},{"line":399,"address":[164416],"length":1,"stats":{"Line":1}},{"line":402,"address":[164864],"length":1,"stats":{"Line":2}},{"line":408,"address":[164967],"length":1,"stats":{"Line":2}},{"line":409,"address":[165080,165020],"length":1,"stats":{"Line":2}},{"line":412,"address":[165276,165177],"length":1,"stats":{"Line":2}},{"line":413,"address":[165283],"length":1,"stats":{"Line":1}},{"line":414,"address":[165288],"length":1,"stats":{"Line":1}},{"line":416,"address":[165298],"length":1,"stats":{"Line":0}},{"line":423,"address":[165045],"length":1,"stats":{"Line":2}},{"line":424,"address":[165368],"length":1,"stats":{"Line":1}},{"line":425,"address":[165375],"length":1,"stats":{"Line":1}},{"line":427,"address":[165337],"length":1,"stats":{"Line":1}},{"line":428,"address":[165432],"length":1,"stats":{"Line":1}},{"line":429,"address":[165439],"length":1,"stats":{"Line":1}},{"line":435,"address":[165401],"length":1,"stats":{"Line":1}},{"line":436,"address":[165504],"length":1,"stats":{"Line":1}},{"line":437,"address":[165548],"length":1,"stats":{"Line":1}},{"line":438,"address":[166862],"length":1,"stats":{"Line":1}},{"line":439,"address":[166894],"length":1,"stats":{"Line":1}},{"line":441,"address":[166917],"length":1,"stats":{"Line":0}},{"line":442,"address":[166931],"length":1,"stats":{"Line":0}},{"line":448,"address":[166037,165468],"length":1,"stats":{"Line":2}},{"line":449,"address":[166192],"length":1,"stats":{"Line":1}},{"line":450,"address":[166236],"length":1,"stats":{"Line":1}},{"line":454,"address":[165663],"length":1,"stats":{"Line":1}},{"line":455,"address":[165679],"length":1,"stats":{"Line":1}},{"line":457,"address":[165691,166253,166327],"length":1,"stats":{"Line":3}},{"line":458,"address":[166365],"length":1,"stats":{"Line":1}},{"line":459,"address":[166374],"length":1,"stats":{"Line":1}},{"line":464,"address":[166444,166311],"length":1,"stats":{"Line":2}},{"line":466,"address":[166465],"length":1,"stats":{"Line":1}},{"line":467,"address":[166731,166576,166522],"length":1,"stats":{"Line":2}},{"line":470,"address":[166655],"length":1,"stats":{"Line":1}},{"line":471,"address":[166773],"length":1,"stats":{"Line":1}},{"line":473,"address":[166805],"length":1,"stats":{"Line":1}},{"line":475,"address":[166828],"length":1,"stats":{"Line":0}},{"line":479,"address":[166542],"length":1,"stats":{"Line":0}}],"covered":163,"coverable":222},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","formula.rs"],"content":"use crate::cell::{CellValue, parse_cell_reference};\nuse crate::spreadsheet::{Spreadsheet, CommandStatus};\n\n#[derive(Debug, PartialEq)]\npub struct Range {\n    pub start_row: i16,\n    pub start_col: i16,\n    pub end_row: i16,\n    pub end_col: i16,\n}\n\n// Optimize the sum_value function for large ranges\npub fn sum_value(sheet: \u0026mut Spreadsheet, row: i16, col: i16, parent1: i32, parent2: i32) -\u003e CommandStatus {    \n    let mut sum = 0;\n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);\n    // For smaller ranges, use the original approach\n    for i in start_row..=end_row {\n        for j in start_col..=end_col {\n            let ref_cell_value = sheet.get_cell(i, j);\n            if let CellValue::Integer(value) = ref_cell_value {\n                sum += value;\n            } else {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return CommandStatus::CmdOk;\n            }\n        }\n    }\n    \n    // Now set the result\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(sum);\n    CommandStatus::CmdOk\n}\n\n// Add variance evaluation function\npub fn eval_variance(sheet: \u0026mut Spreadsheet, row:i16 , col:i16, parent1: i32, parent2: i32) -\u003e CommandStatus {\n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);\n    let count = ((end_row - start_row + 1) as i32) * ((end_col - start_col + 1) as i32);\n    sum_value(sheet, row, col, parent1, parent2);\n    // Check if sum_value was successful\n    let cell_value = sheet.get_mut_cell(row, col);\n    let mean_value;\n    if let CellValue::Integer(value) = cell_value {\n        let val = *value / count;\n        *cell_value = CellValue::Integer(val);\n        mean_value = val as f64;\n    }\n    else {\n        return CommandStatus::CmdOk;\n    }\n\n    let mut variance = 0.0;\n    \n    for i in start_row..=end_row {\n        for j in start_col..=end_col {\n            if let CellValue::Integer(value) = *sheet.get_cell(i, j) {\n                variance += ((value as f64) - (mean_value)).powi(2);\n            }\n        }\n    }\n\n    variance /= count as f64;\n    let std_dev = (variance.sqrt() + 0.5) as i32;\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(std_dev);\n    CommandStatus::CmdOk\n}\n\n\npub fn eval_min(sheet: \u0026mut Spreadsheet, row: i16, col: i16, parent1: i32, parent2: i32) -\u003e CommandStatus {    \n    let mut min_value = i32::MAX;\n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);\n    // First collect all values (immutable borrows)\n    for r in start_row..=end_row {\n        for c in start_col..=end_col {\n            if let CellValue::Integer(value) = sheet.get_cell(r, c) {\n                min_value = std::cmp::min(min_value, *value);\n            } else {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return CommandStatus::CmdOk;\n            }\n        }\n    }\n    \n    // Now get the mutable cell and set its value (mutable borrow)\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(min_value);\n    CommandStatus::CmdOk\n}\n\n// Fix eval_max implementation\npub fn eval_max(sheet: \u0026mut Spreadsheet, row: i16, col: i16, parent1: i32, parent2: i32) -\u003e CommandStatus {\n    let mut max_value = i32::MIN; \n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);   \n    // First collect all values (immutable borrows)\n    for r in start_row..=end_row {\n        for c in start_col..=end_col {\n            if let CellValue::Integer(value) = sheet.get_cell(r, c) {\n                max_value = std::cmp::max(max_value, *value);\n            } else {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return CommandStatus::CmdOk;\n            }\n        }\n    }\n    \n    // Now get the mutable cell and set its value (mutable borrow)\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(max_value);\n    CommandStatus::CmdOk\n}\n\n\npub fn eval_avg(sheet: \u0026mut Spreadsheet, row: i16, col: i16, parent1: i32, parent2: i32) -\u003e CommandStatus {\n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);\n    let count = ((end_row - start_row + 1) as i32) * ((end_col - start_col + 1) as i32);\n    match sum_value(sheet, row, col, parent1, parent2) {\n        CommandStatus::CmdOk =\u003e {\n            let cell_value = sheet.get_mut_cell(row, col);\n            if let CellValue::Integer(value) = cell_value {\n                *cell_value = CellValue::Integer(*value / count);\n            }\n        },\n        _ =\u003e return CommandStatus::CmdOk,\n    }\n    CommandStatus::CmdOk\n}\n\n// Keep the Range struct and parse_range function\npub fn parse_range(spreadsheet: \u0026Spreadsheet, range_str: \u0026str) -\u003e Result\u003cRange, CommandStatus\u003e {\n    // Check for minimum valid range pattern length (like \"A1:A1\")\n    if range_str.len() \u003c 3 {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Find the colon index using bytes to avoid UTF-8 decoding\n    let bytes = range_str.as_bytes();\n    let mut colon_index = 0;\n    \n    for (i, \u0026b) in bytes.iter().enumerate() {\n        if b == b':' {\n            colon_index = i;\n            break;\n        }\n    }\n    \n    // Validate colon position (must exist and have chars on both sides)\n    if colon_index == 0 || colon_index + 1 \u003e= range_str.len() {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Avoid creating new strings by using slices\n    let start_cell = \u0026range_str[..colon_index];\n    let end_cell = \u0026range_str[colon_index + 1..];\n    \n    // Parse cell references and validate them in one step\n    let (start_row, start_col) = parse_cell_reference(spreadsheet, start_cell)?;\n    let (end_row, end_col) = parse_cell_reference(spreadsheet, end_cell)?;\n    \n    // Ensure coordinates are valid and range is properly ordered\n    if start_row \u003c 0 || start_col \u003c 0 || end_row \u003c 0 || end_col \u003c 0 || \n       start_row \u003e end_row || start_col \u003e end_col {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Construct the Range directly\n    Ok(Range {\n        start_row,\n        start_col,\n        end_row,\n        end_col,\n    })\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::cell::CellValue;\n    use crate::spreadsheet::{CommandStatus, Spreadsheet};\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_sum_value() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(2);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            sum_value(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n    }\n\n    #[test]\n    fn test_sum_value_error() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Error;\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            sum_value(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    }\n\n    #[test]\n    fn test_eval_variance() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(2);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(4);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_variance(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(1));\n    }\n\n    #[test]\n    fn test_eval_variance_error() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Error;\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(4);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_variance(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    }\n\n    #[test]\n    fn test_eval_min() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(3);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_min(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(1));\n    }\n\n    #[test]\n    fn test_eval_max() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(3);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_max(\u0026mut sheet, 1, 2, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 2), CellValue::Integer(3));\n    }\n\n    #[test]\n    fn test_eval_min_max_error() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Error;\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_min(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n        assert_eq!(\n            eval_max(\u0026mut sheet, 1, 2, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 2), CellValue::Error);\n    }\n\n    #[test]\n    fn test_eval_avg() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(2);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(4);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_avg(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n    }\n\n    #[test]\n    fn test_parse_range_valid() {\n        let sheet = create_test_spreadsheet(5, 5);\n        let range = parse_range(\u0026sheet, \"A1:B2\").unwrap();\n        assert_eq!(range.start_row, 0);\n        assert_eq!(range.start_col, 0);\n        assert_eq!(range.end_row, 1);\n        assert_eq!(range.end_col, 1);\n    }\n\n    #[test]\n    fn test_parse_range_invalid() {\n        let sheet = create_test_spreadsheet(5, 5);\n        assert_eq!(\n            parse_range(\u0026sheet, \"A\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_range(\u0026sheet, \"A1:\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_range(\u0026sheet, \":A1\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_range(\u0026sheet, \"B2:A1\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n    }\n}","traces":[{"line":13,"address":[231440],"length":1,"stats":{"Line":1}},{"line":14,"address":[231516],"length":1,"stats":{"Line":1}},{"line":15,"address":[231524],"length":1,"stats":{"Line":1}},{"line":16,"address":[231567],"length":1,"stats":{"Line":1}},{"line":18,"address":[231601,231878],"length":1,"stats":{"Line":2}},{"line":19,"address":[231896,232081],"length":1,"stats":{"Line":2}},{"line":20,"address":[232139],"length":1,"stats":{"Line":1}},{"line":21,"address":[232163],"length":1,"stats":{"Line":1}},{"line":22,"address":[232188],"length":1,"stats":{"Line":1}},{"line":24,"address":[232222],"length":1,"stats":{"Line":1}},{"line":25,"address":[232254],"length":1,"stats":{"Line":1}},{"line":31,"address":[231818],"length":1,"stats":{"Line":1}},{"line":32,"address":[231858],"length":1,"stats":{"Line":1}},{"line":36,"address":[232272],"length":1,"stats":{"Line":2}},{"line":37,"address":[232351],"length":1,"stats":{"Line":2}},{"line":38,"address":[232391],"length":1,"stats":{"Line":2}},{"line":39,"address":[232427,232710],"length":1,"stats":{"Line":2}},{"line":40,"address":[232650],"length":1,"stats":{"Line":2}},{"line":42,"address":[232676],"length":1,"stats":{"Line":2}},{"line":44,"address":[232735,232700],"length":1,"stats":{"Line":3}},{"line":45,"address":[232782,233094,232750],"length":1,"stats":{"Line":2}},{"line":46,"address":[232860],"length":1,"stats":{"Line":1}},{"line":47,"address":[232887],"length":1,"stats":{"Line":1}},{"line":50,"address":[232764],"length":1,"stats":{"Line":1}},{"line":53,"address":[232906],"length":1,"stats":{"Line":1}},{"line":55,"address":[233331,232915,233110],"length":1,"stats":{"Line":3}},{"line":56,"address":[233352,233567],"length":1,"stats":{"Line":2}},{"line":57,"address":[233715,233640],"length":1,"stats":{"Line":2}},{"line":58,"address":[233685],"length":1,"stats":{"Line":1}},{"line":63,"address":[233161],"length":1,"stats":{"Line":1}},{"line":64,"address":[233181],"length":1,"stats":{"Line":1}},{"line":65,"address":[233263],"length":1,"stats":{"Line":1}},{"line":66,"address":[233311],"length":1,"stats":{"Line":1}},{"line":70,"address":[233728],"length":1,"stats":{"Line":2}},{"line":71,"address":[233798],"length":1,"stats":{"Line":2}},{"line":72,"address":[233806],"length":1,"stats":{"Line":2}},{"line":73,"address":[233849],"length":1,"stats":{"Line":2}},{"line":75,"address":[234160,233883],"length":1,"stats":{"Line":4}},{"line":76,"address":[234363,234479,234178],"length":1,"stats":{"Line":6}},{"line":77,"address":[234421],"length":1,"stats":{"Line":2}},{"line":78,"address":[234463],"length":1,"stats":{"Line":2}},{"line":80,"address":[234496],"length":1,"stats":{"Line":1}},{"line":81,"address":[234528],"length":1,"stats":{"Line":1}},{"line":87,"address":[234100],"length":1,"stats":{"Line":1}},{"line":88,"address":[234140],"length":1,"stats":{"Line":1}},{"line":92,"address":[234544],"length":1,"stats":{"Line":1}},{"line":93,"address":[234614],"length":1,"stats":{"Line":1}},{"line":94,"address":[234622],"length":1,"stats":{"Line":1}},{"line":95,"address":[234665],"length":1,"stats":{"Line":1}},{"line":97,"address":[234976,234699],"length":1,"stats":{"Line":2}},{"line":98,"address":[234994,235179,235295],"length":1,"stats":{"Line":3}},{"line":99,"address":[235237],"length":1,"stats":{"Line":1}},{"line":100,"address":[235279],"length":1,"stats":{"Line":1}},{"line":102,"address":[235312],"length":1,"stats":{"Line":1}},{"line":103,"address":[235344],"length":1,"stats":{"Line":1}},{"line":109,"address":[234916],"length":1,"stats":{"Line":1}},{"line":110,"address":[234956],"length":1,"stats":{"Line":1}},{"line":114,"address":[235360],"length":1,"stats":{"Line":1}},{"line":115,"address":[235421],"length":1,"stats":{"Line":1}},{"line":116,"address":[235455],"length":1,"stats":{"Line":1}},{"line":117,"address":[235728,235480],"length":1,"stats":{"Line":1}},{"line":118,"address":[235700],"length":1,"stats":{"Line":1}},{"line":120,"address":[235759],"length":1,"stats":{"Line":1}},{"line":121,"address":[235932,235780,235809],"length":1,"stats":{"Line":3}},{"line":122,"address":[235821,235934,235850],"length":1,"stats":{"Line":2}},{"line":125,"address":[235790],"length":1,"stats":{"Line":0}},{"line":127,"address":[235835],"length":1,"stats":{"Line":1}},{"line":131,"address":[235968],"length":1,"stats":{"Line":2}},{"line":133,"address":[236040],"length":1,"stats":{"Line":2}},{"line":134,"address":[236197],"length":1,"stats":{"Line":1}},{"line":138,"address":[236081],"length":1,"stats":{"Line":1}},{"line":139,"address":[236097],"length":1,"stats":{"Line":1}},{"line":141,"address":[236106,236217,236285],"length":1,"stats":{"Line":3}},{"line":142,"address":[236323],"length":1,"stats":{"Line":1}},{"line":143,"address":[236332],"length":1,"stats":{"Line":1}},{"line":149,"address":[236275,236370],"length":1,"stats":{"Line":2}},{"line":150,"address":[236344],"length":1,"stats":{"Line":1}},{"line":154,"address":[236445],"length":1,"stats":{"Line":1}},{"line":155,"address":[236488,236779],"length":1,"stats":{"Line":1}},{"line":158,"address":[237058,236810,236591],"length":1,"stats":{"Line":2}},{"line":159,"address":[237167,236868,237097],"length":1,"stats":{"Line":2}},{"line":162,"address":[237206,237244,237154],"length":1,"stats":{"Line":3}},{"line":163,"address":[237270],"length":1,"stats":{"Line":1}},{"line":164,"address":[237217],"length":1,"stats":{"Line":1}},{"line":168,"address":[237314],"length":1,"stats":{"Line":1}}],"covered":84,"coverable":85},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","graph.rs"],"content":"use crate::spreadsheet::Spreadsheet;\n\npub fn add_children(sheet: \u0026mut Spreadsheet, cell1: i32, cell2: i32, formula: i16, row: i16, col: i16) {\n    if formula == -1 {\n        return;\n    }\n    let rem = formula % 10;\n    let child_key = sheet.get_key(row, col);\n    if rem == 0 {\n        sheet.add_child(\u0026cell1, \u0026child_key);\n        sheet.add_child(\u0026cell2, \u0026child_key);\n    }\n    else if rem == 2 {\n        sheet.add_child(\u0026cell1, \u0026child_key);\n    }\n    else if rem == 3 {\n        sheet.add_child(\u0026cell2, \u0026child_key);\n    }\n    else {\n        // For range operations, use the optimized range_children structure\n        sheet.add_range_child(cell1, cell2, child_key);\n    }\n}\n\npub fn remove_all_parents(sheet: \u0026mut Spreadsheet, row: i16, col: i16) {\n    // This removes the child row, col from its parent cells\n    let child_key = sheet.get_key(row, col);\n    \n    let meta = match sheet.cell_meta.get(\u0026child_key) {\n        Some(meta) =\u003e meta,\n        None =\u003e return, // No metadata, no parents to remove\n    };\n    \n    if meta.formula == -1 {\n        return;\n    }\n    \n    let rem: i16 = (meta.formula % 10) as i16;\n    \n    if rem \u003e= 5 \u0026\u0026 rem \u003c= 9 {\n        // Use the optimized range_children removal for range operations\n        sheet.remove_range_child(child_key);\n    }\n    else if rem == 0 {\n        let parent1= meta.parent1;\n        let parent2 = meta.parent2;\n        sheet.remove_child(parent1, child_key);\n        sheet.remove_child(parent2, child_key);\n    }\n    else if rem == 2 {\n        sheet.remove_child(meta.parent1, child_key);\n    }\n    else if rem == 3 {\n        sheet.remove_child(meta.parent2, child_key);\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::spreadsheet::Spreadsheet;\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_add_children_both_parents() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        let child = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, parent2, 0, 1, 1); // Formula type 0\n        assert!(sheet.get_cell_children(parent1).unwrap().contains(\u0026child));\n        assert!(sheet.get_cell_children(parent2).unwrap().contains(\u0026child));\n    }\n\n    #[test]\n    fn test_add_children_single_parent() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let child = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, -1, 2, 1, 1); // Formula type 2\n        assert!(sheet.get_cell_children(parent1).unwrap().contains(\u0026child));\n        assert!(sheet.get_cell_children(-1).is_none());\n    }\n\n    #[test]\n    fn test_add_children_range() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, parent2, 5, 2, 2); // Formula type 5 (SUM)\n    }\n\n    #[test]\n    fn test_remove_all_parents_no_meta() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        remove_all_parents(\u0026mut sheet, 1, 1);\n        assert!(!sheet.cell_meta.contains_key(\u0026sheet.get_key(1, 1)));\n    }\n\n    #[test]\n    fn test_remove_all_parents_single_parent() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let child = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, -1, 2, 1, 1); \n        let meta = sheet.get_cell_meta(1, 1); \n        meta.parent1 = parent1;\n        meta.formula = 2; \n        remove_all_parents(\u0026mut sheet, 1, 1);\n        let children = sheet.get_cell_children(parent1);\n        assert!(children.is_none() || !children.unwrap().contains(\u0026child));\n    }\n\n    #[test]\n    fn test_remove_all_parents_range() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, parent2, 5, 2, 2); // adds range child\n        let meta = sheet.get_cell_meta(2, 2); \n        meta.parent1 = parent1;\n        meta.parent2 = parent2;\n        meta.formula = 5;\n        remove_all_parents(\u0026mut sheet, 2, 2);\n    }}","traces":[{"line":3,"address":[185664],"length":1,"stats":{"Line":1}},{"line":4,"address":[185745],"length":1,"stats":{"Line":1}},{"line":7,"address":[185761,185841],"length":1,"stats":{"Line":1}},{"line":8,"address":[185813],"length":1,"stats":{"Line":1}},{"line":9,"address":[185833],"length":1,"stats":{"Line":1}},{"line":10,"address":[185862],"length":1,"stats":{"Line":1}},{"line":11,"address":[185882],"length":1,"stats":{"Line":1}},{"line":13,"address":[185907],"length":1,"stats":{"Line":2}},{"line":14,"address":[185918],"length":1,"stats":{"Line":1}},{"line":16,"address":[185943],"length":1,"stats":{"Line":1}},{"line":17,"address":[185954],"length":1,"stats":{"Line":0}},{"line":21,"address":[185979],"length":1,"stats":{"Line":1}},{"line":25,"address":[186016],"length":1,"stats":{"Line":1}},{"line":27,"address":[186046],"length":1,"stats":{"Line":1}},{"line":29,"address":[186066],"length":1,"stats":{"Line":1}},{"line":30,"address":[186116],"length":1,"stats":{"Line":1}},{"line":34,"address":[186131],"length":1,"stats":{"Line":1}},{"line":38,"address":[186143,186197],"length":1,"stats":{"Line":1}},{"line":40,"address":[186189,186231],"length":1,"stats":{"Line":2}},{"line":42,"address":[186242],"length":1,"stats":{"Line":1}},{"line":44,"address":[186218],"length":1,"stats":{"Line":1}},{"line":45,"address":[186266],"length":1,"stats":{"Line":0}},{"line":46,"address":[186272],"length":1,"stats":{"Line":0}},{"line":47,"address":[186283],"length":1,"stats":{"Line":0}},{"line":48,"address":[186301],"length":1,"stats":{"Line":0}},{"line":50,"address":[186320],"length":1,"stats":{"Line":1}},{"line":51,"address":[186336],"length":1,"stats":{"Line":1}},{"line":53,"address":[186357],"length":1,"stats":{"Line":0}},{"line":54,"address":[186377],"length":1,"stats":{"Line":0}}],"covered":22,"coverable":29},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","main.rs"],"content":"mod cell;\nmod spreadsheet;\nmod evaluator;\nmod formula;\nmod graph;\nmod reevaluate_topo;\nmod visualize_cells;\nuse std::env;\nuse std::io::{self, Write};\nuse std::process;\nuse std::thread::sleep;\nuse std::time::{Duration, Instant};\n// use sys_info;  // Add the system information library\n\nuse spreadsheet::Spreadsheet;\nuse spreadsheet::CommandStatus;\nuse evaluator::handle_command;\n\n// Updated memory usage structure\n// struct MemoryUsage {\n//     physical_mem: u64,\n// }\n\n// Improved cross-platform memory usage function using sys-info crate\n// fn memory_stats() -\u003e Option\u003cMemoryUsage\u003e {\n//     match sys_info::mem_info() {\n//         Ok(mem_info) =\u003e {\n//             // Calculate memory used by the process\n//             // On most systems this returns the system-wide memory usage\n//             // For process-specific usage, we use a percentage estimate\n            \n//             // Calculate used memory in bytes\n//             let used_mem = (mem_info.total - mem_info.free) * 1024; // Convert KB to bytes\n            \n//             // Approximate the process memory as a fraction of total used memory\n//             // This is a rough estimate - actual process memory would require platform-specific code\n//             let process_estimate = used_mem / 50; // Assuming our process uses ~2% of used memory\n            \n//             Some(MemoryUsage {\n//                 physical_mem: process_estimate,\n//             })\n//         },\n//         Err(_) =\u003e {\n//             // Fallback if memory info retrieval fails\n//             Some(MemoryUsage {\n//                 physical_mem: 10 * 1024 * 1024, // 10 MB placeholder\n//             })\n//         }\n//     }\n// }\n\nfn main() {\n    let args: Vec\u003cString\u003e = env::args().collect();\n    if args.len() != 3 {\n        eprintln!(\"Usage: {} \u003crows\u003e \u003ccolumns\u003e\", args[0]);\n        process::exit(1);\n    }\n    \n    let rows: i16 = args[1].parse().unwrap_or_else(|_| {\n        eprintln!(\"Invalid number for rows\");\n        process::exit(1);\n    });\n\n    let cols: i16 = args[2].parse().unwrap_or_else(|_| {\n        eprintln!(\"Invalid number for columns\");\n        process::exit(1);\n    });\n        \n    let mut sleep_time = 0.0; // Initialize sleep time\n    let start = Instant::now();\n        \n    let mut sheet = match Spreadsheet::create(rows, cols) {\n        Some(s) =\u003e s,\n        None =\u003e {\n            eprintln!(\"Failed to create spreadsheet with dimensions {}x{}\", rows, cols);\n            eprintln!(\"Please try smaller dimensions.\");\n            process::exit(1);\n        }\n    };\n    let mut command_time = start.elapsed().as_secs_f64();\n    let mut last_time = command_time; // Update last_time with the command time\n    \n    // println!(\"Spreadsheet created in {:.2} seconds.\", command_time);\n    let mut last_status = \"ok\"; // Placeholder for last status\n    let mut input = String::with_capacity(128);\n    \n    // Main loop for command input\n    loop {\n        sheet.print_spreadsheet();\n        // if let Some(usage) = memory_stats() {\n        //     print!(\"[{:.1}s, {:.1}MB] ({}) \u003e \", last_time, usage.physical_mem as f64 / (1024.0 *1024.0), last_status);\n        // }\n        print!(\"[{:.1}s ({}) \u003e \", last_time, last_status);\n        io::stdout().flush().unwrap(); // Ensure the prompt is shown\n    \n        input.clear();\n        if io::stdin().read_line(\u0026mut input).unwrap() == 0 {\n            break; // End of input\n        }\n        \n        let trimmed = input.trim(); // Remove any newline characters\n        if trimmed == \"q\" {\n            break;\n        }\n        \n        // Process the command and measure execution time\n        let start = Instant::now();\n        // Pass by reference instead of cloning\n        let status = handle_command(\u0026mut sheet, trimmed, \u0026mut sleep_time);\n        command_time = start.elapsed().as_secs_f64();\n    \n        if sleep_time \u003c= command_time {\n            sleep_time = 0.0;\n        } else {\n            sleep_time -= command_time;\n        }\n        last_time = command_time + sleep_time;\n        if sleep_time \u003e 0.0 {\n            sleep(Duration::from_secs_f64(sleep_time));\n        }\n        sleep_time = 0.0;\n    \n        // Update last_status based on the current command status\n        last_status = match status {\n            CommandStatus::CmdOk =\u003e \"ok\",\n            CommandStatus::CmdUnrecognized =\u003e \"unrecognized_cmd\",\n            CommandStatus::CmdCircularRef =\u003e \"circular_ref\",\n            CommandStatus::CmdInvalidCell =\u003e \"invalid_cell\",\n        };\n    }\n}","traces":[{"line":52,"address":[176611,173456,176733],"length":1,"stats":{"Line":0}},{"line":53,"address":[173463],"length":1,"stats":{"Line":0}},{"line":54,"address":[173588,173525],"length":1,"stats":{"Line":0}},{"line":55,"address":[173629,176636],"length":1,"stats":{"Line":0}},{"line":56,"address":[176714],"length":1,"stats":{"Line":0}},{"line":59,"address":[173674,173594],"length":1,"stats":{"Line":0}},{"line":60,"address":[197275],"length":1,"stats":{"Line":0}},{"line":61,"address":[197315],"length":1,"stats":{"Line":0}},{"line":64,"address":[173814],"length":1,"stats":{"Line":0}},{"line":65,"address":[197355],"length":1,"stats":{"Line":0}},{"line":66,"address":[197395],"length":1,"stats":{"Line":0}},{"line":69,"address":[173997],"length":1,"stats":{"Line":0}},{"line":70,"address":[174009],"length":1,"stats":{"Line":0}},{"line":72,"address":[174065],"length":1,"stats":{"Line":0}},{"line":73,"address":[174157],"length":1,"stats":{"Line":0}},{"line":75,"address":[174147,174393],"length":1,"stats":{"Line":0}},{"line":76,"address":[174485],"length":1,"stats":{"Line":0}},{"line":77,"address":[174530],"length":1,"stats":{"Line":0}},{"line":80,"address":[174603,174337],"length":1,"stats":{"Line":0}},{"line":81,"address":[174660],"length":1,"stats":{"Line":0}},{"line":84,"address":[174678],"length":1,"stats":{"Line":0}},{"line":85,"address":[174718],"length":1,"stats":{"Line":0}},{"line":88,"address":[176570],"length":1,"stats":{"Line":0}},{"line":89,"address":[174735],"length":1,"stats":{"Line":0}},{"line":93,"address":[174862],"length":1,"stats":{"Line":0}},{"line":94,"address":[175326],"length":1,"stats":{"Line":0}},{"line":96,"address":[175579],"length":1,"stats":{"Line":0}},{"line":97,"address":[175586,175885],"length":1,"stats":{"Line":0}},{"line":101,"address":[175917],"length":1,"stats":{"Line":0}},{"line":102,"address":[175987],"length":1,"stats":{"Line":0}},{"line":107,"address":[176027],"length":1,"stats":{"Line":0}},{"line":109,"address":[176071],"length":1,"stats":{"Line":0}},{"line":110,"address":[176125],"length":1,"stats":{"Line":0}},{"line":112,"address":[176213,176268],"length":1,"stats":{"Line":0}},{"line":113,"address":[176270],"length":1,"stats":{"Line":0}},{"line":115,"address":[176237],"length":1,"stats":{"Line":0}},{"line":117,"address":[176283],"length":1,"stats":{"Line":0}},{"line":118,"address":[176310],"length":1,"stats":{"Line":0}},{"line":119,"address":[176375],"length":1,"stats":{"Line":0}},{"line":121,"address":[176329],"length":1,"stats":{"Line":0}},{"line":124,"address":[176341,176538],"length":1,"stats":{"Line":0}},{"line":125,"address":[176424],"length":1,"stats":{"Line":0}},{"line":126,"address":[176453],"length":1,"stats":{"Line":0}},{"line":127,"address":[176482],"length":1,"stats":{"Line":0}},{"line":128,"address":[176511],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":45},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","reevaluate_topo.rs"],"content":"use crate::spreadsheet::Spreadsheet;\nuse crate::cell::CellValue;\nuse std::collections::HashSet;\nuse crate::formula::{eval_max, eval_min, sum_value, eval_variance, eval_avg};\n\npub fn sleep_fn(sheet: \u0026mut Spreadsheet, row: i16, col: i16, value: i32, sleep_val: \u0026mut f64) {\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(value);\n    if value \u003c 0 {\n        return;\n    }\n    *sleep_val += value as f64;\n}\n\npub fn reevaluate_formula(sheet: \u0026mut Spreadsheet, row: i16, col: i16, sleep_val: \u0026mut f64) {\n\n    let cell_meta = sheet.get_cell_meta(row, col);\n    let rem = cell_meta.formula % 10;\n    let msb = cell_meta.formula / 10;\n    let parent1 = cell_meta.parent1;\n    let parent2 = cell_meta.parent2;\n\n    match rem {\n        0 =\u003e {\n            let par1 = sheet.get_key_cell(parent1);\n            let par2 = sheet.get_key_cell(parent2);\n            if CellValue::Error == *par1 || CellValue::Error == *par2 {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return;\n            }\n            if let CellValue::Integer(p1_value) = par1{\n                if let CellValue::Integer(p2_value) = par2 {\n                    match msb {\n                        1 =\u003e {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value + p2_value);\n                        }\n                        2 =\u003e {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value - p2_value);\n                        }\n                        4 =\u003e {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value * p2_value);\n                        }\n                        _ =\u003e {\n                            if *p2_value == 0 {\n                                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                            } else {\n                                *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value / p2_value);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        2 =\u003e {\n            let par1 = sheet.get_key_cell(parent1);\n            if CellValue::Error == *par1 {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return;\n            }\n            if let CellValue::Integer(p1_value) = par1 {\n                match msb {\n                    1 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value + parent2);\n                    }\n                    2 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value - parent2);\n                    }\n                    4 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value * parent2);\n                    }\n                    3 =\u003e {\n                        if parent2 == 0 {\n                            *sheet.get_mut_cell(row, col) = CellValue::Error;\n                        } else {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value / parent2);\n                        }\n                    }\n                    _ =\u003e {\n                        sleep_fn(sheet, row, col, *p1_value, sleep_val);\n                    }\n                }\n            }\n        }\n        3 =\u003e {\n            let par2 = sheet.get_key_cell(parent2);\n            if CellValue::Error == *par2 {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return;\n            }\n            if let CellValue::Integer(p2_value) = par2 {\n                match msb {\n                    1 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(parent1 + p2_value);\n                    }\n                    2 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(parent1 - p2_value);\n                    }\n                    4 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(parent1 * p2_value);\n                    }\n                    _ =\u003e {\n                        if *p2_value == 0 {\n                            *sheet.get_mut_cell(row, col) = CellValue::Error;\n                        } else {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(parent1 / p2_value);\n                        }\n                    }\n                }\n            }\n        }\n        5 =\u003e { sum_value(sheet, row, col, parent1, parent2); }\n        6 =\u003e { eval_avg(sheet, row, col, parent1, parent2); }\n        7 =\u003e { eval_min(sheet, row, col, parent1, parent2); }\n        8 =\u003e { eval_max(sheet, row, col, parent1, parent2); }\n        _ =\u003e { eval_variance(sheet, row, col, parent1, parent2); }\n    }\n}\n\npub fn toposort_reval_detect_cycle(sheet: \u0026mut Spreadsheet, row: i16, col: i16, sleep_val: \u0026mut f64) -\u003e bool {  \n    let cell_key = sheet.get_key(row, col); \n    // These collections will be used for the topological sort and cycle detection\n    let mut fully_visited: HashSet\u003ci32\u003e = HashSet::new();\n    let mut result: Vec\u003ci32\u003e = Vec::new();\n    let mut dfs_stack: Vec\u003c(i32, bool)\u003e = Vec::new();\n    let mut in_current_path: HashSet\u003ci32\u003e = HashSet::new();\n    \n    // Helper to push all dependents (both direct and range-based) for a given cell key\n    fn push_dependents(cell_key: i32, sheet: \u0026Spreadsheet, stack: \u0026mut Vec\u003c(i32, bool)\u003e, fully_visited: \u0026HashSet\u003ci32\u003e) {\n        // Direct children from standard dependencies\n        if let Some(children) = sheet.get_cell_children(cell_key) {\n            for child in children {\n                if !fully_visited.contains(child) {\n                    stack.push((*child, false));\n                }\n            }\n        }\n\n        for range_child in \u0026sheet.range_children {\n            if !fully_visited.contains(\u0026range_child.child_key) \u0026\u0026 sheet.is_cell_in_range(cell_key, range_child.start_key, range_child.end_key) {\n                stack.push((range_child.child_key, false));\n            }\n        }\n    }\n    \n    // Start from all direct children and range-based children of the updated cell\n    push_dependents(cell_key, sheet, \u0026mut dfs_stack, \u0026fully_visited);\n    \n    while let Some((current, expanded)) = dfs_stack.pop() {\n        if expanded {\n            // If we're processing a fully expanded node:\n            in_current_path.remove(\u0026current);\n            if !result.contains(\u0026current) {\n                result.push(current);\n            }\n            fully_visited.insert(current);\n        } else {\n            // If we haven't expanded this node yet:\n            if in_current_path.contains(\u0026current) {\n                // Cycle detected\n                // Debugging output\n                // println!(\"Cycle detected at cell: {}\", current);\n                // Uncomment the following line to see the cycle path\n                // println!(\"Cycle path: {:?}\", in_current_path);\n                return true;\n            }\n            \n            // Add back the current node as expanded\n            dfs_stack.push((current, true));\n            in_current_path.insert(current);\n            \n            // Process all its dependents (both direct and range-based)\n            push_dependents(current, sheet, \u0026mut dfs_stack, \u0026fully_visited);\n        }\n    }\n    \n    // Reverse the result to get the correct topological order\n    result.reverse();\n    \n    // Now reevaluate all cells in the topological order\n    for key in result {\n        if key \u003e= 0 {\n            let (row, col) = sheet.get_row_col(key);\n            reevaluate_formula(sheet, row, col, sleep_val);\n        }\n    }\n    \n    false // No cycle detected\n}\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::cell::CellValue;\n    use crate::evaluator::set_cell_value;\n    use crate::spreadsheet::{CommandStatus, Spreadsheet};\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_sleep_fn_positive() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        sleep_fn(\u0026mut sheet, 0, 0, 5, \u0026mut sleep_time);\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(5));\n        assert_eq!(sleep_time, 5.0);\n    }\n\n    #[test]\n    fn test_sleep_fn_negative() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        sleep_fn(\u0026mut sheet, 0, 0, -5, \u0026mut sleep_time);\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(-5));\n        assert_eq!(sleep_time, 0.0);\n    }\n\n    // #[test]\n    // fn test_reevaluate_formula_arithmetic() {\n    //     let mut sheet = create_test_spreadsheet(5, 5);\n    //     *sheet.get_mut_cell(0, 0) = CellValue::Integer(3);\n    //     *sheet.get_mut_cell(0, 1) = CellValue::Integer(2);\n    //     {\n    //         let meta = sheet.get_cell_meta_mut(1, 1);\n    //         meta.parent1 = sheet.get_key(0, 0);\n    //         meta.parent2 = sheet.get_key(0, 1);\n    //         meta.formula = 10; // Addition\n    //     }\n    //     let mut sleep_time = 0.0;\n    //     reevaluate_formula(\u0026mut sheet, 1, 1, \u0026mut sleep_time);\n    //     assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(5));\n    // }\n\n    // #[test]\n    // fn test_reevaluate_formula_arithmetic_div_zero() {\n    //     let mut sheet = create_test_spreadsheet(5, 5);\n    //     *sheet.get_mut_cell(0, 0) = CellValue::Integer(5);\n    //     *sheet.get_mut_cell(0, 1) = CellValue::Integer(0);\n    //     let meta = sheet.get_cell_meta(1, 1);\n    //     meta.parent1 = sheet.get_key(0, 0);\n    //     meta.parent2 = sheet.get_key(0, 1);\n    //     meta.formula = 30; // Division\n    //     let mut sleep_time = 0.0;\n    //     reevaluate_formula(\u0026mut sheet, 1, 1, \u0026mut sleep_time);\n    //     assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    // }\n\n    // #[test]\n    // fn test_reevaluate_formula_error() {\n    //     let mut sheet = create_test_spreadsheet(5, 5);\n    //     *sheet.get_mut_cell(0, 0) = CellValue::Error;\n    //     let meta = sheet.get_cell_meta(1, 1);\n    //     meta.parent1 = sheet.get_key(0, 0);\n    //     meta.parent2 = sheet.get_key(0, 1);\n    //     meta.formula = 10; // Addition\n    //     let mut sleep_time = 0.0;\n    //     reevaluate_formula(\u0026mut sheet, 1, 1, \u0026mut sleep_time);\n    //     assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    // }\n\n    // #[test]\n    // fn test_reevaluate_formula_sum() {\n    //     let mut sheet = create_test_spreadsheet(5, 5);\n    //     *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n    //     *sheet.get_mut_cell(0, 1) = CellValue::Integer(2);\n    //     let meta = sheet.get_cell_meta(1, 1);\n    //     meta.parent1 = sheet.get_key(0, 0);\n    //     meta.parent2 = sheet.get_key(0, 1);\n    //     meta.formula = 5; // SUM\n    //     let mut sleep_time = 0.0;\n    //     reevaluate_formula(\u0026mut sheet, 1, 1, \u0026mut sleep_time);\n    //     assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n    // }\n\n    #[test]\n    fn test_cycle_prevention() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        let mut sleep_time = 0.0;\n        assert_eq!(set_cell_value(\u0026mut sheet, 1, 1, \"A1\", \u0026mut sleep_time), CommandStatus::CmdOk);\n        assert_eq!(set_cell_value(\u0026mut sheet, 0, 0, \"B2\", \u0026mut sleep_time), CommandStatus::CmdCircularRef);\n        assert!(!toposort_reval_detect_cycle(\u0026mut sheet, 0, 0, \u0026mut sleep_time));\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(1)); // A1 unchanged\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(1)); // B2 still references A1\n    }\n\n    #[test]\n    fn test_toposort_reval_no_cycle() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        let mut sleep_time = 0.0;\n        set_cell_value(\u0026mut sheet, 1, 1, \"A1\", \u0026mut sleep_time);\n        assert!(!toposort_reval_detect_cycle(\u0026mut sheet, 1, 1, \u0026mut sleep_time));\n    }\n}","traces":[{"line":6,"address":[216304],"length":1,"stats":{"Line":1}},{"line":7,"address":[216350],"length":1,"stats":{"Line":1}},{"line":8,"address":[216390],"length":1,"stats":{"Line":1}},{"line":11,"address":[216404],"length":1,"stats":{"Line":1}},{"line":14,"address":[216432],"length":1,"stats":{"Line":1}},{"line":16,"address":[216507],"length":1,"stats":{"Line":1}},{"line":17,"address":[216534,216625],"length":1,"stats":{"Line":1}},{"line":18,"address":[216597,216659,216753],"length":1,"stats":{"Line":2}},{"line":19,"address":[216691],"length":1,"stats":{"Line":1}},{"line":20,"address":[216704],"length":1,"stats":{"Line":1}},{"line":22,"address":[216718],"length":1,"stats":{"Line":1}},{"line":24,"address":[216824],"length":1,"stats":{"Line":0}},{"line":25,"address":[216851],"length":1,"stats":{"Line":0}},{"line":26,"address":[217198,216874],"length":1,"stats":{"Line":0}},{"line":27,"address":[217237],"length":1,"stats":{"Line":0}},{"line":30,"address":[217285],"length":1,"stats":{"Line":0}},{"line":31,"address":[217320,217346],"length":1,"stats":{"Line":0}},{"line":32,"address":[217363],"length":1,"stats":{"Line":0}},{"line":33,"address":[217517],"length":1,"stats":{"Line":0}},{"line":34,"address":[217434],"length":1,"stats":{"Line":0}},{"line":36,"address":[217615],"length":1,"stats":{"Line":0}},{"line":37,"address":[217532],"length":1,"stats":{"Line":0}},{"line":39,"address":[217713],"length":1,"stats":{"Line":0}},{"line":40,"address":[217630],"length":1,"stats":{"Line":0}},{"line":43,"address":[217780,217410,217878],"length":1,"stats":{"Line":0}},{"line":44,"address":[217739],"length":1,"stats":{"Line":0}},{"line":46,"address":[217795],"length":1,"stats":{"Line":0}},{"line":54,"address":[216908],"length":1,"stats":{"Line":1}},{"line":55,"address":[216929],"length":1,"stats":{"Line":1}},{"line":56,"address":[217922],"length":1,"stats":{"Line":0}},{"line":59,"address":[217978,217888],"length":1,"stats":{"Line":2}},{"line":60,"address":[217995],"length":1,"stats":{"Line":1}},{"line":61,"address":[218176],"length":1,"stats":{"Line":0}},{"line":62,"address":[218093],"length":1,"stats":{"Line":0}},{"line":64,"address":[218273],"length":1,"stats":{"Line":0}},{"line":65,"address":[218190],"length":1,"stats":{"Line":0}},{"line":67,"address":[218370],"length":1,"stats":{"Line":0}},{"line":68,"address":[218287],"length":1,"stats":{"Line":0}},{"line":71,"address":[218446,218543,218379],"length":1,"stats":{"Line":0}},{"line":72,"address":[218405],"length":1,"stats":{"Line":0}},{"line":74,"address":[218460],"length":1,"stats":{"Line":0}},{"line":78,"address":[218066],"length":1,"stats":{"Line":1}},{"line":84,"address":[216963],"length":1,"stats":{"Line":0}},{"line":85,"address":[216984],"length":1,"stats":{"Line":0}},{"line":86,"address":[218587],"length":1,"stats":{"Line":0}},{"line":89,"address":[218643,218553],"length":1,"stats":{"Line":0}},{"line":90,"address":[218660],"length":1,"stats":{"Line":0}},{"line":91,"address":[218813],"length":1,"stats":{"Line":0}},{"line":92,"address":[218730],"length":1,"stats":{"Line":0}},{"line":94,"address":[218910],"length":1,"stats":{"Line":0}},{"line":95,"address":[218827],"length":1,"stats":{"Line":0}},{"line":97,"address":[219007],"length":1,"stats":{"Line":0}},{"line":98,"address":[218924],"length":1,"stats":{"Line":0}},{"line":101,"address":[218707,219171,219074],"length":1,"stats":{"Line":0}},{"line":102,"address":[219033],"length":1,"stats":{"Line":0}},{"line":104,"address":[219088],"length":1,"stats":{"Line":0}},{"line":110,"address":[217039],"length":1,"stats":{"Line":0}},{"line":111,"address":[217085],"length":1,"stats":{"Line":0}},{"line":112,"address":[217131],"length":1,"stats":{"Line":0}},{"line":113,"address":[217177],"length":1,"stats":{"Line":0}},{"line":114,"address":[216799],"length":1,"stats":{"Line":0}},{"line":118,"address":[219184,220437,220464],"length":1,"stats":{"Line":1}},{"line":119,"address":[219243],"length":1,"stats":{"Line":1}},{"line":121,"address":[219280],"length":1,"stats":{"Line":1}},{"line":122,"address":[219293],"length":1,"stats":{"Line":1}},{"line":123,"address":[219337],"length":1,"stats":{"Line":1}},{"line":124,"address":[219406],"length":1,"stats":{"Line":1}},{"line":127,"address":[220480],"length":1,"stats":{"Line":1}},{"line":129,"address":[220549],"length":1,"stats":{"Line":1}},{"line":130,"address":[220662,220598],"length":1,"stats":{"Line":2}},{"line":131,"address":[220735],"length":1,"stats":{"Line":1}},{"line":132,"address":[220754],"length":1,"stats":{"Line":1}},{"line":137,"address":[220772,220635,220835],"length":1,"stats":{"Line":2}},{"line":138,"address":[220855],"length":1,"stats":{"Line":0}},{"line":139,"address":[220906],"length":1,"stats":{"Line":0}},{"line":145,"address":[219472,219516],"length":1,"stats":{"Line":2}},{"line":147,"address":[219526],"length":1,"stats":{"Line":1}},{"line":148,"address":[219621],"length":1,"stats":{"Line":1}},{"line":150,"address":[219698],"length":1,"stats":{"Line":1}},{"line":151,"address":[219901],"length":1,"stats":{"Line":1}},{"line":152,"address":[219957,220005],"length":1,"stats":{"Line":2}},{"line":154,"address":[220007,219986],"length":1,"stats":{"Line":2}},{"line":157,"address":[219712,219671],"length":1,"stats":{"Line":2}},{"line":163,"address":[219752],"length":1,"stats":{"Line":1}},{"line":167,"address":[219718],"length":1,"stats":{"Line":1}},{"line":168,"address":[219772],"length":1,"stats":{"Line":1}},{"line":171,"address":[219799],"length":1,"stats":{"Line":1}},{"line":176,"address":[220022,219635],"length":1,"stats":{"Line":2}},{"line":179,"address":[220229,220271,220029],"length":1,"stats":{"Line":3}},{"line":180,"address":[220289],"length":1,"stats":{"Line":1}},{"line":181,"address":[220366],"length":1,"stats":{"Line":1}},{"line":182,"address":[220419],"length":1,"stats":{"Line":1}},{"line":186,"address":[220299],"length":1,"stats":{"Line":1}}],"covered":46,"coverable":93},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","spreadsheet.rs"],"content":"use std::cmp::min;\nuse std::collections::HashMap;\nuse std::collections::HashSet;\nuse crate::cell::{CellValue, parse_cell_reference}; \nuse crate::visualize_cells;\n\n\n// Constants\nconst MAX_ROWS: i16 = 999;    // Maximum number of rows in the spreadsheet   \nconst MAX_COLS: i16 = 18278;  // Maximum number of columns in the spreadsheet\n\n// Structure to represent a range-based child relationship\n#[derive(Debug, Clone, PartialEq, Eq, Hash)]\npub struct RangeChild {\n    pub start_key: i32,       // Range start cell key\n    pub end_key: i32,         // Range end cell key\n    pub child_key: i32,       // Child cell key\n}\n\n#[derive(Debug, PartialEq)]\npub enum CommandStatus {\n    CmdOk,\n    CmdUnrecognized,\n    CmdCircularRef,\n    CmdInvalidCell,\n}\n\n// Modified CellMeta to remove children (they're now stored separately)\n#[derive(Debug, Clone)]\npub struct CellMeta {\n    pub formula: i16,\n    pub parent1: i32,\n    pub parent2: i32,\n}\n\nimpl CellMeta {\n    pub fn new() -\u003e Self {\n        CellMeta {\n            formula: -1,\n            parent1: -1,\n            parent2: -1,\n        }\n    }\n}\n\n// Spreadsheet structure with HashMap of boxed HashSets for children\npub struct Spreadsheet {\n    pub grid: Vec\u003cCellValue\u003e,                                // Vector of CellValues (contiguous in memory)\n    pub children: HashMap\u003ci32, Box\u003cHashSet\u003ci32\u003e\u003e\u003e,           // Map from cell key to boxed HashSet of children\n    pub range_children: Vec\u003cRangeChild\u003e,                     // Vector of range-based child relationships\n    pub cell_meta: HashMap\u003ci32, CellMeta\u003e,                   // Map from cell key to metadata\n    pub rows: i16,\n    pub cols: i16,\n    pub viewport_row: i16,\n    pub viewport_col: i16,\n    pub output_enabled: bool,\n}\n\nimpl Spreadsheet {\n    // Create a new spreadsheet with specified dimensions\n    pub fn create(rows: i16, cols: i16) -\u003e Option\u003cSpreadsheet\u003e {\n        if rows \u003c 1 || rows \u003e MAX_ROWS || cols \u003c 1 || cols \u003e MAX_COLS {\n            eprintln!(\"Invalid spreadsheet dimensions\");\n            return None;\n        }\n        \n        // Create empty cells - initialize with Integer(0)\n        let total = rows as usize * cols as usize;\n        let grid = vec![CellValue::Integer(0); total];\n                \n        Some(Spreadsheet {\n            grid,\n            children: HashMap::new(),\n            range_children: Vec::with_capacity(32), // Preallocate with initial size\n            cell_meta: HashMap::new(),\n            rows,\n            cols,\n            viewport_row: 0,\n            viewport_col: 0,\n            output_enabled: true,\n        })\n    }\n\n    // Helper to get cell key from coordinates\n    pub fn get_key(\u0026self, row: i16, col: i16) -\u003e i32 {\n        (row as i32 * self.cols as i32 + col as i32) as i32\n    }\n    \n    // Helper to get coordinates from cell key\n    pub fn get_row_col(\u0026self, key: i32) -\u003e (i16, i16) {\n        let row = (key / (self.cols as i32)) as i16;\n        let col = (key % (self.cols as i32)) as i16;\n        (row, col)\n    }\n\n    // Helper to get index from row and column\n    fn get_index(\u0026self, row: i16, col: i16) -\u003e usize {\n        (row as usize) * (self.cols as usize) + (col as usize)\n    }\n    \n    // Get cell metadata, creating it if it doesn't exist\n    pub fn get_cell_meta(\u0026mut self, row: i16, col: i16) -\u003e \u0026mut CellMeta {\n        let key = self.get_key(row, col);\n        self.cell_meta.entry(key).or_insert_with(CellMeta::new)\n    }\n\n    pub fn get_column_name(\u0026self, mut col: i16) -\u003e String {\n        // Pre-calculate the length needed for the string\n        let mut temp_col = col + 1; // Convert from 0-based to 1-based\n        let mut len = 0;\n        while temp_col \u003e 0 {\n            len += 1;\n            temp_col = (temp_col - 1) / 26;\n        }\n             \n        // Add column letters directly in reverse order\n        col += 1; // Convert from 0-based to 1-based\n        \n        // Handle special case for col = 0\n        if col == 0 {\n            return \"A\".to_string();\n        }\n        \n        // Create a buffer of bytes to avoid repeated string operations\n        let mut buffer = vec![0; len];\n        let mut i = len;\n        \n        while col \u003e 0 {\n            i -= 1;\n            buffer[i] = b'A' + ((col - 1) % 26) as u8;\n            col = (col - 1) / 26;\n        }\n        \n        // Convert the byte buffer to a string in one operation\n        unsafe {\n            // This is safe because we know our bytes are valid ASCII from b'A' to b'Z'\n            String::from_utf8_unchecked(buffer)\n        }\n    }\n\n    pub fn column_name_to_index(\u0026self, name: \u0026str) -\u003e i16 {\n        let bytes = name.as_bytes();\n        let mut index: i16 = 0;\n        for \u0026b in bytes {\n                        index = index * 26 + ((b - b'A') as i16 + 1);\n        }\n        index - 1 // Convert from 1-based to 0-based\n    }\n\n    pub fn get_cell(\u0026self, row: i16, col: i16) -\u003e \u0026CellValue {\n        let index = self.get_index(row, col);\n        \u0026self.grid[index]\n    }\n    \n    pub fn get_key_cell(\u0026self, cell_key: i32) -\u003e \u0026CellValue {\n        \u0026self.grid[cell_key as usize]\n    }\n\n    pub fn get_mut_cell(\u0026mut self, row: i16, col: i16) -\u003e \u0026mut CellValue {\n        let index = self.get_index(row, col);\n        \u0026mut self.grid[index]\n    }\n    \n    // Add a range-based child relationship\n    pub fn add_range_child(\u0026mut self, start_key: i32, end_key: i32, child_key: i32) {\n        self.range_children.push(RangeChild {\n            start_key,\n            end_key,\n            child_key,\n        });\n    }\n    \n    // Remove range-based child relationships for a given child\n    pub fn remove_range_child(\u0026mut self, child_key: i32) {\n        self.range_children.retain(|rc| rc.child_key != child_key);\n    }\n    \n    // Check if a cell is within a range\n    pub fn is_cell_in_range(\u0026self, cell_key: i32, start_key: i32, end_key: i32) -\u003e bool {\n        let (cell_row, cell_col) = self.get_row_col(cell_key);\n        let (start_row, start_col) = self.get_row_col(start_key);\n        let (end_row, end_col) = self.get_row_col(end_key);\n        \n        cell_row \u003e= start_row \u0026\u0026 cell_row \u003c= end_row \u0026\u0026 \n        cell_col \u003e= start_col \u0026\u0026 cell_col \u003c= end_col\n    }\n    \n    // Add a child to a cell's dependents (modified for HashMap of boxed HashSets)\n    pub fn add_child(\u0026mut self, parent_key: \u0026i32, child_key: \u0026i32) {\n        self.children\n            .entry(*parent_key)\n            .or_insert_with(|| Box::new(HashSet::with_capacity(5)))\n            .insert(*child_key);\n    }\n    \n    // Remove a child from a cell's dependents (modified for HashMap of boxed HashSets)\n    pub fn remove_child(\u0026mut self, parent_key: i32, child_key: i32) {\n        if let Some(children) = self.children.get_mut(\u0026parent_key) {\n            children.remove(\u0026child_key);\n            \n            // If the hashset is now empty, remove it from the HashMap to save memory\n            if children.is_empty() {\n                self.children.remove(\u0026parent_key);\n            }\n        }\n    }\n      \n    // Get children for a cell (immutable) (modified for HashMap of boxed HashSets)\n    pub fn get_cell_children(\u0026self, key: i32) -\u003e Option\u003c\u0026HashSet\u003ci32\u003e\u003e {\n        self.children.get(\u0026key).map(|boxed_set| boxed_set.as_ref())\n    }\n\n    pub fn print_spreadsheet(\u0026self) {\n        if !self.output_enabled {\n            return;\n        }\n        \n        let start_row = self.viewport_row;\n        let start_col = self.viewport_col;\n        let display_row = min(self.rows - start_row, 10); // Display only a portion of the spreadsheet\n        let display_col = min(self.cols - start_col, 10);\n        \n        // Print column headers\n        print!(\"     \");\n        for i in 0..display_col {\n            print!(\"{:\u003c8} \", self.get_column_name(start_col + i));\n        }\n        println!();\n        \n        // Print rows with data\n        for i in 0..display_row {\n            print!(\"{:\u003c4} \", start_row + i + 1); // Show 1-based row numbers\n            for j in 0..display_col {\n                let cell_value = self.get_cell(start_row + i, start_col + j); \n                match cell_value {\n                    CellValue::Integer(value) =\u003e print!(\"{:\u003c8} \", value),\n                    CellValue::Error =\u003e print!(\"{:\u003c8} \", \"ERR\"),\n                }\n            }\n            println!();\n        }\n    }\n\n    pub fn scroll_to_cell(\u0026mut self, cell: \u0026str) -\u003e CommandStatus {\n        match parse_cell_reference(self, cell) {\n            Ok((row, col)) =\u003e {\n                if row \u003e= 0 \u0026\u0026 row \u003c self.rows \u0026\u0026 col \u003e= 0 \u0026\u0026 col \u003c self.cols {\n                    self.viewport_row = row;\n                    self.viewport_col = col;\n                    return CommandStatus::CmdOk;\n                } else {\n                    return CommandStatus::CmdInvalidCell;\n                }\n            }\n            Err(_) =\u003e {\n                return CommandStatus::CmdUnrecognized;\n            }\n        }\n    }\n\n    pub fn scroll_viewport(\u0026mut self, direction: char) {\n        const VIEWPORT_SIZE: i16 = 10;\n        match direction {\n            'w' =\u003e {\n                self.viewport_row = if self.viewport_row \u003e 10 {\n                    self.viewport_row - 10\n                } else {\n                    0\n                };\n            }\n            's' =\u003e {\n                if self.viewport_row + VIEWPORT_SIZE \u003c self.rows {\n                    self.viewport_row += 10;\n                } else {\n                    self.viewport_row = self.rows - VIEWPORT_SIZE;\n                }\n            }\n            'a' =\u003e {\n                self.viewport_col = if self.viewport_col \u003e 10 {\n                    self.viewport_col - 10\n                } else {\n                    0\n                };\n            }\n\n            'd' =\u003e {\n                if self.viewport_col + VIEWPORT_SIZE \u003c self.cols {\n                    self.viewport_col += 10;\n                } else {\n                    self.viewport_col = self.cols - VIEWPORT_SIZE;\n                }\n            }\n            _ =\u003e {} // Invalid direction, do nothing\n        }\n    }\n    \n    pub fn visualize_cell_relationships(\u0026self, row: i16, col: i16) -\u003e CommandStatus {\n        // Check if the cell is valid\n        visualize_cells::visualize_cell_relationships(self,row, col)\n    }\n}\n\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::cell::CellValue;\n\n    #[test]\n    fn test_create_valid_dimensions() {\n        let sheet = Spreadsheet::create(5, 5).unwrap();\n        assert_eq!(sheet.rows, 5);\n        assert_eq!(sheet.cols, 5);\n        assert_eq!(sheet.grid.len(), 25);\n        assert_eq!(sheet.viewport_row, 0);\n        assert_eq!(sheet.viewport_col, 0);\n    }\n\n    #[test]\n    fn test_create_invalid_dimensions() {\n        assert!(Spreadsheet::create(0, 5).is_none());\n        assert!(Spreadsheet::create(5, 0).is_none());\n        assert!(Spreadsheet::create(MAX_ROWS + 1, 5).is_none());\n        assert!(Spreadsheet::create(5, MAX_COLS + 1).is_none());\n    }\n\n    #[test]\n    fn test_get_column_name() {\n        let sheet = Spreadsheet::create(1, 1).unwrap();\n        assert_eq!(sheet.get_column_name(0), \"A\");\n        assert_eq!(sheet.get_column_name(25), \"Z\");\n        assert_eq!(sheet.get_column_name(26), \"AA\");\n        assert_eq!(sheet.get_column_name(51), \"AZ\");\n    }\n\n    #[test]\n    fn test_column_name_to_index() {\n        let sheet = Spreadsheet::create(1, 1).unwrap();\n        assert_eq!(sheet.column_name_to_index(\"A\"), 0);\n        assert_eq!(sheet.column_name_to_index(\"Z\"), 25);\n        assert_eq!(sheet.column_name_to_index(\"AA\"), 26);\n        assert_eq!(sheet.column_name_to_index(\"AZ\"), 51);\n    }\n\n    #[test]\n    fn test_get_cell_and_get_mut_cell() {\n        let mut sheet = Spreadsheet::create(2, 2).unwrap();\n        let cell_value = sheet.get_mut_cell(0, 0);\n        *cell_value = CellValue::Integer(42);\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(42));\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(0));\n    }\n\n    #[test]\n    fn test_get_key_and_row_col() {\n        let sheet = Spreadsheet::create(5, 5).unwrap();\n        let key = sheet.get_key(2, 3);\n        let (row, col) = sheet.get_row_col(key);\n        assert_eq!(row, 2);\n        assert_eq!(col, 3);\n    }\n\n    #[test]\n    fn test_get_cell_meta() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        let meta = sheet.get_cell_meta(1, 1);\n        assert_eq!(meta.formula, -1);\n        assert_eq!(meta.parent1, -1);\n        assert_eq!(meta.parent2, -1);\n        meta.formula = 10;\n        assert_eq!(sheet.get_cell_meta(1, 1).formula, 10);\n    }\n\n    #[test]\n    fn test_add_remove_child() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        let parent = sheet.get_key(0, 0);\n        let child = sheet.get_key(1, 1);\n        sheet.add_child(\u0026parent, \u0026child);\n        assert!(sheet.get_cell_children(parent).unwrap().contains(\u0026child));\n        sheet.remove_child(parent, child);\n        assert!(sheet.get_cell_children(parent).is_none());\n    }\n\n    #[test]\n    fn test_is_cell_in_range() {\n        let sheet = Spreadsheet::create(5, 5).unwrap();\n        let cell_key = sheet.get_key(1, 1);\n        let start_key = sheet.get_key(0, 0);\n        let end_key = sheet.get_key(2, 2);\n        assert!(sheet.is_cell_in_range(cell_key, start_key, end_key));\n        assert!(!sheet.is_cell_in_range(cell_key, end_key, start_key));\n    }\n\n    #[test]\n    fn test_scroll_to_cell_valid() {\n        let mut sheet = Spreadsheet::create(20, 20).unwrap();\n        let status = sheet.scroll_to_cell(\"B2\");\n        assert_eq!(status, CommandStatus::CmdOk);\n        assert_eq!(sheet.viewport_row, 1);\n        assert_eq!(sheet.viewport_col, 1);\n    }\n\n    #[test]\n    fn test_scroll_to_cell_invalid() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        assert_eq!(sheet.scroll_to_cell(\"F6\"), CommandStatus::CmdInvalidCell);\n        assert_eq!(sheet.scroll_to_cell(\"1A\"), CommandStatus::CmdUnrecognized);\n    }\n\n    #[test]\n    fn test_scroll_viewport() {\n        let mut sheet = Spreadsheet::create(50, 50).unwrap();\n        sheet.scroll_viewport('s');\n        assert_eq!(sheet.viewport_row, 10);\n        sheet.scroll_viewport('d');\n        assert_eq!(sheet.viewport_col, 10);\n        sheet.scroll_viewport('w');\n        assert_eq!(sheet.viewport_row, 0);\n        sheet.scroll_viewport('a');\n        assert_eq!(sheet.viewport_col, 0);\n        sheet.viewport_row = 45;\n        sheet.scroll_viewport('s');\n        assert_eq!(sheet.viewport_row, 40);\n    }\n\n    #[test]\n    fn test_print_spreadsheet_disabled() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        sheet.output_enabled = false;\n        sheet.print_spreadsheet(); // Should not panic\n    }\n\n    #[test]\n    fn test_print_spreadsheet_with_values() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(42);\n        *sheet.get_mut_cell(1, 1) = CellValue::Error;\n        sheet.output_enabled = true;\n        sheet.print_spreadsheet(); // Should not panic\n    }\n}","traces":[{"line":37,"address":[264720],"length":1,"stats":{"Line":1}},{"line":61,"address":[264752,265421],"length":1,"stats":{"Line":11}},{"line":62,"address":[264801,264875],"length":1,"stats":{"Line":22}},{"line":63,"address":[264818],"length":1,"stats":{"Line":1}},{"line":64,"address":[264852],"length":1,"stats":{"Line":1}},{"line":68,"address":[264902,265018],"length":1,"stats":{"Line":11}},{"line":69,"address":[264934],"length":1,"stats":{"Line":11}},{"line":71,"address":[265190],"length":1,"stats":{"Line":11}},{"line":72,"address":[264975],"length":1,"stats":{"Line":11}},{"line":73,"address":[265011],"length":1,"stats":{"Line":11}},{"line":74,"address":[265074],"length":1,"stats":{"Line":11}},{"line":75,"address":[265146],"length":1,"stats":{"Line":11}},{"line":85,"address":[265456],"length":1,"stats":{"Line":1}},{"line":86,"address":[265556,265486],"length":1,"stats":{"Line":1}},{"line":90,"address":[265584],"length":1,"stats":{"Line":1}},{"line":91,"address":[265606,265715],"length":1,"stats":{"Line":1}},{"line":92,"address":[265804,265697,265739],"length":1,"stats":{"Line":2}},{"line":97,"address":[265824],"length":1,"stats":{"Line":4}},{"line":98,"address":[265932,265854],"length":1,"stats":{"Line":4}},{"line":102,"address":[265952],"length":1,"stats":{"Line":1}},{"line":103,"address":[265982],"length":1,"stats":{"Line":1}},{"line":104,"address":[266004],"length":1,"stats":{"Line":1}},{"line":107,"address":[266764,266789,266048],"length":1,"stats":{"Line":1}},{"line":109,"address":[266081,266130],"length":1,"stats":{"Line":1}},{"line":110,"address":[266119],"length":1,"stats":{"Line":1}},{"line":111,"address":[266901,266128,266146],"length":1,"stats":{"Line":3}},{"line":112,"address":[266176,266830,266803],"length":1,"stats":{"Line":2}},{"line":113,"address":[266851,266808,266906],"length":1,"stats":{"Line":2}},{"line":117,"address":[266209,266224,266154],"length":1,"stats":{"Line":2}},{"line":120,"address":[266214],"length":1,"stats":{"Line":1}},{"line":121,"address":[266245],"length":1,"stats":{"Line":0}},{"line":125,"address":[266264],"length":1,"stats":{"Line":1}},{"line":126,"address":[266296],"length":1,"stats":{"Line":1}},{"line":128,"address":[266321,266306,266738],"length":1,"stats":{"Line":3}},{"line":129,"address":[266490,266379,266463],"length":1,"stats":{"Line":2}},{"line":130,"address":[266510,266468],"length":1,"stats":{"Line":2}},{"line":131,"address":[266743,266658],"length":1,"stats":{"Line":1}},{"line":137,"address":[266334],"length":1,"stats":{"Line":1}},{"line":141,"address":[266928],"length":1,"stats":{"Line":5}},{"line":142,"address":[266989],"length":1,"stats":{"Line":7}},{"line":143,"address":[266999],"length":1,"stats":{"Line":7}},{"line":144,"address":[267280,267006,267084],"length":1,"stats":{"Line":21}},{"line":145,"address":[267099,267156,267285],"length":1,"stats":{"Line":14}},{"line":147,"address":[267062,267136],"length":1,"stats":{"Line":7}},{"line":150,"address":[267312],"length":1,"stats":{"Line":1}},{"line":151,"address":[267342],"length":1,"stats":{"Line":1}},{"line":152,"address":[267366],"length":1,"stats":{"Line":1}},{"line":155,"address":[267392],"length":1,"stats":{"Line":1}},{"line":156,"address":[267405],"length":1,"stats":{"Line":1}},{"line":159,"address":[267440],"length":1,"stats":{"Line":4}},{"line":160,"address":[267470],"length":1,"stats":{"Line":4}},{"line":161,"address":[267494],"length":1,"stats":{"Line":4}},{"line":165,"address":[267520],"length":1,"stats":{"Line":1}},{"line":166,"address":[267541],"length":1,"stats":{"Line":1}},{"line":174,"address":[267584],"length":1,"stats":{"Line":1}},{"line":175,"address":[231248,231258],"length":1,"stats":{"Line":3}},{"line":179,"address":[267616],"length":1,"stats":{"Line":1}},{"line":180,"address":[267650],"length":1,"stats":{"Line":1}},{"line":181,"address":[267684],"length":1,"stats":{"Line":1}},{"line":182,"address":[267718],"length":1,"stats":{"Line":1}},{"line":184,"address":[267756],"length":1,"stats":{"Line":1}},{"line":185,"address":[267793],"length":1,"stats":{"Line":1}},{"line":189,"address":[267840],"length":1,"stats":{"Line":1}},{"line":190,"address":[267875,267904,267869],"length":1,"stats":{"Line":5}},{"line":191,"address":[267873],"length":1,"stats":{"Line":1}},{"line":192,"address":[231280,231391,231294],"length":1,"stats":{"Line":3}},{"line":193,"address":[267902],"length":1,"stats":{"Line":1}},{"line":197,"address":[267920],"length":1,"stats":{"Line":1}},{"line":198,"address":[267942],"length":1,"stats":{"Line":1}},{"line":199,"address":[268001],"length":1,"stats":{"Line":1}},{"line":202,"address":[268018],"length":1,"stats":{"Line":1}},{"line":203,"address":[268040],"length":1,"stats":{"Line":1}},{"line":209,"address":[268080],"length":1,"stats":{"Line":1}},{"line":210,"address":[231408,231417],"length":1,"stats":{"Line":3}},{"line":213,"address":[268128,270264],"length":1,"stats":{"Line":2}},{"line":214,"address":[268148],"length":1,"stats":{"Line":2}},{"line":218,"address":[268170],"length":1,"stats":{"Line":1}},{"line":219,"address":[268190],"length":1,"stats":{"Line":1}},{"line":220,"address":[268210,268300],"length":1,"stats":{"Line":1}},{"line":221,"address":[268321,268409,268276],"length":1,"stats":{"Line":2}},{"line":224,"address":[268347],"length":1,"stats":{"Line":1}},{"line":225,"address":[268425,268541,268381],"length":1,"stats":{"Line":3}},{"line":226,"address":[268557,269883],"length":1,"stats":{"Line":2}},{"line":228,"address":[268468],"length":1,"stats":{"Line":1}},{"line":231,"address":[268508,268581],"length":1,"stats":{"Line":2}},{"line":232,"address":[268654,269035],"length":1,"stats":{"Line":1}},{"line":233,"address":[269007,269144,269051],"length":1,"stats":{"Line":3}},{"line":234,"address":[269275,269165],"length":1,"stats":{"Line":1}},{"line":235,"address":[269262],"length":1,"stats":{"Line":1}},{"line":236,"address":[269296],"length":1,"stats":{"Line":1}},{"line":237,"address":[269591],"length":1,"stats":{"Line":1}},{"line":240,"address":[269094],"length":1,"stats":{"Line":1}},{"line":244,"address":[270288],"length":1,"stats":{"Line":1}},{"line":245,"address":[270312],"length":1,"stats":{"Line":1}},{"line":246,"address":[270365],"length":1,"stats":{"Line":1}},{"line":247,"address":[270395,270427],"length":1,"stats":{"Line":2}},{"line":248,"address":[270481],"length":1,"stats":{"Line":1}},{"line":249,"address":[270488],"length":1,"stats":{"Line":1}},{"line":250,"address":[270495],"length":1,"stats":{"Line":1}},{"line":252,"address":[270410],"length":1,"stats":{"Line":1}},{"line":256,"address":[270403],"length":1,"stats":{"Line":1}},{"line":261,"address":[270512],"length":1,"stats":{"Line":1}},{"line":263,"address":[270532],"length":1,"stats":{"Line":1}},{"line":264,"address":[270744],"length":1,"stats":{"Line":1}},{"line":265,"address":[270578,270695,270759,270732],"length":1,"stats":{"Line":3}},{"line":266,"address":[270702,270761,270754],"length":1,"stats":{"Line":0}},{"line":268,"address":[270688],"length":1,"stats":{"Line":1}},{"line":272,"address":[270595,270787,270929,270891],"length":1,"stats":{"Line":4}},{"line":273,"address":[270922,270849,270934],"length":1,"stats":{"Line":2}},{"line":275,"address":[270819,270896,270884],"length":1,"stats":{"Line":2}},{"line":278,"address":[271006],"length":1,"stats":{"Line":1}},{"line":279,"address":[270994,270632,270957,271021],"length":1,"stats":{"Line":3}},{"line":280,"address":[271023,271016,270964],"length":1,"stats":{"Line":0}},{"line":282,"address":[270950],"length":1,"stats":{"Line":1}},{"line":287,"address":[271152,270656,271189,271049],"length":1,"stats":{"Line":3}},{"line":288,"address":[271194,271111,271182],"length":1,"stats":{"Line":2}},{"line":290,"address":[271081,271145,271157],"length":1,"stats":{"Line":0}},{"line":297,"address":[271216],"length":1,"stats":{"Line":1}},{"line":299,"address":[271241],"length":1,"stats":{"Line":1}}],"covered":115,"coverable":119},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","visualize_cells.rs"],"content":"use crate::spreadsheet::{Spreadsheet, CommandStatus};\nuse crate::cell::CellValue;\nuse petgraph::{\n    dot::{Config, Dot},\n    graph::{DiGraph, NodeIndex},\n};\nuse std::collections::{HashMap, HashSet};\nuse std::{fs::File, io::Write, process::Command};\n\npub fn visualize_cell_relationships(\n    spreadsheet: \u0026Spreadsheet,\n    row: i16,\n    col: i16,\n) -\u003e CommandStatus {\n    // ...move the entire body of the function from spreadsheet.rs here, replacing `spreadsheet` with `spreadsheet`...\n    if row \u003c 0 || row \u003e= spreadsheet.rows || col \u003c 0 || col \u003e= spreadsheet.cols {\n        return CommandStatus::CmdInvalidCell;\n    }\n\n    // Get the cell key\n    let cell_key = spreadsheet.get_key(row, col);\n    \n    // Create a directed graph for visualization\n    let mut graph = DiGraph::\u003cString, \u0026str\u003e::new();\n    let mut node_indices = HashMap::new();\n\n    // Function to get formatted cell name\n    let get_cell_label = |key: i32| -\u003e String {\n        let (r, c) = spreadsheet.get_row_col(key);\n        let col_name = spreadsheet.get_column_name(c);\n        format!(\"{}{} ({})\", col_name, r + 1, match spreadsheet.grid[key as usize] {\n            CellValue::Integer(val) =\u003e val.to_string(),\n            CellValue::Error =\u003e \"ERROR\".to_string(),\n        })\n    };\n\n    // Add the target cell to the graph\n    let target_label = get_cell_label(cell_key);\n    let target_node = graph.add_node(target_label.clone());\n    node_indices.insert(cell_key, target_node);\n\n    // Helper function to process relationships\n    fn process_relationships(\n        spreadsheet: \u0026Spreadsheet,\n        start_key: i32, \n        is_parent_direction: bool,\n        processed: \u0026mut HashSet\u003ci32\u003e,\n        depth_limit: usize,\n        graph: \u0026mut DiGraph\u003cString, \u0026str\u003e,\n        node_indices: \u0026mut HashMap\u003ci32, NodeIndex\u003e,\n        get_cell_label: \u0026dyn Fn(i32) -\u003e String,\n    ) {\n        if !processed.insert(start_key) {\n            return; // Already processed this cell\n        }\n        \n\n        // Add appropriate relationships based on direction\n        if is_parent_direction {\n            // Add parents - traverse up the dependency tree\n            if let Some(meta) = spreadsheet.cell_meta.get(\u0026start_key) {\n               \n\n                for parent_key in [meta.parent1, meta.parent2].iter()\n                                .filter(|\u0026\u0026k| k \u003e= 0) {\n                    \n                    // Create parent node if it doesn't exist\n                    let parent_idx = if let Some(\u0026idx) = node_indices.get(parent_key) {\n                        idx\n                    } else {\n                        let parent_label = get_cell_label(*parent_key);\n                        let idx = graph.add_node(parent_label);\n                        node_indices.insert(*parent_key, idx);\n                        idx\n                    };\n                    \n                    // Add edge from parent to child\n                    let child_idx = node_indices[\u0026start_key];\n                    graph.add_edge(parent_idx, child_idx, \"depends on\");\n                    \n                    // Recurse for this parent (up to the depth limit)\n                    if processed.len() \u003c depth_limit {\n                        process_relationships(\n                            spreadsheet,\n                            *parent_key, \n                            true, \n                            processed, \n                            depth_limit,\n                            graph,\n                            node_indices,\n                            get_cell_label\n                        );\n                    }\n                }\n            }\n        } else {\n            // Add children - traverse down the dependency tree\n            if let Some(children) = spreadsheet.get_cell_children(start_key) {\n            \n                for \u0026child_key in children {\n                    // Create child node if it doesn't exist\n                    let child_idx = if let Some(\u0026idx) = node_indices.get(\u0026child_key) {\n                        idx\n                    } else {\n                        let child_label = get_cell_label(child_key);\n                        let idx = graph.add_node(child_label);\n                        node_indices.insert(child_key, idx);\n                        idx\n                    };\n                    \n                    // Add edge from parent to child\n                    let parent_idx = node_indices[\u0026start_key];\n                    graph.add_edge(parent_idx, child_idx, \"used by\");\n                    \n                    // Recurse for this child (up to the depth limit)\n                    if processed.len() \u003c depth_limit {\n                        process_relationships(\n                            spreadsheet,\n                            child_key, \n                            false, \n                            processed, \n                            depth_limit,\n                            graph,\n                            node_indices,\n                            get_cell_label\n                        );\n                    }\n                }\n            }\n        }\n        \n    }\n\n    // Process parents (upward traversal)\n    let mut processed = HashSet::new();\n     // Mark target cell as processed\n    process_relationships(\n        spreadsheet,\n        cell_key, \n        true, \n        \u0026mut processed, \n        20,\n        \u0026mut graph,\n        \u0026mut node_indices,\n        \u0026get_cell_label\n    );\n    \n    // Process children (downward traversal)\n    let mut processed = HashSet::new();\n     // Mark target cell as processed\n    process_relationships(\n        spreadsheet,\n        cell_key, \n        false, \n        \u0026mut processed, \n        20,\n        \u0026mut graph,\n        \u0026mut node_indices,\n        \u0026get_cell_label\n    );\n\n    // Generate DOT format\n    let dot = Dot::with_config(\u0026graph, \u0026[Config::EdgeNoLabel]);\n    \n    // Save to temp file\n    let temp_file = format!(\"cell_{}_{}_relationships.dot\", row, col);\n    let mut file = match File::create(\u0026temp_file) {\n        Ok(file) =\u003e file,\n        Err(e) =\u003e {\n            eprintln!(\"Failed to create dot file: {}\", e);\n            return CommandStatus::CmdOk;\n        }\n    };\n    \n    if let Err(e) = writeln!(file, \"{:?}\", dot) {\n        eprintln!(\"Failed to write to dot file: {}\", e);\n        return CommandStatus::CmdOk;\n    }\n\n    println!(\"Cell relationships saved to {}\", temp_file);\n    \n    // Attempt to render with Graphviz if available\n    let output_file = format!(\"cell_{}_{}_relationships.png\", row, col);\n    match Command::new(\"dot\")\n        .args([\"-Tpng\", \u0026temp_file, \"-o\", \u0026output_file])\n        .output() \n    {\n        Ok(_) =\u003e {\n            println!(\"Cell relationship diagram generated as {}\", output_file);\n            // Try to open the image with the default viewer\n            #[cfg(target_os = \"windows\")]\n            let _ = Command::new(\"cmd\").args([\"/C\", \u0026output_file]).spawn();\n            \n            #[cfg(target_os = \"macos\")]\n            let _ = Command::new(\"open\").arg(\u0026output_file).spawn();\n            \n            #[cfg(target_os = \"linux\")]\n            let _ = Command::new(\"xdg-open\").arg(\u0026output_file).spawn();\n        }\n        Err(_) =\u003e {\n            println!(\"Graphviz not found. You can manually convert the .dot file to an image.\");\n            println!(\"For instance: dot -Tpng {} -o {}\", temp_file, output_file);\n        }\n    }\n\n    // Print textual representation of the relationships\n    println!(\"\\nCell {}{}:\", spreadsheet.get_column_name(col), row + 1);\n    \n    // Show parents\n    if let Some(meta) = spreadsheet.cell_meta.get(\u0026cell_key) {\n        println!(\"  Parents:\");\n        let mut has_parents = false;\n        \n        for parent_key in [meta.parent1, meta.parent2].iter().filter(|\u0026\u0026k| k \u003e= 0) {\n            has_parents = true;\n            let (r, c) = spreadsheet.get_row_col(*parent_key);\n            println!(\"    - {}{}: {}\", \n                spreadsheet.get_column_name(c), \n                r + 1,\n                match spreadsheet.grid[*parent_key as usize] {\n                    CellValue::Integer(val) =\u003e val.to_string(),\n                    CellValue::Error =\u003e \"ERROR\".to_string(),\n                }\n            );\n        }\n        \n        if !has_parents {\n            println!(\"    (none)\");\n        }\n    }\n    \n    // Show children\n    println!(\"  Children:\");\n    if let Some(children) = spreadsheet.get_cell_children(cell_key) {\n        if !children.is_empty() {\n            for \u0026child_key in children {\n                let (r, c) = spreadsheet.get_row_col(child_key);\n                println!(\"    - {}{}: {}\", \n                    spreadsheet.get_column_name(c), \n                    r + 1,\n                    match spreadsheet.grid[child_key as usize] {\n                        CellValue::Integer(val) =\u003e val.to_string(),\n                        CellValue::Error =\u003e \"ERROR\".to_string(),\n                    }\n                );\n            }\n        } else {\n            println!(\"    (none)\");\n        }\n    } else {\n        println!(\"    (none)\");\n    }\n    \n    CommandStatus::CmdOk\n}\n","traces":[{"line":10,"address":[200160,201658,205455],"length":1,"stats":{"Line":1}},{"line":16,"address":[200205,200254],"length":1,"stats":{"Line":2}},{"line":17,"address":[200241],"length":1,"stats":{"Line":1}},{"line":21,"address":[200298],"length":1,"stats":{"Line":1}},{"line":24,"address":[200334],"length":1,"stats":{"Line":1}},{"line":25,"address":[200347],"length":1,"stats":{"Line":1}},{"line":28,"address":[178549,177888],"length":1,"stats":{"Line":2}},{"line":29,"address":[177936],"length":1,"stats":{"Line":1}},{"line":30,"address":[177979],"length":1,"stats":{"Line":1}},{"line":31,"address":[178260,178013,178277,178062],"length":1,"stats":{"Line":3}},{"line":32,"address":[178182,178242],"length":1,"stats":{"Line":2}},{"line":33,"address":[178267,178215],"length":1,"stats":{"Line":0}},{"line":38,"address":[200410],"length":1,"stats":{"Line":1}},{"line":39,"address":[200477,200557],"length":1,"stats":{"Line":2}},{"line":40,"address":[200585],"length":1,"stats":{"Line":1}},{"line":43,"address":[205472],"length":1,"stats":{"Line":1}},{"line":53,"address":[205616],"length":1,"stats":{"Line":1}},{"line":59,"address":[205641],"length":1,"stats":{"Line":1}},{"line":61,"address":[205705,206212],"length":1,"stats":{"Line":1}},{"line":64,"address":[206228],"length":1,"stats":{"Line":0}},{"line":65,"address":[178576,178586],"length":1,"stats":{"Line":0}},{"line":68,"address":[206383,206449],"length":1,"stats":{"Line":0}},{"line":69,"address":[206442],"length":1,"stats":{"Line":0}},{"line":71,"address":[206466],"length":1,"stats":{"Line":0}},{"line":72,"address":[206484],"length":1,"stats":{"Line":0}},{"line":73,"address":[206520],"length":1,"stats":{"Line":0}},{"line":74,"address":[206531],"length":1,"stats":{"Line":0}},{"line":78,"address":[206543],"length":1,"stats":{"Line":0}},{"line":79,"address":[206574],"length":1,"stats":{"Line":0}},{"line":82,"address":[206604],"length":1,"stats":{"Line":0}},{"line":85,"address":[206663],"length":1,"stats":{"Line":0}},{"line":98,"address":[205765,205652],"length":1,"stats":{"Line":1}},{"line":100,"address":[205781],"length":1,"stats":{"Line":0}},{"line":102,"address":[205970,205896],"length":1,"stats":{"Line":0}},{"line":103,"address":[205963],"length":1,"stats":{"Line":0}},{"line":105,"address":[205982],"length":1,"stats":{"Line":0}},{"line":106,"address":[206005],"length":1,"stats":{"Line":0}},{"line":107,"address":[206036],"length":1,"stats":{"Line":0}},{"line":108,"address":[206052],"length":1,"stats":{"Line":0}},{"line":112,"address":[206064],"length":1,"stats":{"Line":0}},{"line":113,"address":[206095],"length":1,"stats":{"Line":0}},{"line":116,"address":[206125],"length":1,"stats":{"Line":0}},{"line":135,"address":[200615],"length":1,"stats":{"Line":1}},{"line":149,"address":[200756],"length":1,"stats":{"Line":1}},{"line":163,"address":[200886],"length":1,"stats":{"Line":1}},{"line":166,"address":[200937],"length":1,"stats":{"Line":1}},{"line":167,"address":[201167,201120],"length":1,"stats":{"Line":2}},{"line":168,"address":[201180],"length":1,"stats":{"Line":1}},{"line":169,"address":[201224],"length":1,"stats":{"Line":0}},{"line":170,"address":[201256,205280],"length":1,"stats":{"Line":0}},{"line":171,"address":[205351],"length":1,"stats":{"Line":0}},{"line":175,"address":[201217,201306],"length":1,"stats":{"Line":2}},{"line":176,"address":[201531,201466],"length":1,"stats":{"Line":0}},{"line":177,"address":[201602],"length":1,"stats":{"Line":0}},{"line":180,"address":[201683],"length":1,"stats":{"Line":1}},{"line":183,"address":[201777],"length":1,"stats":{"Line":1}},{"line":184,"address":[202276,201944],"length":1,"stats":{"Line":2}},{"line":185,"address":[202119,202019],"length":1,"stats":{"Line":2}},{"line":189,"address":[202445,202369],"length":1,"stats":{"Line":0}},{"line":198,"address":[202516],"length":1,"stats":{"Line":0}},{"line":201,"address":[202689,202376],"length":1,"stats":{"Line":2}},{"line":202,"address":[202724],"length":1,"stats":{"Line":1}},{"line":207,"address":[202867],"length":1,"stats":{"Line":1}},{"line":210,"address":[203146],"length":1,"stats":{"Line":1}},{"line":211,"address":[203297,203242],"length":1,"stats":{"Line":0}},{"line":212,"address":[203324],"length":1,"stats":{"Line":0}},{"line":214,"address":[178608,178618],"length":1,"stats":{"Line":0}},{"line":215,"address":[203598],"length":1,"stats":{"Line":0}},{"line":216,"address":[203693,203606],"length":1,"stats":{"Line":0}},{"line":217,"address":[203751,204023,203847,204006],"length":1,"stats":{"Line":0}},{"line":227,"address":[203553],"length":1,"stats":{"Line":0}},{"line":228,"address":[203625],"length":1,"stats":{"Line":0}},{"line":233,"address":[204191,203268],"length":1,"stats":{"Line":2}},{"line":234,"address":[204218],"length":1,"stats":{"Line":1}},{"line":235,"address":[204300,204344],"length":1,"stats":{"Line":0}},{"line":236,"address":[204363,204399,204521],"length":1,"stats":{"Line":0}},{"line":237,"address":[204542],"length":1,"stats":{"Line":0}},{"line":238,"address":[204771],"length":1,"stats":{"Line":0}},{"line":248,"address":[204370,205074],"length":1,"stats":{"Line":0}},{"line":251,"address":[204311,205098],"length":1,"stats":{"Line":2}},{"line":254,"address":[204487],"length":1,"stats":{"Line":1}}],"covered":38,"coverable":81}]};
        var previousData = {"files":[{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","cell.rs"],"content":"use crate::spreadsheet::{Spreadsheet, CommandStatus}; \n\n// Cell value representation\n#[derive(Debug, Clone, PartialEq)]\npub enum CellValue {\n    Integer(i32),\n    Error,\n}\n\npub fn parse_cell_reference(sheet: \u0026Spreadsheet, cell_ref: \u0026str) -\u003e Result\u003c(i16, i16), CommandStatus\u003e {\n    let cell_ref = cell_ref.as_bytes();\n    if cell_ref.is_empty() {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Find column/row split point in one pass\n    let mut split_idx = 0;\n    let mut col_length = 0;\n    \n    while split_idx \u003c cell_ref.len() \u0026\u0026 \n          cell_ref[split_idx] \u003e= b'A' \u0026\u0026 cell_ref[split_idx] \u003c= b'Z' {\n        col_length += 1;\n        if col_length \u003e 3 {\n            return Err(CommandStatus::CmdUnrecognized);\n        }\n        split_idx += 1;\n    }\n    \n    // Verify we have columns and rows\n    if col_length == 0 || split_idx == cell_ref.len() {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Verify remaining chars are digits\n    for i in split_idx..cell_ref.len() {\n        if !cell_ref[i].is_ascii_digit() {\n            return Err(CommandStatus::CmdUnrecognized);\n        }\n    }\n    \n    // Get column reference as a string slice (no allocation)\n    let col_name = std::str::from_utf8(\u0026cell_ref[0..split_idx])\n        .map_err(|_| CommandStatus::CmdUnrecognized)?;\n    \n    // Parse row directly from bytes (avoid string allocation)\n    let mut row: i16 = 0;\n    for \u0026byte in \u0026cell_ref[split_idx..] {\n        row = row * 10 + (byte - b'0') as i16;\n    }\n    \n    // Convert to 0-based\n    let row = row - 1;\n    \n    // Convert column name to index\n    let col = sheet.column_name_to_index(col_name);\n    // Check row and column bounds\n    if row \u003c 0 || col \u003c 0 || row \u003e 998 || col \u003e 18277 {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    Ok((row, col))\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::spreadsheet::{CommandStatus, Spreadsheet};\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_parse_cell_reference_valid() {\n        let sheet = create_test_spreadsheet(10, 10);\n        assert_eq!(parse_cell_reference(\u0026sheet, \"A1\"), Ok((0, 0)));\n        assert_eq!(parse_cell_reference(\u0026sheet, \"B2\"), Ok((1, 1)));\n        assert_eq!(parse_cell_reference(\u0026sheet, \"AA10\"), Ok((9, 26)));\n        assert_eq!(parse_cell_reference(\u0026sheet, \"ZZZ999\"), Ok((998, 18277)));\n    }\n\n    #[test]\n    fn test_parse_cell_reference_invalid() {\n        let sheet = create_test_spreadsheet(10, 10);\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"1A\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"A\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"A1B\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"AAAA1\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n    }\n\n    #[test]\n    fn test_parse_cell_reference_bounds() {\n        let sheet = create_test_spreadsheet(10, 10);\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"A1000\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"ZZZ1000\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_cell_reference(\u0026sheet, \"A0\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n    }\n\n    #[test]\n    fn test_cell_value_equality() {\n        assert_eq!(CellValue::Integer(42), CellValue::Integer(42));\n        assert_eq!(CellValue::Error, CellValue::Error);\n        assert_ne!(CellValue::Integer(42), CellValue::Error);\n    }\n}","traces":[{"line":10,"address":[179584],"length":1,"stats":{"Line":3}},{"line":11,"address":[179683],"length":1,"stats":{"Line":3}},{"line":12,"address":[179699],"length":1,"stats":{"Line":3}},{"line":13,"address":[179733],"length":1,"stats":{"Line":1}},{"line":17,"address":[179708],"length":1,"stats":{"Line":3}},{"line":18,"address":[179720],"length":1,"stats":{"Line":3}},{"line":20,"address":[181345,179731,179776],"length":1,"stats":{"Line":10}},{"line":21,"address":[179813],"length":1,"stats":{"Line":3}},{"line":22,"address":[179960,181238,181257],"length":1,"stats":{"Line":4}},{"line":23,"address":[181245],"length":1,"stats":{"Line":3}},{"line":24,"address":[181297],"length":1,"stats":{"Line":1}},{"line":26,"address":[181350,181337,181273],"length":1,"stats":{"Line":7}},{"line":30,"address":[180030,179786],"length":1,"stats":{"Line":5}},{"line":31,"address":[179987],"length":1,"stats":{"Line":1}},{"line":35,"address":[180427,180048],"length":1,"stats":{"Line":8}},{"line":36,"address":[180448,181152],"length":1,"stats":{"Line":5}},{"line":37,"address":[181199],"length":1,"stats":{"Line":1}},{"line":42,"address":[180329,180478,180620,180603,180139],"length":1,"stats":{"Line":12}},{"line":43,"address":[180610],"length":1,"stats":{"Line":0}},{"line":46,"address":[180520],"length":1,"stats":{"Line":4}},{"line":47,"address":[181118,180530,180580,180763,180688],"length":1,"stats":{"Line":21}},{"line":48,"address":[180784,181029,181123],"length":1,"stats":{"Line":10}},{"line":52,"address":[180880,180738,180838],"length":1,"stats":{"Line":10}},{"line":55,"address":[180846],"length":1,"stats":{"Line":5}},{"line":57,"address":[180872,180901,180944],"length":1,"stats":{"Line":21}},{"line":58,"address":[180907],"length":1,"stats":{"Line":1}},{"line":60,"address":[180971],"length":1,"stats":{"Line":6}}],"covered":26,"coverable":27},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","evaluator.rs"],"content":"use crate::spreadsheet::{Spreadsheet, CommandStatus};\nuse crate::cell::{CellValue, parse_cell_reference};\nuse crate::formula::parse_range;\nuse crate::formula::{eval_max, eval_min, sum_value, eval_variance, eval_avg};\nuse crate::graph::{add_children, remove_all_parents};\nuse crate::reevaluate_topo::{toposort_reval_detect_cycle, sleep_fn};\n\n\npub fn handle_sleep(\n    sheet: \u0026mut Spreadsheet,\n    row: i16,\n    col: i16,\n    expr: \u0026str,\n    sleep_time: \u0026mut f64,\n) -\u003e CommandStatus {\n    let cell_key = sheet.get_key(row, col);\n    \n    // Handle cell reference case\n    if let Ok((target_row, target_col)) = parse_cell_reference(sheet, expr) {\n        // Get parent key before any borrowing\n        let pkey = sheet.get_key(target_row, target_col);\n        \n        // Check for self-reference early (optimization)\n        if row == target_row \u0026\u0026 col == target_col {\n            return CommandStatus::CmdCircularRef;\n        }\n\n        // Remove parents and update cell in one block\n        remove_all_parents(sheet, row, col);\n                \n        // Set up the new cell metadata\n        let meta = sheet.get_cell_meta(row, col);\n        meta.parent1 = pkey;\n        meta.parent2 = -1;\n        meta.formula = 102;    // Custom formula code for sleep\n        \n        // // Check for circular reference\n        // if detect_cycle(sheet, pkey, -1, 102, cell_key) {\n        //     if let Some(old) = old_meta {\n        //         let (parent1, parent2, formula) = (old.parent1, old.parent2, old.formula);\n        //         sheet.cell_meta.insert(cell_key, old);\n        //         add_children(sheet, parent1, parent2, formula, row, col);\n        //     } else {\n        //         sheet.cell_meta.remove(\u0026cell_key);\n        //     }\n        //     return CommandStatus::CmdCircularRef;\n        // }\n        \n        // Add children and update sleep time\n        add_children(sheet, pkey, -1, 102, row, col);\n        // Add to sleep time if integer\n        // Get the value from parent cell\n        let parent_value = sheet.get_cell(target_row, target_col);\n        if let CellValue::Integer(val) = parent_value {\n            // Update cell value and sleep time\n            sleep_fn(sheet, row, col, *val, sleep_time);\n        }\n        else{\n            *sheet.get_mut_cell(row, col) = CellValue::Error;\n        }\n    } \n    // Handle numeric literal case\n    else if let Ok(val) = expr.parse::\u003ci32\u003e() {\n        // Remove all parents and update cell in one sequence\n        remove_all_parents(sheet, row, col);\n        // Update cell value and sleep_time\n        // Delete the cell meta entry\n        sheet.cell_meta.remove(\u0026cell_key);\n        sleep_fn(sheet, row, col, val, sleep_time);\n    }\n    else {\n        return CommandStatus::CmdUnrecognized;\n    }\n    \n    CommandStatus::CmdOk\n}\n\npub fn evaluate_arithmetic(\n    sheet: \u0026mut Spreadsheet,\n    row: i16,\n    col: i16,\n    expr: \u0026str,\n) -\u003e CommandStatus {\n    let cell_key = sheet.get_key(row, col);\n    \n    // Case 1: Integer literal\n    if let Ok(number) = expr.parse::\u003ci32\u003e() {\n        remove_all_parents(sheet, row, col);\n        // As no parents and formula remove the meta data from the set and map\n        // to avoid memory leaks\n        sheet.cell_meta.remove(\u0026cell_key);\n        *sheet.get_mut_cell(row, col) = CellValue::Integer(number);\n        \n        return CommandStatus::CmdOk;\n    }\n    \n    // Case 2: Simple cell reference - check using bytes for better performance\n    let mut all_alnum = true;\n    for \u0026b in expr.as_bytes() {\n        if !(b.is_ascii_alphanumeric() || b == b'_') {\n            all_alnum = false;\n            break;\n        }\n    }\n    \n    if all_alnum {\n        match parse_cell_reference(sheet, expr) {\n            Ok((target_row, target_col)) =\u003e {\n                \n                // Get reference cell key and value\n                let ref_cell_key = sheet.get_key(target_row, target_col);\n\n                // Remove old dependencies and set new ones\n                remove_all_parents(sheet, row, col);\n                \n                // Update metadata\n                let meta = sheet.get_cell_meta(row, col);\n                meta.parent1 = ref_cell_key;\n                meta.parent2 = -1;\n                meta.formula = 82;  // Code for simple cell reference\n                \n                // Add dependency\n                add_children(sheet, ref_cell_key, -1, 82, row, col);\n                \n                // Update cell value\n                *sheet.get_mut_cell(row, col) =  match sheet.get_cell(target_row, target_col) {\n                    CellValue::Integer(val) =\u003e CellValue::Integer(*val),\n                    _ =\u003e CellValue::Error,\n                };\n                return CommandStatus::CmdOk;\n            },\n            Err(status) =\u003e return status\n        }\n    }\n\n    // Case 3: Binary arithmetic expression\n    // Find operator starting at index 1 (like C code, to handle leading minus sign)\n    let bytes = expr.as_bytes();\n    let mut op_idx = 0;\n    let mut op = 0u8;\n    \n    // Start at index 1 to handle leading minus sign\n    for i in 1..bytes.len() {\n        match bytes[i] {\n            b'+' | b'-' | b'*' | b'/' =\u003e {\n                op = bytes[i];\n                op_idx = i;\n                break;\n            },\n            _ =\u003e {}\n        }\n    }\n    \n    if op_idx == 0 {\n        return CommandStatus::CmdUnrecognized;\n    }\n    \n    // Split into left and right parts\n    let left = \u0026expr[..op_idx];\n    let right = \u0026expr[op_idx+1..];\n    \n    if left.is_empty() || right.is_empty() {\n        return CommandStatus::CmdUnrecognized;\n    }\n    \n    // Variables to track cell references and values\n    let mut left_val = 0;\n    let mut right_val = 0;\n    let mut left_is_cell = false;\n    let mut right_is_cell = false;\n    let mut error_found = false;\n    let mut left_cell_key = -1;\n    let mut right_cell_key = -1;\n    \n    // Parse left operand\n    if let Ok(num) = left.parse::\u003ci32\u003e() {\n        left_val = num;\n    } else {\n        // Try as cell reference\n        match parse_cell_reference(sheet, left) {\n            Ok((left_row, left_col)) =\u003e {      \n\n                left_is_cell = true;\n                left_cell_key = sheet.get_key(left_row, left_col);\n                \n                // Get reference cell value\n                let left_cell = sheet.get_cell(left_row, left_col);\n                match left_cell {\n                    CellValue::Integer(val) =\u003e left_val = *val,\n                    _ =\u003e {\n                        error_found = true;\n                    }\n                }\n            },\n            Err(status) =\u003e return status\n        }\n    }\n    \n    // Parse right operand\n    if let Ok(num) = right.parse::\u003ci32\u003e() {\n        right_val = num;\n    } else {\n        // Try as cell reference\n        match parse_cell_reference(sheet, right) {\n            Ok((right_row, right_col)) =\u003e {\n                \n                right_is_cell = true;\n                right_cell_key = sheet.get_key(right_row, right_col);\n                \n                // Get reference cell value\n                let right_cell = sheet.get_cell(right_row, right_col);\n                match right_cell {\n                    CellValue::Integer(val) =\u003e right_val = *val,\n                    _ =\u003e {\n                        error_found = true;\n                    }\n                }\n            },\n            Err(status) =\u003e return status\n        }\n    }\n    \n    // Remove old dependencies\n    remove_all_parents(sheet, row, col);\n    \n    // Determine formula type based on operator and operand types\n    let mut formula_type = match op {\n        b'+' =\u003e 10,\n        b'-' =\u003e 20,\n        b'*' =\u003e 40,\n        b'/' =\u003e 30,\n        _ =\u003e unreachable!()\n    };\n    \n    // Adjust formula type based on cell references (like C code)\n    if left_is_cell \u0026\u0026 right_is_cell {\n        formula_type += 0;    // Both are cells, no adjustment needed\n    } else if left_is_cell {\n        formula_type += 2;\n    } else if right_is_cell {\n        formula_type += 3;\n    }\n    \n    // Set metadata\n    let meta = sheet.get_cell_meta(row, col);\n    meta.formula = formula_type;\n    meta.parent1 = if left_is_cell { left_cell_key } else { left_val };\n    meta.parent2 = if right_is_cell { right_cell_key } else { right_val };\n    \n    // Check for circular references\n    \n    // Add dependencies\n    if left_is_cell \u0026\u0026 right_is_cell {\n        // Add dependencies for both cells\n        add_children(sheet, left_cell_key, right_cell_key, formula_type, row, col);\n    }\n    else if left_is_cell {\n        // Ordering of Cells matters\n        add_children(sheet, left_cell_key, -1, formula_type, row, col);\n    }\n    else if right_is_cell {\n        // Ordering of Cells matters\n        add_children(sheet, -1, right_cell_key, formula_type, row, col);\n    }\n    \n    // Calculate result\n    let cell = sheet.get_mut_cell(row, col);\n    \n    if error_found {\n        *cell = CellValue::Error;\n    } else {\n        match op {\n            b'+' =\u003e *cell = CellValue::Integer(left_val + right_val),\n            b'-' =\u003e *cell = CellValue::Integer(left_val - right_val),\n            b'*' =\u003e *cell = CellValue::Integer(left_val * right_val),\n            b'/' =\u003e {\n                if right_val == 0 {\n                    *cell = CellValue::Error;\n                } else {\n                    *cell = CellValue::Integer(left_val / right_val);\n                }\n            },\n            _ =\u003e unreachable!()\n        }\n    }\n    \n    CommandStatus::CmdOk\n}\n\npub fn evaluate_formula(\n    sheet: \u0026mut Spreadsheet,\n    row: i16,\n    col: i16,\n    expr: \u0026str,\n    sleep_time: \u0026mut f64,\n) -\u003e CommandStatus {\n    // Fast fail for empty expression\n    if expr.is_empty() {\n        return CommandStatus::CmdUnrecognized;\n    }\n\n    // Optimize function checks by using bytes for prefix matching\n    let bytes = expr.as_bytes();\n    \n    // Check for range-based functions with a single pass\n    let (is_formula, formula_type, prefix_len) = match bytes.get(0..3) {\n        Some(b\"AVG\") if bytes.get(3) == Some(\u0026b'(') =\u003e (true, 6, 4),\n        Some(b\"MIN\") if bytes.get(3) == Some(\u0026b'(') =\u003e (true, 7, 4),\n        Some(b\"MAX\") if bytes.get(3) == Some(\u0026b'(') =\u003e (true, 8, 4),\n        Some(b\"SUM\") if bytes.get(3) == Some(\u0026b'(') =\u003e (true, 5, 4),\n        Some(b\"SLE\") if bytes.len() \u003e 5 \u0026\u0026 \n                        bytes[3] == b'E' \u0026\u0026 \n                        bytes[4] == b'P' \u0026\u0026 \n                        bytes.get(5) == Some(\u0026b'(') =\u003e {\n            // Handle sleep function separately\n            if !expr.ends_with(')') {\n                return CommandStatus::CmdUnrecognized;\n            }\n            return handle_sleep(sheet, row, col, \u0026expr[6..expr.len() - 1], sleep_time);\n            },\n        Some(b\"STD\") if bytes.len() \u003e 5 \u0026\u0026 \n                        bytes[3] == b'E' \u0026\u0026 \n                        bytes[4] == b'V' \u0026\u0026 \n                        bytes.get(5) == Some(\u0026b'(') =\u003e (true, 9, 6),\n        _ =\u003e (false, -1, 0)\n    };\n\n    if is_formula {\n        // Validate formula format\n        if !expr.ends_with(')') {\n            return CommandStatus::CmdUnrecognized;\n        }\n\n        // Extract the range string without allocating extra memory\n        let range_str: \u0026str = \u0026expr[prefix_len..expr.len() - 1];\n\n        // Parse range and validate early to avoid unnecessary work\n        let range = match parse_range(sheet, range_str) {\n            Ok(r) =\u003e r,\n            Err(status) =\u003e return status,\n        };\n\n        // let cell_key = sheet.get_key(row, col);\n        let parent1 = sheet.get_key(range.start_row, range.start_col);\n        let parent2 = sheet.get_key(range.end_row, range.end_col);\n        remove_all_parents(sheet, row, col); \n        // Update metadata\n        let meta = sheet.get_cell_meta(row, col);\n        meta.parent1 = parent1;\n        meta.parent2 = parent2;\n        meta.formula = formula_type;\n\n        // Add children and evaluate the appropriate function\n        add_children(sheet, parent1, parent2, formula_type, row, col);\n        \n        match formula_type {\n            9 =\u003e eval_variance(sheet, row, col, parent1, parent2),\n            8 =\u003e eval_max(sheet, row, col, parent1, parent2),\n            7 =\u003e eval_min(sheet, row, col, parent1, parent2),\n            6 =\u003e eval_avg(sheet, row, col, parent1, parent2),\n            _ =\u003e sum_value(sheet, row, col, parent1, parent2), // SUM case\n        }\n    } else {\n        // Handle arithmetic expressions\n        evaluate_arithmetic(sheet, row, col, expr)\n    }\n\n}\n\npub fn set_cell_value(sheet: \u0026mut Spreadsheet, row: i16, col: i16, expr: \u0026str, sleep_time: \u0026mut f64) -\u003e CommandStatus {\n    let old_meta = sheet.cell_meta.get(\u0026sheet.get_key(row, col)).cloned();\n    let old_value = match sheet.get_cell(row, col) {\n        CellValue::Integer(val) =\u003e CellValue::Integer(*val),\n        _ =\u003e CellValue::Error,\n    };\n    let status: CommandStatus = evaluate_formula(sheet, row, col, expr, sleep_time);\n    if let CommandStatus::CmdOk = status {\n        // Reevaluate the cell dependents graphs i.e. all of its children\n        // Also at same time check for cycle in the graph as it will save time and memory\n        let has_cycle = toposort_reval_detect_cycle(sheet, row, col, sleep_time);\n        if has_cycle {\n            // If a cycle is detected, restore the old parents and formula\n            // Remove the new parents and formula\n            remove_all_parents(sheet, row, col);\n            // Restore the old value\n            *sheet.get_mut_cell(row, col) = old_value;\n            // Old meta \n            if let Some(old) = old_meta {\n                let (parent1, parent2, formula) = (old.parent1, old.parent2, old.formula);\n                sheet.cell_meta.insert(sheet.get_key(row, col), old);\n                add_children(sheet, parent1, parent2, formula, row, col);\n            } else {\n                sheet.cell_meta.remove(\u0026sheet.get_key(row, col));\n            }\n\n            return CommandStatus::CmdCircularRef;\n        }\n    }\n    status\n}\n\npub fn handle_command(\n    sheet: \u0026mut Spreadsheet,\n    trimmed: \u0026str,\n    sleep_time: \u0026mut f64,\n) -\u003e CommandStatus {    \n    // Fast path for single-character commands to avoid string comparisons\n    if trimmed.len() == 1 {\n        match trimmed.as_bytes()[0] {\n            b'w' | b'a' | b's' | b'd' =\u003e {\n                // We've already validated it's one byte, so this is safe\n                let direction = trimmed.chars().next().unwrap();\n                sheet.scroll_viewport(direction);\n                return CommandStatus::CmdOk;\n            },\n            b'q' =\u003e return CommandStatus::CmdOk, // Handle quit command if needed\n            _ =\u003e {}\n        }\n    }\n    \n    // Use match for special commands for better branch prediction\n    match trimmed {\n        \"disable_output\" =\u003e {\n            sheet.output_enabled = false;\n            return CommandStatus::CmdOk;\n        },\n        \"enable_output\" =\u003e {\n            sheet.output_enabled = true;\n            return CommandStatus::CmdOk;\n        },\n        _ =\u003e {}\n    }\n    \n    // Check for cell dependency visualization command\n    if trimmed.starts_with(\"visualize \") {\n        let cell_ref = \u0026trimmed[10..]; // Skip \"visualize \" prefix\n        match parse_cell_reference(sheet, cell_ref) {\n            Ok((row, col)) =\u003e {\n                return sheet.visualize_cell_relationships(row, col);\n            },\n            Err(status) =\u003e {\n                return status;\n            }\n        }\n    }\n    \n    // Check for scroll_to command with byte-based comparison\n    if trimmed.len() \u003e 10 \u0026\u0026 \u0026trimmed.as_bytes()[..9] == b\"scroll_to\" \u0026\u0026 trimmed.as_bytes()[9] == b' ' {\n        let cell_ref = \u0026trimmed[10..];\n        return sheet.scroll_to_cell(cell_ref);\n    }\n    \n    // Check for cell assignment using byte search for '='\n    let bytes = trimmed.as_bytes();\n    let mut eq_pos = None;\n    \n    for (i, \u0026b) in bytes.iter().enumerate() {\n        if b == b'=' {\n            eq_pos = Some(i);\n            break;\n        }\n    }\n    \n    if let Some(pos) = eq_pos {\n        // Use slice operations which are more efficient than split_at\n        let cell_ref = trimmed[..pos].trim();\n        let expr = trimmed[pos+1..].trim();\n        \n        // Parse the cell reference with direct result handling\n        return match parse_cell_reference(sheet, cell_ref) {\n            Ok((row, col)) =\u003e {\n                // All bounds checks in one condition\n                set_cell_value(sheet, row, col, expr, sleep_time)\n            },\n            Err(status) =\u003e status,\n        };\n    }\n    // No recognized command\n    CommandStatus::CmdUnrecognized\n}\n\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::cell::CellValue;\n    use crate::spreadsheet::{CommandStatus, Spreadsheet};\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_handle_sleep_with_reference() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_sleep(\u0026mut sheet, 1, 1, \"A1\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(5));\n        assert_eq!(sleep_time, 5.0);\n        let meta = sheet.cell_meta.get(\u0026sheet.get_key(1, 1)).unwrap();\n        assert_eq!(meta.formula, 102);\n        assert_eq!(meta.parent1, sheet.get_key(0, 0));\n    }\n\n    #[test]\n    fn test_handle_sleep_with_literal() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_sleep(\u0026mut sheet, 1, 1, \"3\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n        assert_eq!(sleep_time, 3.0);\n        assert!(!sheet.cell_meta.contains_key(\u0026sheet.get_key(1, 1)));\n    }\n\n    #[test]\n    fn test_handle_sleep_invalid() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_sleep(\u0026mut sheet, 1, 1, \"INVALID\", \u0026mut sleep_time),\n            CommandStatus::CmdUnrecognized\n        );\n    }\n\n    #[test]\n    fn test_handle_sleep_self_reference() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_sleep(\u0026mut sheet, 1, 1, \"B2\", \u0026mut sleep_time),\n            CommandStatus::CmdCircularRef\n        );\n    }\n\n    #[test]\n    fn test_evaluate_arithmetic_literal() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        assert_eq!(\n            evaluate_arithmetic(\u0026mut sheet, 0, 0, \"42\"),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(42));\n        assert!(!sheet.cell_meta.contains_key(\u0026sheet.get_key(0, 0)));\n    }\n\n    #[test]\n    fn test_evaluate_arithmetic_cell_ref() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(10);\n        assert_eq!(\n            evaluate_arithmetic(\u0026mut sheet, 1, 1, \"A1\"),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(10));\n        let meta = sheet.cell_meta.get(\u0026sheet.get_key(1, 1)).unwrap();\n        assert_eq!(meta.formula, 82);\n        assert_eq!(meta.parent1, sheet.get_key(0, 0));\n    }\n\n    #[test]\n    fn test_evaluate_arithmetic_binary_add() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(5);\n        assert_eq!(\n            evaluate_arithmetic(\u0026mut sheet, 1, 1, \"A1+3\"),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(8));\n        let meta = sheet.cell_meta.get(\u0026sheet.get_key(1, 1)).unwrap();\n        assert_eq!(meta.formula, 12);\n        assert_eq!(meta.parent1, sheet.get_key(0, 0));\n        assert_eq!(meta.parent2, 3);\n    }\n\n    #[test]\n    fn test_evaluate_arithmetic_binary_div_zero() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(5);\n        assert_eq!(\n            evaluate_arithmetic(\u0026mut sheet, 1, 1, \"A1/0\"),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    }\n\n    #[test]\n    fn test_evaluate_formula_sum() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(2);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            evaluate_formula(\u0026mut sheet, 1, 1, \"SUM(A1:B1)\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n        let meta = sheet.cell_meta.get(\u0026sheet.get_key(1, 1)).unwrap();\n        assert_eq!(meta.formula, 5);\n    }\n\n    #[test]\n    fn test_evaluate_formula_invalid() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            evaluate_formula(\u0026mut sheet, 1, 1, \"SUM(A1)\", \u0026mut sleep_time),\n            CommandStatus::CmdUnrecognized\n        );\n    }\n\n    #[test]\n    fn test_set_cell_value_with_cycle() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            set_cell_value(\u0026mut sheet, 0, 0, \"A1\", \u0026mut sleep_time),\n            CommandStatus::CmdCircularRef\n        );\n    }\n\n    #[test]\n    fn test_handle_command_scroll() {\n        let mut sheet = create_test_spreadsheet(50, 50);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"s\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(sheet.viewport_row, 10);\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"d\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(sheet.viewport_col, 10);\n    }\n\n    #[test]\n    fn test_handle_command_output_toggle() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"disable_output\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert!(!sheet.output_enabled);\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"enable_output\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert!(sheet.output_enabled);\n    }\n\n    #[test]\n    fn test_handle_command_visualize() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"visualize A1\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"visualize Z9\", \u0026mut sleep_time),\n            CommandStatus::CmdInvalidCell\n        );\n    }\n\n    #[test]\n    fn test_handle_command_scroll_to() {\n        let mut sheet = create_test_spreadsheet(50, 50);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"scroll_to B2\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(sheet.viewport_row, 1);\n        assert_eq!(sheet.viewport_col, 1);\n    }\n\n    #[test]\n    fn test_handle_command_assignment() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        assert_eq!(\n            handle_command(\u0026mut sheet, \"A1=42\", \u0026mut sleep_time),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(42));\n    }\n}","traces":[{"line":9,"address":[156800],"length":1,"stats":{"Line":4}},{"line":16,"address":[156892],"length":1,"stats":{"Line":4}},{"line":19,"address":[156922],"length":1,"stats":{"Line":4}},{"line":21,"address":[157028],"length":1,"stats":{"Line":2}},{"line":24,"address":[157313,157062],"length":1,"stats":{"Line":3}},{"line":25,"address":[157322],"length":1,"stats":{"Line":1}},{"line":29,"address":[157148],"length":1,"stats":{"Line":1}},{"line":32,"address":[157174],"length":1,"stats":{"Line":1}},{"line":33,"address":[157216],"length":1,"stats":{"Line":1}},{"line":34,"address":[157218],"length":1,"stats":{"Line":1}},{"line":35,"address":[157225],"length":1,"stats":{"Line":1}},{"line":50,"address":[157231],"length":1,"stats":{"Line":1}},{"line":53,"address":[157269],"length":1,"stats":{"Line":1}},{"line":54,"address":[157354,157293],"length":1,"stats":{"Line":2}},{"line":56,"address":[157369],"length":1,"stats":{"Line":1}},{"line":59,"address":[157400],"length":1,"stats":{"Line":0}},{"line":63,"address":[157083,157464],"length":1,"stats":{"Line":3}},{"line":65,"address":[157479],"length":1,"stats":{"Line":1}},{"line":68,"address":[157495],"length":1,"stats":{"Line":1}},{"line":69,"address":[157538],"length":1,"stats":{"Line":1}},{"line":72,"address":[157551],"length":1,"stats":{"Line":1}},{"line":75,"address":[157432],"length":1,"stats":{"Line":1}},{"line":78,"address":[157568],"length":1,"stats":{"Line":1}},{"line":84,"address":[157668],"length":1,"stats":{"Line":1}},{"line":87,"address":[157702],"length":1,"stats":{"Line":1}},{"line":88,"address":[157798],"length":1,"stats":{"Line":1}},{"line":91,"address":[157817],"length":1,"stats":{"Line":1}},{"line":92,"address":[157873],"length":1,"stats":{"Line":1}},{"line":94,"address":[157921],"length":1,"stats":{"Line":1}},{"line":98,"address":[157947],"length":1,"stats":{"Line":3}},{"line":99,"address":[158075,157971,158009],"length":1,"stats":{"Line":9}},{"line":100,"address":[158092],"length":1,"stats":{"Line":3}},{"line":101,"address":[158119],"length":1,"stats":{"Line":2}},{"line":106,"address":[158059],"length":1,"stats":{"Line":1}},{"line":107,"address":[158266],"length":1,"stats":{"Line":1}},{"line":108,"address":[161215],"length":1,"stats":{"Line":1}},{"line":111,"address":[161257],"length":1,"stats":{"Line":1}},{"line":114,"address":[161305],"length":1,"stats":{"Line":1}},{"line":117,"address":[161340],"length":1,"stats":{"Line":1}},{"line":118,"address":[161391],"length":1,"stats":{"Line":1}},{"line":119,"address":[161393],"length":1,"stats":{"Line":1}},{"line":120,"address":[161400],"length":1,"stats":{"Line":1}},{"line":123,"address":[161406],"length":1,"stats":{"Line":1}},{"line":126,"address":[161447,161577],"length":1,"stats":{"Line":2}},{"line":127,"address":[161504],"length":1,"stats":{"Line":1}},{"line":128,"address":[161542],"length":1,"stats":{"Line":0}},{"line":130,"address":[161607],"length":1,"stats":{"Line":2}},{"line":132,"address":[161473],"length":1,"stats":{"Line":0}},{"line":138,"address":[158177],"length":1,"stats":{"Line":2}},{"line":139,"address":[158193],"length":1,"stats":{"Line":2}},{"line":140,"address":[158205],"length":1,"stats":{"Line":2}},{"line":143,"address":[158213,158418,158349],"length":1,"stats":{"Line":6}},{"line":144,"address":[158442],"length":1,"stats":{"Line":2}},{"line":146,"address":[158618,158558],"length":1,"stats":{"Line":2}},{"line":147,"address":[158589],"length":1,"stats":{"Line":2}},{"line":154,"address":[158390],"length":1,"stats":{"Line":2}},{"line":155,"address":[158634],"length":1,"stats":{"Line":0}},{"line":159,"address":[158663],"length":1,"stats":{"Line":2}},{"line":160,"address":[158715,158832],"length":1,"stats":{"Line":2}},{"line":162,"address":[158821,158861],"length":1,"stats":{"Line":4}},{"line":163,"address":[158872],"length":1,"stats":{"Line":0}},{"line":167,"address":[158901],"length":1,"stats":{"Line":2}},{"line":168,"address":[158912],"length":1,"stats":{"Line":2}},{"line":169,"address":[158923],"length":1,"stats":{"Line":2}},{"line":170,"address":[158931],"length":1,"stats":{"Line":2}},{"line":171,"address":[158939],"length":1,"stats":{"Line":2}},{"line":172,"address":[158947],"length":1,"stats":{"Line":2}},{"line":173,"address":[158958],"length":1,"stats":{"Line":2}},{"line":176,"address":[159037,158969],"length":1,"stats":{"Line":2}},{"line":177,"address":[159030],"length":1,"stats":{"Line":0}},{"line":180,"address":[159063],"length":1,"stats":{"Line":2}},{"line":181,"address":[159219],"length":1,"stats":{"Line":2}},{"line":183,"address":[159261],"length":1,"stats":{"Line":2}},{"line":184,"address":[159269],"length":1,"stats":{"Line":2}},{"line":187,"address":[159307],"length":1,"stats":{"Line":2}},{"line":188,"address":[159331],"length":1,"stats":{"Line":2}},{"line":189,"address":[159372],"length":1,"stats":{"Line":2}},{"line":190,"address":[159410],"length":1,"stats":{"Line":0}},{"line":191,"address":[159402],"length":1,"stats":{"Line":0}},{"line":195,"address":[159341],"length":1,"stats":{"Line":0}},{"line":200,"address":[159415,159436,159155],"length":1,"stats":{"Line":6}},{"line":201,"address":[159429],"length":1,"stats":{"Line":2}},{"line":204,"address":[159459],"length":1,"stats":{"Line":0}},{"line":205,"address":[159627],"length":1,"stats":{"Line":0}},{"line":207,"address":[159669],"length":1,"stats":{"Line":0}},{"line":208,"address":[159677],"length":1,"stats":{"Line":0}},{"line":211,"address":[159715],"length":1,"stats":{"Line":0}},{"line":212,"address":[159739],"length":1,"stats":{"Line":0}},{"line":213,"address":[159780],"length":1,"stats":{"Line":0}},{"line":214,"address":[159818],"length":1,"stats":{"Line":0}},{"line":215,"address":[159810],"length":1,"stats":{"Line":0}},{"line":219,"address":[159749],"length":1,"stats":{"Line":0}},{"line":224,"address":[159562],"length":1,"stats":{"Line":2}},{"line":227,"address":[159573],"length":1,"stats":{"Line":2}},{"line":228,"address":[159851],"length":1,"stats":{"Line":1}},{"line":229,"address":[159863],"length":1,"stats":{"Line":0}},{"line":230,"address":[159875],"length":1,"stats":{"Line":0}},{"line":231,"address":[159887],"length":1,"stats":{"Line":1}},{"line":236,"address":[159919,159897,160185],"length":1,"stats":{"Line":4}},{"line":237,"address":[160190,160177,159929],"length":1,"stats":{"Line":0}},{"line":238,"address":[160151,159907],"length":1,"stats":{"Line":4}},{"line":239,"address":[160156,160143,159974],"length":1,"stats":{"Line":4}},{"line":240,"address":[160120,159962],"length":1,"stats":{"Line":0}},{"line":241,"address":[160122,160083],"length":1,"stats":{"Line":0}},{"line":245,"address":[160031],"length":1,"stats":{"Line":2}},{"line":246,"address":[160055],"length":1,"stats":{"Line":2}},{"line":247,"address":[160206,160067],"length":1,"stats":{"Line":2}},{"line":248,"address":[160250],"length":1,"stats":{"Line":2}},{"line":253,"address":[160305,160327],"length":1,"stats":{"Line":4}},{"line":255,"address":[160362],"length":1,"stats":{"Line":0}},{"line":257,"address":[160315],"length":1,"stats":{"Line":2}},{"line":259,"address":[160436],"length":1,"stats":{"Line":2}},{"line":261,"address":[160399],"length":1,"stats":{"Line":0}},{"line":263,"address":[160554],"length":1,"stats":{"Line":0}},{"line":267,"address":[160493],"length":1,"stats":{"Line":2}},{"line":269,"address":[160517,160666],"length":1,"stats":{"Line":2}},{"line":270,"address":[160636],"length":1,"stats":{"Line":0}},{"line":272,"address":[160589],"length":1,"stats":{"Line":2}},{"line":273,"address":[160821,160699],"length":1,"stats":{"Line":2}},{"line":274,"address":[160898,160728],"length":1,"stats":{"Line":0}},{"line":275,"address":[160760,160962],"length":1,"stats":{"Line":0}},{"line":277,"address":[160793,161186,161052],"length":1,"stats":{"Line":2}},{"line":278,"address":[161022],"length":1,"stats":{"Line":1}},{"line":280,"address":[161191,161057],"length":1,"stats":{"Line":0}},{"line":287,"address":[160876],"length":1,"stats":{"Line":1}},{"line":290,"address":[161632],"length":1,"stats":{"Line":1}},{"line":298,"address":[161743],"length":1,"stats":{"Line":1}},{"line":299,"address":[161865],"length":1,"stats":{"Line":0}},{"line":303,"address":[161788],"length":1,"stats":{"Line":1}},{"line":306,"address":[162257,161804,161924,162183,162479],"length":1,"stats":{"Line":7}},{"line":307,"address":[161878,162106],"length":1,"stats":{"Line":1}},{"line":308,"address":[162305],"length":1,"stats":{"Line":0}},{"line":309,"address":[162397],"length":1,"stats":{"Line":0}},{"line":310,"address":[162550],"length":1,"stats":{"Line":2}},{"line":311,"address":[162637],"length":1,"stats":{"Line":0}},{"line":312,"address":[162652],"length":1,"stats":{"Line":0}},{"line":313,"address":[162709],"length":1,"stats":{"Line":0}},{"line":314,"address":[162771],"length":1,"stats":{"Line":0}},{"line":316,"address":[162828],"length":1,"stats":{"Line":0}},{"line":317,"address":[162842],"length":1,"stats":{"Line":0}},{"line":319,"address":[162917,162862],"length":1,"stats":{"Line":0}},{"line":321,"address":[163010],"length":1,"stats":{"Line":0}},{"line":322,"address":[163025],"length":1,"stats":{"Line":0}},{"line":323,"address":[163082],"length":1,"stats":{"Line":0}},{"line":324,"address":[163144],"length":1,"stats":{"Line":0}},{"line":325,"address":[161889],"length":1,"stats":{"Line":1}},{"line":328,"address":[162244],"length":1,"stats":{"Line":2}},{"line":330,"address":[163293],"length":1,"stats":{"Line":2}},{"line":331,"address":[163307],"length":1,"stats":{"Line":0}},{"line":335,"address":[163330,163458],"length":1,"stats":{"Line":2}},{"line":338,"address":[163422],"length":1,"stats":{"Line":2}},{"line":339,"address":[163482],"length":1,"stats":{"Line":1}},{"line":340,"address":[163753],"length":1,"stats":{"Line":1}},{"line":344,"address":[163498],"length":1,"stats":{"Line":1}},{"line":345,"address":[163544],"length":1,"stats":{"Line":1}},{"line":346,"address":[163608],"length":1,"stats":{"Line":1}},{"line":348,"address":[163643],"length":1,"stats":{"Line":1}},{"line":349,"address":[163690],"length":1,"stats":{"Line":1}},{"line":350,"address":[163692],"length":1,"stats":{"Line":1}},{"line":351,"address":[163695],"length":1,"stats":{"Line":1}},{"line":354,"address":[163706],"length":1,"stats":{"Line":1}},{"line":356,"address":[163715],"length":1,"stats":{"Line":1}},{"line":357,"address":[163868],"length":1,"stats":{"Line":0}},{"line":358,"address":[163924],"length":1,"stats":{"Line":0}},{"line":359,"address":[163980],"length":1,"stats":{"Line":0}},{"line":360,"address":[164036],"length":1,"stats":{"Line":0}},{"line":361,"address":[163812],"length":1,"stats":{"Line":1}},{"line":365,"address":[163260],"length":1,"stats":{"Line":1}},{"line":370,"address":[164064],"length":1,"stats":{"Line":1}},{"line":371,"address":[164159],"length":1,"stats":{"Line":1}},{"line":372,"address":[164229],"length":1,"stats":{"Line":1}},{"line":373,"address":[164258],"length":1,"stats":{"Line":1}},{"line":374,"address":[164296],"length":1,"stats":{"Line":0}},{"line":376,"address":[164337],"length":1,"stats":{"Line":1}},{"line":377,"address":[164355],"length":1,"stats":{"Line":1}},{"line":380,"address":[164389],"length":1,"stats":{"Line":1}},{"line":381,"address":[164412],"length":1,"stats":{"Line":1}},{"line":384,"address":[164447],"length":1,"stats":{"Line":1}},{"line":386,"address":[164473],"length":1,"stats":{"Line":1}},{"line":388,"address":[164519],"length":1,"stats":{"Line":1}},{"line":389,"address":[164572],"length":1,"stats":{"Line":0}},{"line":390,"address":[164675],"length":1,"stats":{"Line":0}},{"line":391,"address":[164755],"length":1,"stats":{"Line":0}},{"line":393,"address":[164788],"length":1,"stats":{"Line":1}},{"line":396,"address":[164844],"length":1,"stats":{"Line":1}},{"line":399,"address":[164416],"length":1,"stats":{"Line":1}},{"line":402,"address":[164864],"length":1,"stats":{"Line":2}},{"line":408,"address":[164967],"length":1,"stats":{"Line":2}},{"line":409,"address":[165020,165080],"length":1,"stats":{"Line":2}},{"line":412,"address":[165177,165276],"length":1,"stats":{"Line":2}},{"line":413,"address":[165283],"length":1,"stats":{"Line":1}},{"line":414,"address":[165288],"length":1,"stats":{"Line":1}},{"line":416,"address":[165298],"length":1,"stats":{"Line":0}},{"line":423,"address":[165045],"length":1,"stats":{"Line":2}},{"line":424,"address":[165368],"length":1,"stats":{"Line":1}},{"line":425,"address":[165375],"length":1,"stats":{"Line":1}},{"line":427,"address":[165337],"length":1,"stats":{"Line":1}},{"line":428,"address":[165432],"length":1,"stats":{"Line":1}},{"line":429,"address":[165439],"length":1,"stats":{"Line":1}},{"line":435,"address":[165401],"length":1,"stats":{"Line":1}},{"line":436,"address":[165504],"length":1,"stats":{"Line":1}},{"line":437,"address":[165548],"length":1,"stats":{"Line":1}},{"line":438,"address":[166862],"length":1,"stats":{"Line":1}},{"line":439,"address":[166894],"length":1,"stats":{"Line":1}},{"line":441,"address":[166917],"length":1,"stats":{"Line":0}},{"line":442,"address":[166931],"length":1,"stats":{"Line":0}},{"line":448,"address":[165468,166037],"length":1,"stats":{"Line":2}},{"line":449,"address":[166192],"length":1,"stats":{"Line":1}},{"line":450,"address":[166236],"length":1,"stats":{"Line":1}},{"line":454,"address":[165663],"length":1,"stats":{"Line":1}},{"line":455,"address":[165679],"length":1,"stats":{"Line":1}},{"line":457,"address":[166253,166327,165691],"length":1,"stats":{"Line":3}},{"line":458,"address":[166365],"length":1,"stats":{"Line":1}},{"line":459,"address":[166374],"length":1,"stats":{"Line":1}},{"line":464,"address":[166311,166444],"length":1,"stats":{"Line":2}},{"line":466,"address":[166465],"length":1,"stats":{"Line":1}},{"line":467,"address":[166576,166731,166522],"length":1,"stats":{"Line":2}},{"line":470,"address":[166655],"length":1,"stats":{"Line":1}},{"line":471,"address":[166773],"length":1,"stats":{"Line":1}},{"line":473,"address":[166805],"length":1,"stats":{"Line":1}},{"line":475,"address":[166828],"length":1,"stats":{"Line":0}},{"line":479,"address":[166542],"length":1,"stats":{"Line":0}}],"covered":163,"coverable":222},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","formula.rs"],"content":"use crate::cell::{CellValue, parse_cell_reference};\nuse crate::spreadsheet::{Spreadsheet, CommandStatus};\n\n#[derive(Debug, PartialEq)]\npub struct Range {\n    pub start_row: i16,\n    pub start_col: i16,\n    pub end_row: i16,\n    pub end_col: i16,\n}\n\n// Optimize the sum_value function for large ranges\npub fn sum_value(sheet: \u0026mut Spreadsheet, row: i16, col: i16, parent1: i32, parent2: i32) -\u003e CommandStatus {    \n    let mut sum = 0;\n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);\n    // For smaller ranges, use the original approach\n    for i in start_row..=end_row {\n        for j in start_col..=end_col {\n            let ref_cell_value = sheet.get_cell(i, j);\n            if let CellValue::Integer(value) = ref_cell_value {\n                sum += value;\n            } else {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return CommandStatus::CmdOk;\n            }\n        }\n    }\n    \n    // Now set the result\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(sum);\n    CommandStatus::CmdOk\n}\n\n// Add variance evaluation function\npub fn eval_variance(sheet: \u0026mut Spreadsheet, row:i16 , col:i16, parent1: i32, parent2: i32) -\u003e CommandStatus {\n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);\n    let count = ((end_row - start_row + 1) as i32) * ((end_col - start_col + 1) as i32);\n    sum_value(sheet, row, col, parent1, parent2);\n    // Check if sum_value was successful\n    let cell_value = sheet.get_mut_cell(row, col);\n    let mean_value;\n    if let CellValue::Integer(value) = cell_value {\n        let val = *value / count;\n        *cell_value = CellValue::Integer(val);\n        mean_value = val as f64;\n    }\n    else {\n        return CommandStatus::CmdOk;\n    }\n\n    let mut variance = 0.0;\n    \n    for i in start_row..=end_row {\n        for j in start_col..=end_col {\n            if let CellValue::Integer(value) = *sheet.get_cell(i, j) {\n                variance += ((value as f64) - (mean_value)).powi(2);\n            }\n        }\n    }\n\n    variance /= count as f64;\n    let std_dev = (variance.sqrt() + 0.5) as i32;\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(std_dev);\n    CommandStatus::CmdOk\n}\n\n\npub fn eval_min(sheet: \u0026mut Spreadsheet, row: i16, col: i16, parent1: i32, parent2: i32) -\u003e CommandStatus {    \n    let mut min_value = i32::MAX;\n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);\n    // First collect all values (immutable borrows)\n    for r in start_row..=end_row {\n        for c in start_col..=end_col {\n            if let CellValue::Integer(value) = sheet.get_cell(r, c) {\n                min_value = std::cmp::min(min_value, *value);\n            } else {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return CommandStatus::CmdOk;\n            }\n        }\n    }\n    \n    // Now get the mutable cell and set its value (mutable borrow)\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(min_value);\n    CommandStatus::CmdOk\n}\n\n// Fix eval_max implementation\npub fn eval_max(sheet: \u0026mut Spreadsheet, row: i16, col: i16, parent1: i32, parent2: i32) -\u003e CommandStatus {\n    let mut max_value = i32::MIN; \n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);   \n    // First collect all values (immutable borrows)\n    for r in start_row..=end_row {\n        for c in start_col..=end_col {\n            if let CellValue::Integer(value) = sheet.get_cell(r, c) {\n                max_value = std::cmp::max(max_value, *value);\n            } else {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return CommandStatus::CmdOk;\n            }\n        }\n    }\n    \n    // Now get the mutable cell and set its value (mutable borrow)\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(max_value);\n    CommandStatus::CmdOk\n}\n\n\npub fn eval_avg(sheet: \u0026mut Spreadsheet, row: i16, col: i16, parent1: i32, parent2: i32) -\u003e CommandStatus {\n    let (start_row, start_col) = sheet.get_row_col(parent1);\n    let (end_row, end_col) = sheet.get_row_col(parent2);\n    let count = ((end_row - start_row + 1) as i32) * ((end_col - start_col + 1) as i32);\n    match sum_value(sheet, row, col, parent1, parent2) {\n        CommandStatus::CmdOk =\u003e {\n            let cell_value = sheet.get_mut_cell(row, col);\n            if let CellValue::Integer(value) = cell_value {\n                *cell_value = CellValue::Integer(*value / count);\n            }\n        },\n        _ =\u003e return CommandStatus::CmdOk,\n    }\n    CommandStatus::CmdOk\n}\n\n// Keep the Range struct and parse_range function\npub fn parse_range(spreadsheet: \u0026Spreadsheet, range_str: \u0026str) -\u003e Result\u003cRange, CommandStatus\u003e {\n    // Check for minimum valid range pattern length (like \"A1:A1\")\n    if range_str.len() \u003c 3 {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Find the colon index using bytes to avoid UTF-8 decoding\n    let bytes = range_str.as_bytes();\n    let mut colon_index = 0;\n    \n    for (i, \u0026b) in bytes.iter().enumerate() {\n        if b == b':' {\n            colon_index = i;\n            break;\n        }\n    }\n    \n    // Validate colon position (must exist and have chars on both sides)\n    if colon_index == 0 || colon_index + 1 \u003e= range_str.len() {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Avoid creating new strings by using slices\n    let start_cell = \u0026range_str[..colon_index];\n    let end_cell = \u0026range_str[colon_index + 1..];\n    \n    // Parse cell references and validate them in one step\n    let (start_row, start_col) = parse_cell_reference(spreadsheet, start_cell)?;\n    let (end_row, end_col) = parse_cell_reference(spreadsheet, end_cell)?;\n    \n    // Ensure coordinates are valid and range is properly ordered\n    if start_row \u003c 0 || start_col \u003c 0 || end_row \u003c 0 || end_col \u003c 0 || \n       start_row \u003e end_row || start_col \u003e end_col {\n        return Err(CommandStatus::CmdUnrecognized);\n    }\n    \n    // Construct the Range directly\n    Ok(Range {\n        start_row,\n        start_col,\n        end_row,\n        end_col,\n    })\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::cell::CellValue;\n    use crate::spreadsheet::{CommandStatus, Spreadsheet};\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_sum_value() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(2);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            sum_value(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n    }\n\n    #[test]\n    fn test_sum_value_error() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Error;\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            sum_value(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    }\n\n    #[test]\n    fn test_eval_variance() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(2);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(4);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_variance(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(1));\n    }\n\n    #[test]\n    fn test_eval_variance_error() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Error;\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(4);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_variance(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    }\n\n    #[test]\n    fn test_eval_min() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(3);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_min(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(1));\n    }\n\n    #[test]\n    fn test_eval_max() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(3);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_max(\u0026mut sheet, 1, 2, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 2), CellValue::Integer(3));\n    }\n\n    #[test]\n    fn test_eval_min_max_error() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        *sheet.get_mut_cell(0, 1) = CellValue::Error;\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_min(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n        assert_eq!(\n            eval_max(\u0026mut sheet, 1, 2, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 2), CellValue::Error);\n    }\n\n    #[test]\n    fn test_eval_avg() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(2);\n        *sheet.get_mut_cell(0, 1) = CellValue::Integer(4);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        assert_eq!(\n            eval_avg(\u0026mut sheet, 1, 1, parent1, parent2),\n            CommandStatus::CmdOk\n        );\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n    }\n\n    #[test]\n    fn test_parse_range_valid() {\n        let sheet = create_test_spreadsheet(5, 5);\n        let range = parse_range(\u0026sheet, \"A1:B2\").unwrap();\n        assert_eq!(range.start_row, 0);\n        assert_eq!(range.start_col, 0);\n        assert_eq!(range.end_row, 1);\n        assert_eq!(range.end_col, 1);\n    }\n\n    #[test]\n    fn test_parse_range_invalid() {\n        let sheet = create_test_spreadsheet(5, 5);\n        assert_eq!(\n            parse_range(\u0026sheet, \"A\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_range(\u0026sheet, \"A1:\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_range(\u0026sheet, \":A1\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n        assert_eq!(\n            parse_range(\u0026sheet, \"B2:A1\"),\n            Err(CommandStatus::CmdUnrecognized)\n        );\n    }\n}","traces":[{"line":13,"address":[231440],"length":1,"stats":{"Line":1}},{"line":14,"address":[231516],"length":1,"stats":{"Line":1}},{"line":15,"address":[231524],"length":1,"stats":{"Line":1}},{"line":16,"address":[231567],"length":1,"stats":{"Line":1}},{"line":18,"address":[231601,231878],"length":1,"stats":{"Line":2}},{"line":19,"address":[231896,232081],"length":1,"stats":{"Line":2}},{"line":20,"address":[232139],"length":1,"stats":{"Line":1}},{"line":21,"address":[232163],"length":1,"stats":{"Line":1}},{"line":22,"address":[232188],"length":1,"stats":{"Line":1}},{"line":24,"address":[232222],"length":1,"stats":{"Line":1}},{"line":25,"address":[232254],"length":1,"stats":{"Line":1}},{"line":31,"address":[231818],"length":1,"stats":{"Line":1}},{"line":32,"address":[231858],"length":1,"stats":{"Line":1}},{"line":36,"address":[232272],"length":1,"stats":{"Line":2}},{"line":37,"address":[232351],"length":1,"stats":{"Line":2}},{"line":38,"address":[232391],"length":1,"stats":{"Line":1}},{"line":39,"address":[232710,232427],"length":1,"stats":{"Line":1}},{"line":40,"address":[232650],"length":1,"stats":{"Line":2}},{"line":42,"address":[232676],"length":1,"stats":{"Line":1}},{"line":44,"address":[232735,232700],"length":1,"stats":{"Line":3}},{"line":45,"address":[232782,232750,233094],"length":1,"stats":{"Line":2}},{"line":46,"address":[232860],"length":1,"stats":{"Line":1}},{"line":47,"address":[232887],"length":1,"stats":{"Line":1}},{"line":50,"address":[232764],"length":1,"stats":{"Line":1}},{"line":53,"address":[232906],"length":1,"stats":{"Line":1}},{"line":55,"address":[233110,232915,233331],"length":1,"stats":{"Line":3}},{"line":56,"address":[233567,233352],"length":1,"stats":{"Line":2}},{"line":57,"address":[233715,233640],"length":1,"stats":{"Line":2}},{"line":58,"address":[233685],"length":1,"stats":{"Line":1}},{"line":63,"address":[233161],"length":1,"stats":{"Line":1}},{"line":64,"address":[233181],"length":1,"stats":{"Line":1}},{"line":65,"address":[233263],"length":1,"stats":{"Line":1}},{"line":66,"address":[233311],"length":1,"stats":{"Line":1}},{"line":70,"address":[233728],"length":1,"stats":{"Line":2}},{"line":71,"address":[233798],"length":1,"stats":{"Line":2}},{"line":72,"address":[233806],"length":1,"stats":{"Line":1}},{"line":73,"address":[233849],"length":1,"stats":{"Line":1}},{"line":75,"address":[233883,234160],"length":1,"stats":{"Line":3}},{"line":76,"address":[234363,234479,234178],"length":1,"stats":{"Line":6}},{"line":77,"address":[234421],"length":1,"stats":{"Line":2}},{"line":78,"address":[234463],"length":1,"stats":{"Line":2}},{"line":80,"address":[234496],"length":1,"stats":{"Line":1}},{"line":81,"address":[234528],"length":1,"stats":{"Line":1}},{"line":87,"address":[234100],"length":1,"stats":{"Line":1}},{"line":88,"address":[234140],"length":1,"stats":{"Line":1}},{"line":92,"address":[234544],"length":1,"stats":{"Line":1}},{"line":93,"address":[234614],"length":1,"stats":{"Line":1}},{"line":94,"address":[234622],"length":1,"stats":{"Line":1}},{"line":95,"address":[234665],"length":1,"stats":{"Line":1}},{"line":97,"address":[234699,234976],"length":1,"stats":{"Line":3}},{"line":98,"address":[235295,235179,234994],"length":1,"stats":{"Line":6}},{"line":99,"address":[235237],"length":1,"stats":{"Line":2}},{"line":100,"address":[235279],"length":1,"stats":{"Line":2}},{"line":102,"address":[235312],"length":1,"stats":{"Line":1}},{"line":103,"address":[235344],"length":1,"stats":{"Line":1}},{"line":109,"address":[234916],"length":1,"stats":{"Line":1}},{"line":110,"address":[234956],"length":1,"stats":{"Line":1}},{"line":114,"address":[235360],"length":1,"stats":{"Line":1}},{"line":115,"address":[235421],"length":1,"stats":{"Line":1}},{"line":116,"address":[235455],"length":1,"stats":{"Line":1}},{"line":117,"address":[235480,235728],"length":1,"stats":{"Line":1}},{"line":118,"address":[235700],"length":1,"stats":{"Line":1}},{"line":120,"address":[235759],"length":1,"stats":{"Line":1}},{"line":121,"address":[235932,235780,235809],"length":1,"stats":{"Line":3}},{"line":122,"address":[235821,235850,235934],"length":1,"stats":{"Line":2}},{"line":125,"address":[235790],"length":1,"stats":{"Line":0}},{"line":127,"address":[235835],"length":1,"stats":{"Line":1}},{"line":131,"address":[235968],"length":1,"stats":{"Line":2}},{"line":133,"address":[236040],"length":1,"stats":{"Line":2}},{"line":134,"address":[236197],"length":1,"stats":{"Line":1}},{"line":138,"address":[236081],"length":1,"stats":{"Line":1}},{"line":139,"address":[236097],"length":1,"stats":{"Line":1}},{"line":141,"address":[236217,236106,236285],"length":1,"stats":{"Line":3}},{"line":142,"address":[236323],"length":1,"stats":{"Line":1}},{"line":143,"address":[236332],"length":1,"stats":{"Line":1}},{"line":149,"address":[236370,236275],"length":1,"stats":{"Line":2}},{"line":150,"address":[236344],"length":1,"stats":{"Line":1}},{"line":154,"address":[236445],"length":1,"stats":{"Line":1}},{"line":155,"address":[236488,236779],"length":1,"stats":{"Line":1}},{"line":158,"address":[236591,237058,236810],"length":1,"stats":{"Line":2}},{"line":159,"address":[236868,237097,237167],"length":1,"stats":{"Line":2}},{"line":162,"address":[237244,237154,237206],"length":1,"stats":{"Line":3}},{"line":163,"address":[237270],"length":1,"stats":{"Line":1}},{"line":164,"address":[237217],"length":1,"stats":{"Line":1}},{"line":168,"address":[237314],"length":1,"stats":{"Line":1}}],"covered":84,"coverable":85},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","graph.rs"],"content":"use crate::spreadsheet::Spreadsheet;\n\npub fn add_children(sheet: \u0026mut Spreadsheet, cell1: i32, cell2: i32, formula: i16, row: i16, col: i16) {\n    if formula == -1 {\n        return;\n    }\n    let rem = formula % 10;\n    let child_key = sheet.get_key(row, col);\n    if rem == 0 {\n        sheet.add_child(\u0026cell1, \u0026child_key);\n        sheet.add_child(\u0026cell2, \u0026child_key);\n    }\n    else if rem == 2 {\n        sheet.add_child(\u0026cell1, \u0026child_key);\n    }\n    else if rem == 3 {\n        sheet.add_child(\u0026cell2, \u0026child_key);\n    }\n    else {\n        // For range operations, use the optimized range_children structure\n        sheet.add_range_child(cell1, cell2, child_key);\n    }\n}\n\npub fn remove_all_parents(sheet: \u0026mut Spreadsheet, row: i16, col: i16) {\n    // This removes the child row, col from its parent cells\n    let child_key = sheet.get_key(row, col);\n    \n    let meta = match sheet.cell_meta.get(\u0026child_key) {\n        Some(meta) =\u003e meta,\n        None =\u003e return, // No metadata, no parents to remove\n    };\n    \n    if meta.formula == -1 {\n        return;\n    }\n    \n    let rem: i16 = (meta.formula % 10) as i16;\n    \n    if rem \u003e= 5 \u0026\u0026 rem \u003c= 9 {\n        // Use the optimized range_children removal for range operations\n        sheet.remove_range_child(child_key);\n    }\n    else if rem == 0 {\n        let parent1= meta.parent1;\n        let parent2 = meta.parent2;\n        sheet.remove_child(parent1, child_key);\n        sheet.remove_child(parent2, child_key);\n    }\n    else if rem == 2 {\n        sheet.remove_child(meta.parent1, child_key);\n    }\n    else if rem == 3 {\n        sheet.remove_child(meta.parent2, child_key);\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::spreadsheet::Spreadsheet;\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_add_children_both_parents() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(0, 1);\n        let child = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, parent2, 0, 1, 1); // Formula type 0\n        assert!(sheet.get_cell_children(parent1).unwrap().contains(\u0026child));\n        assert!(sheet.get_cell_children(parent2).unwrap().contains(\u0026child));\n    }\n\n    #[test]\n    fn test_add_children_single_parent() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let child = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, -1, 2, 1, 1); // Formula type 2\n        assert!(sheet.get_cell_children(parent1).unwrap().contains(\u0026child));\n        assert!(sheet.get_cell_children(-1).is_none());\n    }\n\n    #[test]\n    fn test_add_children_range() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, parent2, 5, 2, 2); // Formula type 5 (SUM)\n    }\n\n    #[test]\n    fn test_remove_all_parents_no_meta() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        remove_all_parents(\u0026mut sheet, 1, 1);\n        assert!(!sheet.cell_meta.contains_key(\u0026sheet.get_key(1, 1)));\n    }\n\n    #[test]\n    fn test_remove_all_parents_single_parent() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let child = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, -1, 2, 1, 1); \n        let meta = sheet.get_cell_meta(1, 1); \n        meta.parent1 = parent1;\n        meta.formula = 2; \n        remove_all_parents(\u0026mut sheet, 1, 1);\n        let children = sheet.get_cell_children(parent1);\n        assert!(children.is_none() || !children.unwrap().contains(\u0026child));\n    }\n\n    #[test]\n    fn test_remove_all_parents_range() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let parent1 = sheet.get_key(0, 0);\n        let parent2 = sheet.get_key(1, 1);\n        add_children(\u0026mut sheet, parent1, parent2, 5, 2, 2); // adds range child\n        let meta = sheet.get_cell_meta(2, 2); \n        meta.parent1 = parent1;\n        meta.parent2 = parent2;\n        meta.formula = 5;\n        remove_all_parents(\u0026mut sheet, 2, 2);\n    }}","traces":[{"line":3,"address":[185664],"length":1,"stats":{"Line":1}},{"line":4,"address":[185745],"length":1,"stats":{"Line":1}},{"line":7,"address":[185761,185841],"length":1,"stats":{"Line":1}},{"line":8,"address":[185813],"length":1,"stats":{"Line":1}},{"line":9,"address":[185833],"length":1,"stats":{"Line":1}},{"line":10,"address":[185862],"length":1,"stats":{"Line":1}},{"line":11,"address":[185882],"length":1,"stats":{"Line":1}},{"line":13,"address":[185907],"length":1,"stats":{"Line":2}},{"line":14,"address":[185918],"length":1,"stats":{"Line":1}},{"line":16,"address":[185943],"length":1,"stats":{"Line":1}},{"line":17,"address":[185954],"length":1,"stats":{"Line":0}},{"line":21,"address":[185979],"length":1,"stats":{"Line":1}},{"line":25,"address":[186016],"length":1,"stats":{"Line":1}},{"line":27,"address":[186046],"length":1,"stats":{"Line":1}},{"line":29,"address":[186066],"length":1,"stats":{"Line":1}},{"line":30,"address":[186116],"length":1,"stats":{"Line":1}},{"line":34,"address":[186131],"length":1,"stats":{"Line":1}},{"line":38,"address":[186197,186143],"length":1,"stats":{"Line":1}},{"line":40,"address":[186231,186189],"length":1,"stats":{"Line":2}},{"line":42,"address":[186242],"length":1,"stats":{"Line":1}},{"line":44,"address":[186218],"length":1,"stats":{"Line":1}},{"line":45,"address":[186266],"length":1,"stats":{"Line":0}},{"line":46,"address":[186272],"length":1,"stats":{"Line":0}},{"line":47,"address":[186283],"length":1,"stats":{"Line":0}},{"line":48,"address":[186301],"length":1,"stats":{"Line":0}},{"line":50,"address":[186320],"length":1,"stats":{"Line":1}},{"line":51,"address":[186336],"length":1,"stats":{"Line":1}},{"line":53,"address":[186357],"length":1,"stats":{"Line":0}},{"line":54,"address":[186377],"length":1,"stats":{"Line":0}}],"covered":22,"coverable":29},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","main.rs"],"content":"mod cell;\nmod spreadsheet;\nmod evaluator;\nmod formula;\nmod graph;\nmod reevaluate_topo;\nmod visualize_cells;\nuse std::env;\nuse std::io::{self, Write};\nuse std::process;\nuse std::thread::sleep;\nuse std::time::{Duration, Instant};\n// use sys_info;  // Add the system information library\n\nuse spreadsheet::Spreadsheet;\nuse spreadsheet::CommandStatus;\nuse evaluator::handle_command;\n\n// Updated memory usage structure\n// struct MemoryUsage {\n//     physical_mem: u64,\n// }\n\n// Improved cross-platform memory usage function using sys-info crate\n// fn memory_stats() -\u003e Option\u003cMemoryUsage\u003e {\n//     match sys_info::mem_info() {\n//         Ok(mem_info) =\u003e {\n//             // Calculate memory used by the process\n//             // On most systems this returns the system-wide memory usage\n//             // For process-specific usage, we use a percentage estimate\n            \n//             // Calculate used memory in bytes\n//             let used_mem = (mem_info.total - mem_info.free) * 1024; // Convert KB to bytes\n            \n//             // Approximate the process memory as a fraction of total used memory\n//             // This is a rough estimate - actual process memory would require platform-specific code\n//             let process_estimate = used_mem / 50; // Assuming our process uses ~2% of used memory\n            \n//             Some(MemoryUsage {\n//                 physical_mem: process_estimate,\n//             })\n//         },\n//         Err(_) =\u003e {\n//             // Fallback if memory info retrieval fails\n//             Some(MemoryUsage {\n//                 physical_mem: 10 * 1024 * 1024, // 10 MB placeholder\n//             })\n//         }\n//     }\n// }\n\nfn main() {\n    let args: Vec\u003cString\u003e = env::args().collect();\n    if args.len() != 3 {\n        eprintln!(\"Usage: {} \u003crows\u003e \u003ccolumns\u003e\", args[0]);\n        process::exit(1);\n    }\n    \n    let rows: i16 = args[1].parse().unwrap_or_else(|_| {\n        eprintln!(\"Invalid number for rows\");\n        process::exit(1);\n    });\n\n    let cols: i16 = args[2].parse().unwrap_or_else(|_| {\n        eprintln!(\"Invalid number for columns\");\n        process::exit(1);\n    });\n        \n    let mut sleep_time = 0.0; // Initialize sleep time\n    let start = Instant::now();\n        \n    let mut sheet = match Spreadsheet::create(rows, cols) {\n        Some(s) =\u003e s,\n        None =\u003e {\n            eprintln!(\"Failed to create spreadsheet with dimensions {}x{}\", rows, cols);\n            eprintln!(\"Please try smaller dimensions.\");\n            process::exit(1);\n        }\n    };\n    let mut command_time = start.elapsed().as_secs_f64();\n    let mut last_time = command_time; // Update last_time with the command time\n    \n    // println!(\"Spreadsheet created in {:.2} seconds.\", command_time);\n    let mut last_status = \"ok\"; // Placeholder for last status\n    let mut input = String::with_capacity(128);\n    \n    // Main loop for command input\n    loop {\n        sheet.print_spreadsheet();\n        // if let Some(usage) = memory_stats() {\n        //     print!(\"[{:.1}s, {:.1}MB] ({}) \u003e \", last_time, usage.physical_mem as f64 / (1024.0 *1024.0), last_status);\n        // }\n        print!(\"[{:.1}s ({}) \u003e \", last_time, last_status);\n        io::stdout().flush().unwrap(); // Ensure the prompt is shown\n    \n        input.clear();\n        if io::stdin().read_line(\u0026mut input).unwrap() == 0 {\n            break; // End of input\n        }\n        \n        let trimmed = input.trim(); // Remove any newline characters\n        if trimmed == \"q\" {\n            break;\n        }\n        \n        // Process the command and measure execution time\n        let start = Instant::now();\n        // Pass by reference instead of cloning\n        let status = handle_command(\u0026mut sheet, trimmed, \u0026mut sleep_time);\n        command_time = start.elapsed().as_secs_f64();\n    \n        if sleep_time \u003c= command_time {\n            sleep_time = 0.0;\n        } else {\n            sleep_time -= command_time;\n        }\n        last_time = command_time + sleep_time;\n        if sleep_time \u003e 0.0 {\n            sleep(Duration::from_secs_f64(sleep_time));\n        }\n        sleep_time = 0.0;\n    \n        // Update last_status based on the current command status\n        last_status = match status {\n            CommandStatus::CmdOk =\u003e \"ok\",\n            CommandStatus::CmdUnrecognized =\u003e \"unrecognized_cmd\",\n            CommandStatus::CmdCircularRef =\u003e \"circular_ref\",\n            CommandStatus::CmdInvalidCell =\u003e \"invalid_cell\",\n        };\n    }\n}","traces":[{"line":52,"address":[176611,173456,176733],"length":1,"stats":{"Line":0}},{"line":53,"address":[173463],"length":1,"stats":{"Line":0}},{"line":54,"address":[173588,173525],"length":1,"stats":{"Line":0}},{"line":55,"address":[176636,173629],"length":1,"stats":{"Line":0}},{"line":56,"address":[176714],"length":1,"stats":{"Line":0}},{"line":59,"address":[173594,173674],"length":1,"stats":{"Line":0}},{"line":60,"address":[197275],"length":1,"stats":{"Line":0}},{"line":61,"address":[197315],"length":1,"stats":{"Line":0}},{"line":64,"address":[173814],"length":1,"stats":{"Line":0}},{"line":65,"address":[197355],"length":1,"stats":{"Line":0}},{"line":66,"address":[197395],"length":1,"stats":{"Line":0}},{"line":69,"address":[173997],"length":1,"stats":{"Line":0}},{"line":70,"address":[174009],"length":1,"stats":{"Line":0}},{"line":72,"address":[174065],"length":1,"stats":{"Line":0}},{"line":73,"address":[174157],"length":1,"stats":{"Line":0}},{"line":75,"address":[174147,174393],"length":1,"stats":{"Line":0}},{"line":76,"address":[174485],"length":1,"stats":{"Line":0}},{"line":77,"address":[174530],"length":1,"stats":{"Line":0}},{"line":80,"address":[174337,174603],"length":1,"stats":{"Line":0}},{"line":81,"address":[174660],"length":1,"stats":{"Line":0}},{"line":84,"address":[174678],"length":1,"stats":{"Line":0}},{"line":85,"address":[174718],"length":1,"stats":{"Line":0}},{"line":88,"address":[176570],"length":1,"stats":{"Line":0}},{"line":89,"address":[174735],"length":1,"stats":{"Line":0}},{"line":93,"address":[174862],"length":1,"stats":{"Line":0}},{"line":94,"address":[175326],"length":1,"stats":{"Line":0}},{"line":96,"address":[175579],"length":1,"stats":{"Line":0}},{"line":97,"address":[175885,175586],"length":1,"stats":{"Line":0}},{"line":101,"address":[175917],"length":1,"stats":{"Line":0}},{"line":102,"address":[175987],"length":1,"stats":{"Line":0}},{"line":107,"address":[176027],"length":1,"stats":{"Line":0}},{"line":109,"address":[176071],"length":1,"stats":{"Line":0}},{"line":110,"address":[176125],"length":1,"stats":{"Line":0}},{"line":112,"address":[176268,176213],"length":1,"stats":{"Line":0}},{"line":113,"address":[176270],"length":1,"stats":{"Line":0}},{"line":115,"address":[176237],"length":1,"stats":{"Line":0}},{"line":117,"address":[176283],"length":1,"stats":{"Line":0}},{"line":118,"address":[176310],"length":1,"stats":{"Line":0}},{"line":119,"address":[176375],"length":1,"stats":{"Line":0}},{"line":121,"address":[176329],"length":1,"stats":{"Line":0}},{"line":124,"address":[176341,176538],"length":1,"stats":{"Line":0}},{"line":125,"address":[176424],"length":1,"stats":{"Line":0}},{"line":126,"address":[176453],"length":1,"stats":{"Line":0}},{"line":127,"address":[176482],"length":1,"stats":{"Line":0}},{"line":128,"address":[176511],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":45},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","reevaluate_topo.rs"],"content":"use crate::spreadsheet::Spreadsheet;\nuse crate::cell::CellValue;\nuse std::collections::HashSet;\nuse crate::formula::{eval_max, eval_min, sum_value, eval_variance, eval_avg};\n\npub fn sleep_fn(sheet: \u0026mut Spreadsheet, row: i16, col: i16, value: i32, sleep_val: \u0026mut f64) {\n    *sheet.get_mut_cell(row, col) = CellValue::Integer(value);\n    if value \u003c 0 {\n        return;\n    }\n    *sleep_val += value as f64;\n}\n\npub fn reevaluate_formula(sheet: \u0026mut Spreadsheet, row: i16, col: i16, sleep_val: \u0026mut f64) {\n\n    let cell_meta = sheet.get_cell_meta(row, col);\n    let rem = cell_meta.formula % 10;\n    let msb = cell_meta.formula / 10;\n    let parent1 = cell_meta.parent1;\n    let parent2 = cell_meta.parent2;\n\n    match rem {\n        0 =\u003e {\n            let par1 = sheet.get_key_cell(parent1);\n            let par2 = sheet.get_key_cell(parent2);\n            if CellValue::Error == *par1 || CellValue::Error == *par2 {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return;\n            }\n            if let CellValue::Integer(p1_value) = par1{\n                if let CellValue::Integer(p2_value) = par2 {\n                    match msb {\n                        1 =\u003e {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value + p2_value);\n                        }\n                        2 =\u003e {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value - p2_value);\n                        }\n                        4 =\u003e {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value * p2_value);\n                        }\n                        _ =\u003e {\n                            if *p2_value == 0 {\n                                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                            } else {\n                                *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value / p2_value);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        2 =\u003e {\n            let par1 = sheet.get_key_cell(parent1);\n            if CellValue::Error == *par1 {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return;\n            }\n            if let CellValue::Integer(p1_value) = par1 {\n                match msb {\n                    1 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value + parent2);\n                    }\n                    2 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value - parent2);\n                    }\n                    4 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value * parent2);\n                    }\n                    3 =\u003e {\n                        if parent2 == 0 {\n                            *sheet.get_mut_cell(row, col) = CellValue::Error;\n                        } else {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(p1_value / parent2);\n                        }\n                    }\n                    _ =\u003e {\n                        sleep_fn(sheet, row, col, *p1_value, sleep_val);\n                    }\n                }\n            }\n        }\n        3 =\u003e {\n            let par2 = sheet.get_key_cell(parent2);\n            if CellValue::Error == *par2 {\n                *sheet.get_mut_cell(row, col) = CellValue::Error;\n                return;\n            }\n            if let CellValue::Integer(p2_value) = par2 {\n                match msb {\n                    1 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(parent1 + p2_value);\n                    }\n                    2 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(parent1 - p2_value);\n                    }\n                    4 =\u003e {\n                        *sheet.get_mut_cell(row, col) = CellValue::Integer(parent1 * p2_value);\n                    }\n                    _ =\u003e {\n                        if *p2_value == 0 {\n                            *sheet.get_mut_cell(row, col) = CellValue::Error;\n                        } else {\n                            *sheet.get_mut_cell(row, col) = CellValue::Integer(parent1 / p2_value);\n                        }\n                    }\n                }\n            }\n        }\n        5 =\u003e { sum_value(sheet, row, col, parent1, parent2); }\n        6 =\u003e { eval_avg(sheet, row, col, parent1, parent2); }\n        7 =\u003e { eval_min(sheet, row, col, parent1, parent2); }\n        8 =\u003e { eval_max(sheet, row, col, parent1, parent2); }\n        _ =\u003e { eval_variance(sheet, row, col, parent1, parent2); }\n    }\n}\n\npub fn toposort_reval_detect_cycle(sheet: \u0026mut Spreadsheet, row: i16, col: i16, sleep_val: \u0026mut f64) -\u003e bool {  \n    let cell_key = sheet.get_key(row, col); \n    // These collections will be used for the topological sort and cycle detection\n    let mut fully_visited: HashSet\u003ci32\u003e = HashSet::new();\n    let mut result: Vec\u003ci32\u003e = Vec::new();\n    let mut dfs_stack: Vec\u003c(i32, bool)\u003e = Vec::new();\n    let mut in_current_path: HashSet\u003ci32\u003e = HashSet::new();\n    \n    // Helper to push all dependents (both direct and range-based) for a given cell key\n    fn push_dependents(cell_key: i32, sheet: \u0026Spreadsheet, stack: \u0026mut Vec\u003c(i32, bool)\u003e, fully_visited: \u0026HashSet\u003ci32\u003e) {\n        // Direct children from standard dependencies\n        if let Some(children) = sheet.get_cell_children(cell_key) {\n            for child in children {\n                if !fully_visited.contains(child) {\n                    stack.push((*child, false));\n                }\n            }\n        }\n\n        for range_child in \u0026sheet.range_children {\n            if !fully_visited.contains(\u0026range_child.child_key) \u0026\u0026 sheet.is_cell_in_range(cell_key, range_child.start_key, range_child.end_key) {\n                stack.push((range_child.child_key, false));\n            }\n        }\n    }\n    \n    // Start from all direct children and range-based children of the updated cell\n    push_dependents(cell_key, sheet, \u0026mut dfs_stack, \u0026fully_visited);\n    \n    while let Some((current, expanded)) = dfs_stack.pop() {\n        if expanded {\n            // If we're processing a fully expanded node:\n            in_current_path.remove(\u0026current);\n            if !result.contains(\u0026current) {\n                result.push(current);\n            }\n            fully_visited.insert(current);\n        } else {\n            // If we haven't expanded this node yet:\n            if in_current_path.contains(\u0026current) {\n                // Cycle detected\n                // Debugging output\n                // println!(\"Cycle detected at cell: {}\", current);\n                // Uncomment the following line to see the cycle path\n                // println!(\"Cycle path: {:?}\", in_current_path);\n                return true;\n            }\n            \n            // Add back the current node as expanded\n            dfs_stack.push((current, true));\n            in_current_path.insert(current);\n            \n            // Process all its dependents (both direct and range-based)\n            push_dependents(current, sheet, \u0026mut dfs_stack, \u0026fully_visited);\n        }\n    }\n    \n    // Reverse the result to get the correct topological order\n    result.reverse();\n    \n    // Now reevaluate all cells in the topological order\n    for key in result {\n        if key \u003e= 0 {\n            let (row, col) = sheet.get_row_col(key);\n            reevaluate_formula(sheet, row, col, sleep_val);\n        }\n    }\n    \n    false // No cycle detected\n}\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::cell::CellValue;\n    use crate::evaluator::set_cell_value;\n    use crate::spreadsheet::{CommandStatus, Spreadsheet};\n\n    fn create_test_spreadsheet(rows: i16, cols: i16) -\u003e Spreadsheet {\n        Spreadsheet::create(rows, cols).unwrap()\n    }\n\n    #[test]\n    fn test_sleep_fn_positive() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        sleep_fn(\u0026mut sheet, 0, 0, 5, \u0026mut sleep_time);\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(5));\n        assert_eq!(sleep_time, 5.0);\n    }\n\n    #[test]\n    fn test_sleep_fn_negative() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        let mut sleep_time = 0.0;\n        sleep_fn(\u0026mut sheet, 0, 0, -5, \u0026mut sleep_time);\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(-5));\n        assert_eq!(sleep_time, 0.0);\n    }\n\n    // #[test]\n    // fn test_reevaluate_formula_arithmetic() {\n    //     let mut sheet = create_test_spreadsheet(5, 5);\n    //     *sheet.get_mut_cell(0, 0) = CellValue::Integer(3);\n    //     *sheet.get_mut_cell(0, 1) = CellValue::Integer(2);\n    //     {\n    //         let meta = sheet.get_cell_meta_mut(1, 1);\n    //         meta.parent1 = sheet.get_key(0, 0);\n    //         meta.parent2 = sheet.get_key(0, 1);\n    //         meta.formula = 10; // Addition\n    //     }\n    //     let mut sleep_time = 0.0;\n    //     reevaluate_formula(\u0026mut sheet, 1, 1, \u0026mut sleep_time);\n    //     assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(5));\n    // }\n\n    // #[test]\n    // fn test_reevaluate_formula_arithmetic_div_zero() {\n    //     let mut sheet = create_test_spreadsheet(5, 5);\n    //     *sheet.get_mut_cell(0, 0) = CellValue::Integer(5);\n    //     *sheet.get_mut_cell(0, 1) = CellValue::Integer(0);\n    //     let meta = sheet.get_cell_meta(1, 1);\n    //     meta.parent1 = sheet.get_key(0, 0);\n    //     meta.parent2 = sheet.get_key(0, 1);\n    //     meta.formula = 30; // Division\n    //     let mut sleep_time = 0.0;\n    //     reevaluate_formula(\u0026mut sheet, 1, 1, \u0026mut sleep_time);\n    //     assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    // }\n\n    // #[test]\n    // fn test_reevaluate_formula_error() {\n    //     let mut sheet = create_test_spreadsheet(5, 5);\n    //     *sheet.get_mut_cell(0, 0) = CellValue::Error;\n    //     let meta = sheet.get_cell_meta(1, 1);\n    //     meta.parent1 = sheet.get_key(0, 0);\n    //     meta.parent2 = sheet.get_key(0, 1);\n    //     meta.formula = 10; // Addition\n    //     let mut sleep_time = 0.0;\n    //     reevaluate_formula(\u0026mut sheet, 1, 1, \u0026mut sleep_time);\n    //     assert_eq!(*sheet.get_cell(1, 1), CellValue::Error);\n    // }\n\n    // #[test]\n    // fn test_reevaluate_formula_sum() {\n    //     let mut sheet = create_test_spreadsheet(5, 5);\n    //     *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n    //     *sheet.get_mut_cell(0, 1) = CellValue::Integer(2);\n    //     let meta = sheet.get_cell_meta(1, 1);\n    //     meta.parent1 = sheet.get_key(0, 0);\n    //     meta.parent2 = sheet.get_key(0, 1);\n    //     meta.formula = 5; // SUM\n    //     let mut sleep_time = 0.0;\n    //     reevaluate_formula(\u0026mut sheet, 1, 1, \u0026mut sleep_time);\n    //     assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(3));\n    // }\n\n    #[test]\n    fn test_cycle_prevention() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        let mut sleep_time = 0.0;\n        assert_eq!(set_cell_value(\u0026mut sheet, 1, 1, \"A1\", \u0026mut sleep_time), CommandStatus::CmdOk);\n        assert_eq!(set_cell_value(\u0026mut sheet, 0, 0, \"B2\", \u0026mut sleep_time), CommandStatus::CmdCircularRef);\n        assert!(!toposort_reval_detect_cycle(\u0026mut sheet, 0, 0, \u0026mut sleep_time));\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(1)); // A1 unchanged\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(1)); // B2 still references A1\n    }\n\n    #[test]\n    fn test_toposort_reval_no_cycle() {\n        let mut sheet = create_test_spreadsheet(5, 5);\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(1);\n        let mut sleep_time = 0.0;\n        set_cell_value(\u0026mut sheet, 1, 1, \"A1\", \u0026mut sleep_time);\n        assert!(!toposort_reval_detect_cycle(\u0026mut sheet, 1, 1, \u0026mut sleep_time));\n    }\n}","traces":[{"line":6,"address":[216304],"length":1,"stats":{"Line":1}},{"line":7,"address":[216350],"length":1,"stats":{"Line":1}},{"line":8,"address":[216390],"length":1,"stats":{"Line":1}},{"line":11,"address":[216404],"length":1,"stats":{"Line":1}},{"line":14,"address":[216432],"length":1,"stats":{"Line":1}},{"line":16,"address":[216507],"length":1,"stats":{"Line":1}},{"line":17,"address":[216625,216534],"length":1,"stats":{"Line":1}},{"line":18,"address":[216659,216753,216597],"length":1,"stats":{"Line":2}},{"line":19,"address":[216691],"length":1,"stats":{"Line":1}},{"line":20,"address":[216704],"length":1,"stats":{"Line":1}},{"line":22,"address":[216718],"length":1,"stats":{"Line":1}},{"line":24,"address":[216824],"length":1,"stats":{"Line":0}},{"line":25,"address":[216851],"length":1,"stats":{"Line":0}},{"line":26,"address":[217198,216874],"length":1,"stats":{"Line":0}},{"line":27,"address":[217237],"length":1,"stats":{"Line":0}},{"line":30,"address":[217285],"length":1,"stats":{"Line":0}},{"line":31,"address":[217346,217320],"length":1,"stats":{"Line":0}},{"line":32,"address":[217363],"length":1,"stats":{"Line":0}},{"line":33,"address":[217517],"length":1,"stats":{"Line":0}},{"line":34,"address":[217434],"length":1,"stats":{"Line":0}},{"line":36,"address":[217615],"length":1,"stats":{"Line":0}},{"line":37,"address":[217532],"length":1,"stats":{"Line":0}},{"line":39,"address":[217713],"length":1,"stats":{"Line":0}},{"line":40,"address":[217630],"length":1,"stats":{"Line":0}},{"line":43,"address":[217780,217878,217410],"length":1,"stats":{"Line":0}},{"line":44,"address":[217739],"length":1,"stats":{"Line":0}},{"line":46,"address":[217795],"length":1,"stats":{"Line":0}},{"line":54,"address":[216908],"length":1,"stats":{"Line":1}},{"line":55,"address":[216929],"length":1,"stats":{"Line":1}},{"line":56,"address":[217922],"length":1,"stats":{"Line":0}},{"line":59,"address":[217978,217888],"length":1,"stats":{"Line":2}},{"line":60,"address":[217995],"length":1,"stats":{"Line":1}},{"line":61,"address":[218176],"length":1,"stats":{"Line":0}},{"line":62,"address":[218093],"length":1,"stats":{"Line":0}},{"line":64,"address":[218273],"length":1,"stats":{"Line":0}},{"line":65,"address":[218190],"length":1,"stats":{"Line":0}},{"line":67,"address":[218370],"length":1,"stats":{"Line":0}},{"line":68,"address":[218287],"length":1,"stats":{"Line":0}},{"line":71,"address":[218543,218379,218446],"length":1,"stats":{"Line":0}},{"line":72,"address":[218405],"length":1,"stats":{"Line":0}},{"line":74,"address":[218460],"length":1,"stats":{"Line":0}},{"line":78,"address":[218066],"length":1,"stats":{"Line":1}},{"line":84,"address":[216963],"length":1,"stats":{"Line":0}},{"line":85,"address":[216984],"length":1,"stats":{"Line":0}},{"line":86,"address":[218587],"length":1,"stats":{"Line":0}},{"line":89,"address":[218643,218553],"length":1,"stats":{"Line":0}},{"line":90,"address":[218660],"length":1,"stats":{"Line":0}},{"line":91,"address":[218813],"length":1,"stats":{"Line":0}},{"line":92,"address":[218730],"length":1,"stats":{"Line":0}},{"line":94,"address":[218910],"length":1,"stats":{"Line":0}},{"line":95,"address":[218827],"length":1,"stats":{"Line":0}},{"line":97,"address":[219007],"length":1,"stats":{"Line":0}},{"line":98,"address":[218924],"length":1,"stats":{"Line":0}},{"line":101,"address":[219074,219171,218707],"length":1,"stats":{"Line":0}},{"line":102,"address":[219033],"length":1,"stats":{"Line":0}},{"line":104,"address":[219088],"length":1,"stats":{"Line":0}},{"line":110,"address":[217039],"length":1,"stats":{"Line":0}},{"line":111,"address":[217085],"length":1,"stats":{"Line":0}},{"line":112,"address":[217131],"length":1,"stats":{"Line":0}},{"line":113,"address":[217177],"length":1,"stats":{"Line":0}},{"line":114,"address":[216799],"length":1,"stats":{"Line":0}},{"line":118,"address":[219184,220437,220464],"length":1,"stats":{"Line":1}},{"line":119,"address":[219243],"length":1,"stats":{"Line":1}},{"line":121,"address":[219280],"length":1,"stats":{"Line":1}},{"line":122,"address":[219293],"length":1,"stats":{"Line":1}},{"line":123,"address":[219337],"length":1,"stats":{"Line":1}},{"line":124,"address":[219406],"length":1,"stats":{"Line":1}},{"line":127,"address":[220480],"length":1,"stats":{"Line":1}},{"line":129,"address":[220549],"length":1,"stats":{"Line":1}},{"line":130,"address":[220598,220662],"length":1,"stats":{"Line":2}},{"line":131,"address":[220735],"length":1,"stats":{"Line":1}},{"line":132,"address":[220754],"length":1,"stats":{"Line":1}},{"line":137,"address":[220635,220772,220835],"length":1,"stats":{"Line":2}},{"line":138,"address":[220855],"length":1,"stats":{"Line":0}},{"line":139,"address":[220906],"length":1,"stats":{"Line":0}},{"line":145,"address":[219516,219472],"length":1,"stats":{"Line":2}},{"line":147,"address":[219526],"length":1,"stats":{"Line":1}},{"line":148,"address":[219621],"length":1,"stats":{"Line":1}},{"line":150,"address":[219698],"length":1,"stats":{"Line":1}},{"line":151,"address":[219901],"length":1,"stats":{"Line":1}},{"line":152,"address":[219957,220005],"length":1,"stats":{"Line":2}},{"line":154,"address":[220007,219986],"length":1,"stats":{"Line":2}},{"line":157,"address":[219671,219712],"length":1,"stats":{"Line":2}},{"line":163,"address":[219752],"length":1,"stats":{"Line":1}},{"line":167,"address":[219718],"length":1,"stats":{"Line":1}},{"line":168,"address":[219772],"length":1,"stats":{"Line":1}},{"line":171,"address":[219799],"length":1,"stats":{"Line":1}},{"line":176,"address":[220022,219635],"length":1,"stats":{"Line":2}},{"line":179,"address":[220029,220271,220229],"length":1,"stats":{"Line":3}},{"line":180,"address":[220289],"length":1,"stats":{"Line":1}},{"line":181,"address":[220366],"length":1,"stats":{"Line":1}},{"line":182,"address":[220419],"length":1,"stats":{"Line":1}},{"line":186,"address":[220299],"length":1,"stats":{"Line":1}}],"covered":46,"coverable":93},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","spreadsheet.rs"],"content":"use std::cmp::min;\nuse std::collections::HashMap;\nuse std::collections::HashSet;\nuse crate::cell::{CellValue, parse_cell_reference}; \nuse crate::visualize_cells;\n\n\n// Constants\nconst MAX_ROWS: i16 = 999;    // Maximum number of rows in the spreadsheet   \nconst MAX_COLS: i16 = 18278;  // Maximum number of columns in the spreadsheet\n\n// Structure to represent a range-based child relationship\n#[derive(Debug, Clone, PartialEq, Eq, Hash)]\npub struct RangeChild {\n    pub start_key: i32,       // Range start cell key\n    pub end_key: i32,         // Range end cell key\n    pub child_key: i32,       // Child cell key\n}\n\n#[derive(Debug, PartialEq)]\npub enum CommandStatus {\n    CmdOk,\n    CmdUnrecognized,\n    CmdCircularRef,\n    CmdInvalidCell,\n}\n\n// Modified CellMeta to remove children (they're now stored separately)\n#[derive(Debug, Clone)]\npub struct CellMeta {\n    pub formula: i16,\n    pub parent1: i32,\n    pub parent2: i32,\n}\n\nimpl CellMeta {\n    pub fn new() -\u003e Self {\n        CellMeta {\n            formula: -1,\n            parent1: -1,\n            parent2: -1,\n        }\n    }\n}\n\n// Spreadsheet structure with HashMap of boxed HashSets for children\npub struct Spreadsheet {\n    pub grid: Vec\u003cCellValue\u003e,                                // Vector of CellValues (contiguous in memory)\n    pub children: HashMap\u003ci32, Box\u003cHashSet\u003ci32\u003e\u003e\u003e,           // Map from cell key to boxed HashSet of children\n    pub range_children: Vec\u003cRangeChild\u003e,                     // Vector of range-based child relationships\n    pub cell_meta: HashMap\u003ci32, CellMeta\u003e,                   // Map from cell key to metadata\n    pub rows: i16,\n    pub cols: i16,\n    pub viewport_row: i16,\n    pub viewport_col: i16,\n    pub output_enabled: bool,\n}\n\nimpl Spreadsheet {\n    // Create a new spreadsheet with specified dimensions\n    pub fn create(rows: i16, cols: i16) -\u003e Option\u003cSpreadsheet\u003e {\n        if rows \u003c 1 || rows \u003e MAX_ROWS || cols \u003c 1 || cols \u003e MAX_COLS {\n            eprintln!(\"Invalid spreadsheet dimensions\");\n            return None;\n        }\n        \n        // Create empty cells - initialize with Integer(0)\n        let total = rows as usize * cols as usize;\n        let grid = vec![CellValue::Integer(0); total];\n                \n        Some(Spreadsheet {\n            grid,\n            children: HashMap::new(),\n            range_children: Vec::with_capacity(32), // Preallocate with initial size\n            cell_meta: HashMap::new(),\n            rows,\n            cols,\n            viewport_row: 0,\n            viewport_col: 0,\n            output_enabled: true,\n        })\n    }\n\n    // Helper to get cell key from coordinates\n    pub fn get_key(\u0026self, row: i16, col: i16) -\u003e i32 {\n        (row as i32 * self.cols as i32 + col as i32) as i32\n    }\n    \n    // Helper to get coordinates from cell key\n    pub fn get_row_col(\u0026self, key: i32) -\u003e (i16, i16) {\n        let row = (key / (self.cols as i32)) as i16;\n        let col = (key % (self.cols as i32)) as i16;\n        (row, col)\n    }\n\n    // Helper to get index from row and column\n    fn get_index(\u0026self, row: i16, col: i16) -\u003e usize {\n        (row as usize) * (self.cols as usize) + (col as usize)\n    }\n    \n    // Get cell metadata, creating it if it doesn't exist\n    pub fn get_cell_meta(\u0026mut self, row: i16, col: i16) -\u003e \u0026mut CellMeta {\n        let key = self.get_key(row, col);\n        self.cell_meta.entry(key).or_insert_with(CellMeta::new)\n    }\n\n    pub fn get_column_name(\u0026self, mut col: i16) -\u003e String {\n        // Pre-calculate the length needed for the string\n        let mut temp_col = col + 1; // Convert from 0-based to 1-based\n        let mut len = 0;\n        while temp_col \u003e 0 {\n            len += 1;\n            temp_col = (temp_col - 1) / 26;\n        }\n             \n        // Add column letters directly in reverse order\n        col += 1; // Convert from 0-based to 1-based\n        \n        // Handle special case for col = 0\n        if col == 0 {\n            return \"A\".to_string();\n        }\n        \n        // Create a buffer of bytes to avoid repeated string operations\n        let mut buffer = vec![0; len];\n        let mut i = len;\n        \n        while col \u003e 0 {\n            i -= 1;\n            buffer[i] = b'A' + ((col - 1) % 26) as u8;\n            col = (col - 1) / 26;\n        }\n        \n        // Convert the byte buffer to a string in one operation\n        unsafe {\n            // This is safe because we know our bytes are valid ASCII from b'A' to b'Z'\n            String::from_utf8_unchecked(buffer)\n        }\n    }\n\n    pub fn column_name_to_index(\u0026self, name: \u0026str) -\u003e i16 {\n        let bytes = name.as_bytes();\n        let mut index: i16 = 0;\n        for \u0026b in bytes {\n                        index = index * 26 + ((b - b'A') as i16 + 1);\n        }\n        index - 1 // Convert from 1-based to 0-based\n    }\n\n    pub fn get_cell(\u0026self, row: i16, col: i16) -\u003e \u0026CellValue {\n        let index = self.get_index(row, col);\n        \u0026self.grid[index]\n    }\n    \n    pub fn get_key_cell(\u0026self, cell_key: i32) -\u003e \u0026CellValue {\n        \u0026self.grid[cell_key as usize]\n    }\n\n    pub fn get_mut_cell(\u0026mut self, row: i16, col: i16) -\u003e \u0026mut CellValue {\n        let index = self.get_index(row, col);\n        \u0026mut self.grid[index]\n    }\n    \n    // Add a range-based child relationship\n    pub fn add_range_child(\u0026mut self, start_key: i32, end_key: i32, child_key: i32) {\n        self.range_children.push(RangeChild {\n            start_key,\n            end_key,\n            child_key,\n        });\n    }\n    \n    // Remove range-based child relationships for a given child\n    pub fn remove_range_child(\u0026mut self, child_key: i32) {\n        self.range_children.retain(|rc| rc.child_key != child_key);\n    }\n    \n    // Check if a cell is within a range\n    pub fn is_cell_in_range(\u0026self, cell_key: i32, start_key: i32, end_key: i32) -\u003e bool {\n        let (cell_row, cell_col) = self.get_row_col(cell_key);\n        let (start_row, start_col) = self.get_row_col(start_key);\n        let (end_row, end_col) = self.get_row_col(end_key);\n        \n        cell_row \u003e= start_row \u0026\u0026 cell_row \u003c= end_row \u0026\u0026 \n        cell_col \u003e= start_col \u0026\u0026 cell_col \u003c= end_col\n    }\n    \n    // Add a child to a cell's dependents (modified for HashMap of boxed HashSets)\n    pub fn add_child(\u0026mut self, parent_key: \u0026i32, child_key: \u0026i32) {\n        self.children\n            .entry(*parent_key)\n            .or_insert_with(|| Box::new(HashSet::with_capacity(5)))\n            .insert(*child_key);\n    }\n    \n    // Remove a child from a cell's dependents (modified for HashMap of boxed HashSets)\n    pub fn remove_child(\u0026mut self, parent_key: i32, child_key: i32) {\n        if let Some(children) = self.children.get_mut(\u0026parent_key) {\n            children.remove(\u0026child_key);\n            \n            // If the hashset is now empty, remove it from the HashMap to save memory\n            if children.is_empty() {\n                self.children.remove(\u0026parent_key);\n            }\n        }\n    }\n      \n    // Get children for a cell (immutable) (modified for HashMap of boxed HashSets)\n    pub fn get_cell_children(\u0026self, key: i32) -\u003e Option\u003c\u0026HashSet\u003ci32\u003e\u003e {\n        self.children.get(\u0026key).map(|boxed_set| boxed_set.as_ref())\n    }\n\n    pub fn print_spreadsheet(\u0026self) {\n        if !self.output_enabled {\n            return;\n        }\n        \n        let start_row = self.viewport_row;\n        let start_col = self.viewport_col;\n        let display_row = min(self.rows - start_row, 10); // Display only a portion of the spreadsheet\n        let display_col = min(self.cols - start_col, 10);\n        \n        // Print column headers\n        print!(\"     \");\n        for i in 0..display_col {\n            print!(\"{:\u003c8} \", self.get_column_name(start_col + i));\n        }\n        println!();\n        \n        // Print rows with data\n        for i in 0..display_row {\n            print!(\"{:\u003c4} \", start_row + i + 1); // Show 1-based row numbers\n            for j in 0..display_col {\n                let cell_value = self.get_cell(start_row + i, start_col + j); \n                match cell_value {\n                    CellValue::Integer(value) =\u003e print!(\"{:\u003c8} \", value),\n                    CellValue::Error =\u003e print!(\"{:\u003c8} \", \"ERR\"),\n                }\n            }\n            println!();\n        }\n    }\n\n    pub fn scroll_to_cell(\u0026mut self, cell: \u0026str) -\u003e CommandStatus {\n        match parse_cell_reference(self, cell) {\n            Ok((row, col)) =\u003e {\n                if row \u003e= 0 \u0026\u0026 row \u003c self.rows \u0026\u0026 col \u003e= 0 \u0026\u0026 col \u003c self.cols {\n                    self.viewport_row = row;\n                    self.viewport_col = col;\n                    return CommandStatus::CmdOk;\n                } else {\n                    return CommandStatus::CmdInvalidCell;\n                }\n            }\n            Err(_) =\u003e {\n                return CommandStatus::CmdUnrecognized;\n            }\n        }\n    }\n\n    pub fn scroll_viewport(\u0026mut self, direction: char) {\n        const VIEWPORT_SIZE: i16 = 10;\n        match direction {\n            'w' =\u003e {\n                self.viewport_row = if self.viewport_row \u003e 10 {\n                    self.viewport_row - 10\n                } else {\n                    0\n                };\n            }\n            's' =\u003e {\n                if self.viewport_row + VIEWPORT_SIZE \u003c self.rows {\n                    self.viewport_row += 10;\n                } else {\n                    self.viewport_row = self.rows - VIEWPORT_SIZE;\n                }\n            }\n            'a' =\u003e {\n                self.viewport_col = if self.viewport_col \u003e 10 {\n                    self.viewport_col - 10\n                } else {\n                    0\n                };\n            }\n\n            'd' =\u003e {\n                if self.viewport_col + VIEWPORT_SIZE \u003c self.cols {\n                    self.viewport_col += 10;\n                } else {\n                    self.viewport_col = self.cols - VIEWPORT_SIZE;\n                }\n            }\n            _ =\u003e {} // Invalid direction, do nothing\n        }\n    }\n    \n    pub fn visualize_cell_relationships(\u0026self, row: i16, col: i16) -\u003e CommandStatus {\n        // Check if the cell is valid\n        visualize_cells::visualize_cell_relationships(self,row, col)\n    }\n}\n\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::cell::CellValue;\n\n    #[test]\n    fn test_create_valid_dimensions() {\n        let sheet = Spreadsheet::create(5, 5).unwrap();\n        assert_eq!(sheet.rows, 5);\n        assert_eq!(sheet.cols, 5);\n        assert_eq!(sheet.grid.len(), 25);\n        assert_eq!(sheet.viewport_row, 0);\n        assert_eq!(sheet.viewport_col, 0);\n    }\n\n    #[test]\n    fn test_create_invalid_dimensions() {\n        assert!(Spreadsheet::create(0, 5).is_none());\n        assert!(Spreadsheet::create(5, 0).is_none());\n        assert!(Spreadsheet::create(MAX_ROWS + 1, 5).is_none());\n        assert!(Spreadsheet::create(5, MAX_COLS + 1).is_none());\n    }\n\n    #[test]\n    fn test_get_column_name() {\n        let sheet = Spreadsheet::create(1, 1).unwrap();\n        assert_eq!(sheet.get_column_name(0), \"A\");\n        assert_eq!(sheet.get_column_name(25), \"Z\");\n        assert_eq!(sheet.get_column_name(26), \"AA\");\n        assert_eq!(sheet.get_column_name(51), \"AZ\");\n    }\n\n    #[test]\n    fn test_column_name_to_index() {\n        let sheet = Spreadsheet::create(1, 1).unwrap();\n        assert_eq!(sheet.column_name_to_index(\"A\"), 0);\n        assert_eq!(sheet.column_name_to_index(\"Z\"), 25);\n        assert_eq!(sheet.column_name_to_index(\"AA\"), 26);\n        assert_eq!(sheet.column_name_to_index(\"AZ\"), 51);\n    }\n\n    #[test]\n    fn test_get_cell_and_get_mut_cell() {\n        let mut sheet = Spreadsheet::create(2, 2).unwrap();\n        let cell_value = sheet.get_mut_cell(0, 0);\n        *cell_value = CellValue::Integer(42);\n        assert_eq!(*sheet.get_cell(0, 0), CellValue::Integer(42));\n        assert_eq!(*sheet.get_cell(1, 1), CellValue::Integer(0));\n    }\n\n    #[test]\n    fn test_get_key_and_row_col() {\n        let sheet = Spreadsheet::create(5, 5).unwrap();\n        let key = sheet.get_key(2, 3);\n        let (row, col) = sheet.get_row_col(key);\n        assert_eq!(row, 2);\n        assert_eq!(col, 3);\n    }\n\n    #[test]\n    fn test_get_cell_meta() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        let meta = sheet.get_cell_meta(1, 1);\n        assert_eq!(meta.formula, -1);\n        assert_eq!(meta.parent1, -1);\n        assert_eq!(meta.parent2, -1);\n        meta.formula = 10;\n        assert_eq!(sheet.get_cell_meta(1, 1).formula, 10);\n    }\n\n    #[test]\n    fn test_add_remove_child() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        let parent = sheet.get_key(0, 0);\n        let child = sheet.get_key(1, 1);\n        sheet.add_child(\u0026parent, \u0026child);\n        assert!(sheet.get_cell_children(parent).unwrap().contains(\u0026child));\n        sheet.remove_child(parent, child);\n        assert!(sheet.get_cell_children(parent).is_none());\n    }\n\n    #[test]\n    fn test_is_cell_in_range() {\n        let sheet = Spreadsheet::create(5, 5).unwrap();\n        let cell_key = sheet.get_key(1, 1);\n        let start_key = sheet.get_key(0, 0);\n        let end_key = sheet.get_key(2, 2);\n        assert!(sheet.is_cell_in_range(cell_key, start_key, end_key));\n        assert!(!sheet.is_cell_in_range(cell_key, end_key, start_key));\n    }\n\n    #[test]\n    fn test_scroll_to_cell_valid() {\n        let mut sheet = Spreadsheet::create(20, 20).unwrap();\n        let status = sheet.scroll_to_cell(\"B2\");\n        assert_eq!(status, CommandStatus::CmdOk);\n        assert_eq!(sheet.viewport_row, 1);\n        assert_eq!(sheet.viewport_col, 1);\n    }\n\n    #[test]\n    fn test_scroll_to_cell_invalid() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        assert_eq!(sheet.scroll_to_cell(\"F6\"), CommandStatus::CmdInvalidCell);\n        assert_eq!(sheet.scroll_to_cell(\"1A\"), CommandStatus::CmdUnrecognized);\n    }\n\n    #[test]\n    fn test_scroll_viewport() {\n        let mut sheet = Spreadsheet::create(50, 50).unwrap();\n        sheet.scroll_viewport('s');\n        assert_eq!(sheet.viewport_row, 10);\n        sheet.scroll_viewport('d');\n        assert_eq!(sheet.viewport_col, 10);\n        sheet.scroll_viewport('w');\n        assert_eq!(sheet.viewport_row, 0);\n        sheet.scroll_viewport('a');\n        assert_eq!(sheet.viewport_col, 0);\n        sheet.viewport_row = 45;\n        sheet.scroll_viewport('s');\n        assert_eq!(sheet.viewport_row, 40);\n    }\n\n    #[test]\n    fn test_print_spreadsheet_disabled() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        sheet.output_enabled = false;\n        sheet.print_spreadsheet(); // Should not panic\n    }\n\n    #[test]\n    fn test_print_spreadsheet_with_values() {\n        let mut sheet = Spreadsheet::create(5, 5).unwrap();\n        *sheet.get_mut_cell(0, 0) = CellValue::Integer(42);\n        *sheet.get_mut_cell(1, 1) = CellValue::Error;\n        sheet.output_enabled = true;\n        sheet.print_spreadsheet(); // Should not panic\n    }\n}","traces":[{"line":37,"address":[264720],"length":1,"stats":{"Line":1}},{"line":61,"address":[264752,265421],"length":1,"stats":{"Line":11}},{"line":62,"address":[264875,264801],"length":1,"stats":{"Line":22}},{"line":63,"address":[264818],"length":1,"stats":{"Line":1}},{"line":64,"address":[264852],"length":1,"stats":{"Line":1}},{"line":68,"address":[264902,265018],"length":1,"stats":{"Line":11}},{"line":69,"address":[264934],"length":1,"stats":{"Line":11}},{"line":71,"address":[265190],"length":1,"stats":{"Line":11}},{"line":72,"address":[264975],"length":1,"stats":{"Line":11}},{"line":73,"address":[265011],"length":1,"stats":{"Line":11}},{"line":74,"address":[265074],"length":1,"stats":{"Line":11}},{"line":75,"address":[265146],"length":1,"stats":{"Line":11}},{"line":85,"address":[265456],"length":1,"stats":{"Line":1}},{"line":86,"address":[265556,265486],"length":1,"stats":{"Line":1}},{"line":90,"address":[265584],"length":1,"stats":{"Line":1}},{"line":91,"address":[265606,265715],"length":1,"stats":{"Line":1}},{"line":92,"address":[265804,265739,265697],"length":1,"stats":{"Line":2}},{"line":97,"address":[265824],"length":1,"stats":{"Line":4}},{"line":98,"address":[265932,265854],"length":1,"stats":{"Line":4}},{"line":102,"address":[265952],"length":1,"stats":{"Line":1}},{"line":103,"address":[265982],"length":1,"stats":{"Line":1}},{"line":104,"address":[266004],"length":1,"stats":{"Line":1}},{"line":107,"address":[266789,266048,266764],"length":1,"stats":{"Line":1}},{"line":109,"address":[266130,266081],"length":1,"stats":{"Line":1}},{"line":110,"address":[266119],"length":1,"stats":{"Line":1}},{"line":111,"address":[266146,266901,266128],"length":1,"stats":{"Line":3}},{"line":112,"address":[266830,266176,266803],"length":1,"stats":{"Line":2}},{"line":113,"address":[266851,266808,266906],"length":1,"stats":{"Line":2}},{"line":117,"address":[266209,266154,266224],"length":1,"stats":{"Line":2}},{"line":120,"address":[266214],"length":1,"stats":{"Line":1}},{"line":121,"address":[266245],"length":1,"stats":{"Line":0}},{"line":125,"address":[266264],"length":1,"stats":{"Line":1}},{"line":126,"address":[266296],"length":1,"stats":{"Line":1}},{"line":128,"address":[266306,266321,266738],"length":1,"stats":{"Line":3}},{"line":129,"address":[266379,266490,266463],"length":1,"stats":{"Line":2}},{"line":130,"address":[266510,266468],"length":1,"stats":{"Line":2}},{"line":131,"address":[266743,266658],"length":1,"stats":{"Line":1}},{"line":137,"address":[266334],"length":1,"stats":{"Line":1}},{"line":141,"address":[266928],"length":1,"stats":{"Line":5}},{"line":142,"address":[266989],"length":1,"stats":{"Line":5}},{"line":143,"address":[266999],"length":1,"stats":{"Line":7}},{"line":144,"address":[267006,267084,267280],"length":1,"stats":{"Line":21}},{"line":145,"address":[267099,267285,267156],"length":1,"stats":{"Line":14}},{"line":147,"address":[267062,267136],"length":1,"stats":{"Line":7}},{"line":150,"address":[267312],"length":1,"stats":{"Line":1}},{"line":151,"address":[267342],"length":1,"stats":{"Line":1}},{"line":152,"address":[267366],"length":1,"stats":{"Line":1}},{"line":155,"address":[267392],"length":1,"stats":{"Line":1}},{"line":156,"address":[267405],"length":1,"stats":{"Line":1}},{"line":159,"address":[267440],"length":1,"stats":{"Line":4}},{"line":160,"address":[267470],"length":1,"stats":{"Line":4}},{"line":161,"address":[267494],"length":1,"stats":{"Line":4}},{"line":165,"address":[267520],"length":1,"stats":{"Line":1}},{"line":166,"address":[267541],"length":1,"stats":{"Line":1}},{"line":174,"address":[267584],"length":1,"stats":{"Line":1}},{"line":175,"address":[231248,231258],"length":1,"stats":{"Line":3}},{"line":179,"address":[267616],"length":1,"stats":{"Line":1}},{"line":180,"address":[267650],"length":1,"stats":{"Line":1}},{"line":181,"address":[267684],"length":1,"stats":{"Line":1}},{"line":182,"address":[267718],"length":1,"stats":{"Line":1}},{"line":184,"address":[267756],"length":1,"stats":{"Line":1}},{"line":185,"address":[267793],"length":1,"stats":{"Line":1}},{"line":189,"address":[267840],"length":1,"stats":{"Line":1}},{"line":190,"address":[267869,267875,267904],"length":1,"stats":{"Line":5}},{"line":191,"address":[267873],"length":1,"stats":{"Line":1}},{"line":192,"address":[231280,231294,231391],"length":1,"stats":{"Line":3}},{"line":193,"address":[267902],"length":1,"stats":{"Line":1}},{"line":197,"address":[267920],"length":1,"stats":{"Line":1}},{"line":198,"address":[267942],"length":1,"stats":{"Line":1}},{"line":199,"address":[268001],"length":1,"stats":{"Line":1}},{"line":202,"address":[268018],"length":1,"stats":{"Line":1}},{"line":203,"address":[268040],"length":1,"stats":{"Line":1}},{"line":209,"address":[268080],"length":1,"stats":{"Line":1}},{"line":210,"address":[231408,231417],"length":1,"stats":{"Line":3}},{"line":213,"address":[270264,268128],"length":1,"stats":{"Line":2}},{"line":214,"address":[268148],"length":1,"stats":{"Line":2}},{"line":218,"address":[268170],"length":1,"stats":{"Line":1}},{"line":219,"address":[268190],"length":1,"stats":{"Line":1}},{"line":220,"address":[268300,268210],"length":1,"stats":{"Line":1}},{"line":221,"address":[268409,268276,268321],"length":1,"stats":{"Line":2}},{"line":224,"address":[268347],"length":1,"stats":{"Line":1}},{"line":225,"address":[268541,268381,268425],"length":1,"stats":{"Line":3}},{"line":226,"address":[269883,268557],"length":1,"stats":{"Line":2}},{"line":228,"address":[268468],"length":1,"stats":{"Line":1}},{"line":231,"address":[268581,268508],"length":1,"stats":{"Line":2}},{"line":232,"address":[268654,269035],"length":1,"stats":{"Line":1}},{"line":233,"address":[269051,269144,269007],"length":1,"stats":{"Line":3}},{"line":234,"address":[269275,269165],"length":1,"stats":{"Line":1}},{"line":235,"address":[269262],"length":1,"stats":{"Line":1}},{"line":236,"address":[269296],"length":1,"stats":{"Line":1}},{"line":237,"address":[269591],"length":1,"stats":{"Line":1}},{"line":240,"address":[269094],"length":1,"stats":{"Line":1}},{"line":244,"address":[270288],"length":1,"stats":{"Line":1}},{"line":245,"address":[270312],"length":1,"stats":{"Line":1}},{"line":246,"address":[270365],"length":1,"stats":{"Line":1}},{"line":247,"address":[270427,270395],"length":1,"stats":{"Line":2}},{"line":248,"address":[270481],"length":1,"stats":{"Line":1}},{"line":249,"address":[270488],"length":1,"stats":{"Line":1}},{"line":250,"address":[270495],"length":1,"stats":{"Line":1}},{"line":252,"address":[270410],"length":1,"stats":{"Line":1}},{"line":256,"address":[270403],"length":1,"stats":{"Line":1}},{"line":261,"address":[270512],"length":1,"stats":{"Line":1}},{"line":263,"address":[270532],"length":1,"stats":{"Line":1}},{"line":264,"address":[270744],"length":1,"stats":{"Line":1}},{"line":265,"address":[270578,270759,270695,270732],"length":1,"stats":{"Line":3}},{"line":266,"address":[270761,270702,270754],"length":1,"stats":{"Line":0}},{"line":268,"address":[270688],"length":1,"stats":{"Line":1}},{"line":272,"address":[270891,270929,270787,270595],"length":1,"stats":{"Line":4}},{"line":273,"address":[270922,270849,270934],"length":1,"stats":{"Line":2}},{"line":275,"address":[270884,270896,270819],"length":1,"stats":{"Line":2}},{"line":278,"address":[271006],"length":1,"stats":{"Line":1}},{"line":279,"address":[270632,270994,271021,270957],"length":1,"stats":{"Line":3}},{"line":280,"address":[271023,270964,271016],"length":1,"stats":{"Line":0}},{"line":282,"address":[270950],"length":1,"stats":{"Line":1}},{"line":287,"address":[271189,271049,270656,271152],"length":1,"stats":{"Line":3}},{"line":288,"address":[271111,271194,271182],"length":1,"stats":{"Line":2}},{"line":290,"address":[271157,271081,271145],"length":1,"stats":{"Line":0}},{"line":297,"address":[271216],"length":1,"stats":{"Line":1}},{"line":299,"address":[271241],"length":1,"stats":{"Line":1}}],"covered":115,"coverable":119},{"path":["/","mnt","c","Users","Haasini","OneDrive","Desktop","rustlabb","Ferro_spreadsheet","src","visualize_cells.rs"],"content":"use crate::spreadsheet::{Spreadsheet, CommandStatus};\nuse crate::cell::CellValue;\nuse petgraph::{\n    dot::{Config, Dot},\n    graph::{DiGraph, NodeIndex},\n};\nuse std::collections::{HashMap, HashSet};\nuse std::{fs::File, io::Write, process::Command};\n\npub fn visualize_cell_relationships(\n    spreadsheet: \u0026Spreadsheet,\n    row: i16,\n    col: i16,\n) -\u003e CommandStatus {\n    // ...move the entire body of the function from spreadsheet.rs here, replacing `spreadsheet` with `spreadsheet`...\n    if row \u003c 0 || row \u003e= spreadsheet.rows || col \u003c 0 || col \u003e= spreadsheet.cols {\n        return CommandStatus::CmdInvalidCell;\n    }\n\n    // Get the cell key\n    let cell_key = spreadsheet.get_key(row, col);\n    \n    // Create a directed graph for visualization\n    let mut graph = DiGraph::\u003cString, \u0026str\u003e::new();\n    let mut node_indices = HashMap::new();\n\n    // Function to get formatted cell name\n    let get_cell_label = |key: i32| -\u003e String {\n        let (r, c) = spreadsheet.get_row_col(key);\n        let col_name = spreadsheet.get_column_name(c);\n        format!(\"{}{} ({})\", col_name, r + 1, match spreadsheet.grid[key as usize] {\n            CellValue::Integer(val) =\u003e val.to_string(),\n            CellValue::Error =\u003e \"ERROR\".to_string(),\n        })\n    };\n\n    // Add the target cell to the graph\n    let target_label = get_cell_label(cell_key);\n    let target_node = graph.add_node(target_label.clone());\n    node_indices.insert(cell_key, target_node);\n\n    // Helper function to process relationships\n    fn process_relationships(\n        spreadsheet: \u0026Spreadsheet,\n        start_key: i32, \n        is_parent_direction: bool,\n        processed: \u0026mut HashSet\u003ci32\u003e,\n        depth_limit: usize,\n        graph: \u0026mut DiGraph\u003cString, \u0026str\u003e,\n        node_indices: \u0026mut HashMap\u003ci32, NodeIndex\u003e,\n        get_cell_label: \u0026dyn Fn(i32) -\u003e String,\n    ) {\n        if !processed.insert(start_key) {\n            return; // Already processed this cell\n        }\n        \n\n        // Add appropriate relationships based on direction\n        if is_parent_direction {\n            // Add parents - traverse up the dependency tree\n            if let Some(meta) = spreadsheet.cell_meta.get(\u0026start_key) {\n               \n\n                for parent_key in [meta.parent1, meta.parent2].iter()\n                                .filter(|\u0026\u0026k| k \u003e= 0) {\n                    \n                    // Create parent node if it doesn't exist\n                    let parent_idx = if let Some(\u0026idx) = node_indices.get(parent_key) {\n                        idx\n                    } else {\n                        let parent_label = get_cell_label(*parent_key);\n                        let idx = graph.add_node(parent_label);\n                        node_indices.insert(*parent_key, idx);\n                        idx\n                    };\n                    \n                    // Add edge from parent to child\n                    let child_idx = node_indices[\u0026start_key];\n                    graph.add_edge(parent_idx, child_idx, \"depends on\");\n                    \n                    // Recurse for this parent (up to the depth limit)\n                    if processed.len() \u003c depth_limit {\n                        process_relationships(\n                            spreadsheet,\n                            *parent_key, \n                            true, \n                            processed, \n                            depth_limit,\n                            graph,\n                            node_indices,\n                            get_cell_label\n                        );\n                    }\n                }\n            }\n        } else {\n            // Add children - traverse down the dependency tree\n            if let Some(children) = spreadsheet.get_cell_children(start_key) {\n            \n                for \u0026child_key in children {\n                    // Create child node if it doesn't exist\n                    let child_idx = if let Some(\u0026idx) = node_indices.get(\u0026child_key) {\n                        idx\n                    } else {\n                        let child_label = get_cell_label(child_key);\n                        let idx = graph.add_node(child_label);\n                        node_indices.insert(child_key, idx);\n                        idx\n                    };\n                    \n                    // Add edge from parent to child\n                    let parent_idx = node_indices[\u0026start_key];\n                    graph.add_edge(parent_idx, child_idx, \"used by\");\n                    \n                    // Recurse for this child (up to the depth limit)\n                    if processed.len() \u003c depth_limit {\n                        process_relationships(\n                            spreadsheet,\n                            child_key, \n                            false, \n                            processed, \n                            depth_limit,\n                            graph,\n                            node_indices,\n                            get_cell_label\n                        );\n                    }\n                }\n            }\n        }\n        \n    }\n\n    // Process parents (upward traversal)\n    let mut processed = HashSet::new();\n     // Mark target cell as processed\n    process_relationships(\n        spreadsheet,\n        cell_key, \n        true, \n        \u0026mut processed, \n        20,\n        \u0026mut graph,\n        \u0026mut node_indices,\n        \u0026get_cell_label\n    );\n    \n    // Process children (downward traversal)\n    let mut processed = HashSet::new();\n     // Mark target cell as processed\n    process_relationships(\n        spreadsheet,\n        cell_key, \n        false, \n        \u0026mut processed, \n        20,\n        \u0026mut graph,\n        \u0026mut node_indices,\n        \u0026get_cell_label\n    );\n\n    // Generate DOT format\n    let dot = Dot::with_config(\u0026graph, \u0026[Config::EdgeNoLabel]);\n    \n    // Save to temp file\n    let temp_file = format!(\"cell_{}_{}_relationships.dot\", row, col);\n    let mut file = match File::create(\u0026temp_file) {\n        Ok(file) =\u003e file,\n        Err(e) =\u003e {\n            eprintln!(\"Failed to create dot file: {}\", e);\n            return CommandStatus::CmdOk;\n        }\n    };\n    \n    if let Err(e) = writeln!(file, \"{:?}\", dot) {\n        eprintln!(\"Failed to write to dot file: {}\", e);\n        return CommandStatus::CmdOk;\n    }\n\n    println!(\"Cell relationships saved to {}\", temp_file);\n    \n    // Attempt to render with Graphviz if available\n    let output_file = format!(\"cell_{}_{}_relationships.png\", row, col);\n    match Command::new(\"dot\")\n        .args([\"-Tpng\", \u0026temp_file, \"-o\", \u0026output_file])\n        .output() \n    {\n        Ok(_) =\u003e {\n            println!(\"Cell relationship diagram generated as {}\", output_file);\n            // Try to open the image with the default viewer\n            #[cfg(target_os = \"windows\")]\n            let _ = Command::new(\"cmd\").args([\"/C\", \u0026output_file]).spawn();\n            \n            #[cfg(target_os = \"macos\")]\n            let _ = Command::new(\"open\").arg(\u0026output_file).spawn();\n            \n            #[cfg(target_os = \"linux\")]\n            let _ = Command::new(\"xdg-open\").arg(\u0026output_file).spawn();\n        }\n        Err(_) =\u003e {\n            println!(\"Graphviz not found. You can manually convert the .dot file to an image.\");\n            println!(\"For instance: dot -Tpng {} -o {}\", temp_file, output_file);\n        }\n    }\n\n    // Print textual representation of the relationships\n    println!(\"\\nCell {}{}:\", spreadsheet.get_column_name(col), row + 1);\n    \n    // Show parents\n    if let Some(meta) = spreadsheet.cell_meta.get(\u0026cell_key) {\n        println!(\"  Parents:\");\n        let mut has_parents = false;\n        \n        for parent_key in [meta.parent1, meta.parent2].iter().filter(|\u0026\u0026k| k \u003e= 0) {\n            has_parents = true;\n            let (r, c) = spreadsheet.get_row_col(*parent_key);\n            println!(\"    - {}{}: {}\", \n                spreadsheet.get_column_name(c), \n                r + 1,\n                match spreadsheet.grid[*parent_key as usize] {\n                    CellValue::Integer(val) =\u003e val.to_string(),\n                    CellValue::Error =\u003e \"ERROR\".to_string(),\n                }\n            );\n        }\n        \n        if !has_parents {\n            println!(\"    (none)\");\n        }\n    }\n    \n    // Show children\n    println!(\"  Children:\");\n    if let Some(children) = spreadsheet.get_cell_children(cell_key) {\n        if !children.is_empty() {\n            for \u0026child_key in children {\n                let (r, c) = spreadsheet.get_row_col(child_key);\n                println!(\"    - {}{}: {}\", \n                    spreadsheet.get_column_name(c), \n                    r + 1,\n                    match spreadsheet.grid[child_key as usize] {\n                        CellValue::Integer(val) =\u003e val.to_string(),\n                        CellValue::Error =\u003e \"ERROR\".to_string(),\n                    }\n                );\n            }\n        } else {\n            println!(\"    (none)\");\n        }\n    } else {\n        println!(\"    (none)\");\n    }\n    \n    CommandStatus::CmdOk\n}\n","traces":[{"line":10,"address":[205455,200160,201658],"length":1,"stats":{"Line":1}},{"line":16,"address":[200254,200205],"length":1,"stats":{"Line":2}},{"line":17,"address":[200241],"length":1,"stats":{"Line":1}},{"line":21,"address":[200298],"length":1,"stats":{"Line":1}},{"line":24,"address":[200334],"length":1,"stats":{"Line":1}},{"line":25,"address":[200347],"length":1,"stats":{"Line":1}},{"line":28,"address":[177888,178549],"length":1,"stats":{"Line":2}},{"line":29,"address":[177936],"length":1,"stats":{"Line":1}},{"line":30,"address":[177979],"length":1,"stats":{"Line":1}},{"line":31,"address":[178013,178062,178277,178260],"length":1,"stats":{"Line":3}},{"line":32,"address":[178182,178242],"length":1,"stats":{"Line":2}},{"line":33,"address":[178215,178267],"length":1,"stats":{"Line":0}},{"line":38,"address":[200410],"length":1,"stats":{"Line":1}},{"line":39,"address":[200477,200557],"length":1,"stats":{"Line":2}},{"line":40,"address":[200585],"length":1,"stats":{"Line":1}},{"line":43,"address":[205472],"length":1,"stats":{"Line":1}},{"line":53,"address":[205616],"length":1,"stats":{"Line":1}},{"line":59,"address":[205641],"length":1,"stats":{"Line":1}},{"line":61,"address":[205705,206212],"length":1,"stats":{"Line":1}},{"line":64,"address":[206228],"length":1,"stats":{"Line":0}},{"line":65,"address":[178586,178576],"length":1,"stats":{"Line":0}},{"line":68,"address":[206383,206449],"length":1,"stats":{"Line":0}},{"line":69,"address":[206442],"length":1,"stats":{"Line":0}},{"line":71,"address":[206466],"length":1,"stats":{"Line":0}},{"line":72,"address":[206484],"length":1,"stats":{"Line":0}},{"line":73,"address":[206520],"length":1,"stats":{"Line":0}},{"line":74,"address":[206531],"length":1,"stats":{"Line":0}},{"line":78,"address":[206543],"length":1,"stats":{"Line":0}},{"line":79,"address":[206574],"length":1,"stats":{"Line":0}},{"line":82,"address":[206604],"length":1,"stats":{"Line":0}},{"line":85,"address":[206663],"length":1,"stats":{"Line":0}},{"line":98,"address":[205652,205765],"length":1,"stats":{"Line":1}},{"line":100,"address":[205781],"length":1,"stats":{"Line":0}},{"line":102,"address":[205970,205896],"length":1,"stats":{"Line":0}},{"line":103,"address":[205963],"length":1,"stats":{"Line":0}},{"line":105,"address":[205982],"length":1,"stats":{"Line":0}},{"line":106,"address":[206005],"length":1,"stats":{"Line":0}},{"line":107,"address":[206036],"length":1,"stats":{"Line":0}},{"line":108,"address":[206052],"length":1,"stats":{"Line":0}},{"line":112,"address":[206064],"length":1,"stats":{"Line":0}},{"line":113,"address":[206095],"length":1,"stats":{"Line":0}},{"line":116,"address":[206125],"length":1,"stats":{"Line":0}},{"line":135,"address":[200615],"length":1,"stats":{"Line":1}},{"line":149,"address":[200756],"length":1,"stats":{"Line":1}},{"line":163,"address":[200886],"length":1,"stats":{"Line":1}},{"line":166,"address":[200937],"length":1,"stats":{"Line":1}},{"line":167,"address":[201120,201167],"length":1,"stats":{"Line":2}},{"line":168,"address":[201180],"length":1,"stats":{"Line":1}},{"line":169,"address":[201224],"length":1,"stats":{"Line":0}},{"line":170,"address":[201256,205280],"length":1,"stats":{"Line":0}},{"line":171,"address":[205351],"length":1,"stats":{"Line":0}},{"line":175,"address":[201217,201306],"length":1,"stats":{"Line":2}},{"line":176,"address":[201531,201466],"length":1,"stats":{"Line":0}},{"line":177,"address":[201602],"length":1,"stats":{"Line":0}},{"line":180,"address":[201683],"length":1,"stats":{"Line":1}},{"line":183,"address":[201777],"length":1,"stats":{"Line":1}},{"line":184,"address":[202276,201944],"length":1,"stats":{"Line":2}},{"line":185,"address":[202019,202119],"length":1,"stats":{"Line":2}},{"line":189,"address":[202369,202445],"length":1,"stats":{"Line":0}},{"line":198,"address":[202516],"length":1,"stats":{"Line":0}},{"line":201,"address":[202376,202689],"length":1,"stats":{"Line":2}},{"line":202,"address":[202724],"length":1,"stats":{"Line":1}},{"line":207,"address":[202867],"length":1,"stats":{"Line":1}},{"line":210,"address":[203146],"length":1,"stats":{"Line":1}},{"line":211,"address":[203297,203242],"length":1,"stats":{"Line":0}},{"line":212,"address":[203324],"length":1,"stats":{"Line":0}},{"line":214,"address":[178618,178608],"length":1,"stats":{"Line":0}},{"line":215,"address":[203598],"length":1,"stats":{"Line":0}},{"line":216,"address":[203606,203693],"length":1,"stats":{"Line":0}},{"line":217,"address":[203888],"length":1,"stats":{"Line":0}},{"line":227,"address":[203553],"length":1,"stats":{"Line":0}},{"line":228,"address":[203625],"length":1,"stats":{"Line":0}},{"line":233,"address":[203268,204191],"length":1,"stats":{"Line":2}},{"line":234,"address":[204218],"length":1,"stats":{"Line":1}},{"line":235,"address":[204344,204300],"length":1,"stats":{"Line":0}},{"line":236,"address":[204521,204399,204363],"length":1,"stats":{"Line":0}},{"line":237,"address":[204542],"length":1,"stats":{"Line":0}},{"line":238,"address":[204771],"length":1,"stats":{"Line":0}},{"line":248,"address":[204370,205074],"length":1,"stats":{"Line":0}},{"line":251,"address":[205098,204311],"length":1,"stats":{"Line":2}},{"line":254,"address":[204487],"length":1,"stats":{"Line":1}}],"covered":38,"coverable":81}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('pre', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('code', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>